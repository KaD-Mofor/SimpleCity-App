{"version":3,"file":"AutoRedirectView.js","sources":["../../../../../../src/v2/view-builder/views/AutoRedirectView.js"],"sourcesContent":["import { _, loc, createCallout, createButton } from '@okta/courage';\nimport { BaseForm, BaseView } from '../internals';\nimport { INTERSTITIAL_REDIRECT_VIEW } from '../../ion/RemediationConstants';\nimport CustomAccessDeniedErrorMessage from '../views/shared/CustomAccessDeniedErrorMessage';\nimport Util from 'util/Util';\nimport { getHeader } from '../utils/AutoRedirectUtil';\nconst CUSTOM_ACCESS_DENIED_KEY = 'security.access_denied_custom_message';\nconst UNLOCK_USER_SUCCESS_MESSAGE = 'oie.selfservice.unlock_user.landing.to.app.success.message';\n\nconst Body = BaseForm.extend({\n  /* eslint complexity: [2, 16] */\n  title() {\n    let titleString = loc('oie.success.text.signingIn', 'login');\n    // For more info on the API response available in appState, see IdxResponseBuilder.java\n    const app = this.options.appState.get('app');\n    const user = this.options.appState.get('user');\n\n    // OKTA-635926: add user gesture for ov enrollment on android\n    if (Util.isAndroidOVEnrollment()) {\n      titleString = loc('oie.success.text.signingIn.with.appName.android.ov.enrollment', 'login');\n      return titleString;\n    }\n\n    // If the option is not set, we treat that as being the case where we don't render the spinner.\n    // This is to account for the customer hosted scenario, because by default okta-core will pass in\n    // the correct value as set by the option in the Admin UI (which by default is \"DEFAULT\").\n    if (!this.redirectView || this.redirectView === INTERSTITIAL_REDIRECT_VIEW.NONE) {\n      titleString = loc('oie.success.text.signingIn.with.ellipsis', 'login');\n      return titleString;\n    }\n\n    if (_.isEmpty(app)) {\n      return titleString;\n    }\n\n    const { label: appInstanceName, name: appDisplayName } = app;\n    const { identifier: userEmail } = user || {};\n\n    const appName = appInstanceName ? appInstanceName : appDisplayName;\n\n    if (appName && userEmail && !this.settings.get('features.showIdentifier')) {\n      titleString = loc('oie.success.text.signingIn.with.appName.and.identifier', 'login', [appName, userEmail]);\n    } else if (appName) {\n      titleString = loc('oie.success.text.signingIn.with.appName', 'login', [appName]);\n    }\n\n    return titleString;\n  },\n  showMessages() {\n    if (this.isUnlockSuccess()) {\n      const container = '.o-form-error-container';\n      const text = loc('oie.selfservice.unlock_user.landing.to.app.signing.in.message', 'login');\n      this.add(`<div class=\"ion-messages-container\"><p>${text}</p></div>`, container);\n      return;\n    } else if (this.options.appState.containsMessageStartingWithI18nKey(CUSTOM_ACCESS_DENIED_KEY)) {\n      const { message, links } = this.options.appState.get('messages').value.find(\n        msg => msg.i18n.key === CUSTOM_ACCESS_DENIED_KEY);\n      this.add(createCallout({\n        type: 'error',\n        content: new CustomAccessDeniedErrorMessage({ message, links })\n      }));\n      return;\n    }\n    BaseForm.prototype.showMessages.call(this);\n  },\n  isUnlockSuccess() {\n    return this.options.appState.containsMessageWithI18nKey(UNLOCK_USER_SUCCESS_MESSAGE);\n  },\n  noButtonBar: true,\n  initialize() {\n    BaseForm.prototype.initialize.apply(this, arguments);\n    this.redirectView = this.settings.get('interstitialBeforeLoginRedirect');\n    this.model.set('useRedirect', true);\n    this.trigger('save', this.model);\n  },\n\n  render() {\n    BaseForm.prototype.render.apply(this, arguments);\n    if (Util.isAndroidOVEnrollment()) {\n      const currentViewState = this.options.appState.getCurrentViewState();\n      this.add(createButton({\n        className: 'ul-button button button-wide button-primary hide-underline',\n        title: loc('oktaVerify.open.button', 'login'),\n        id: 'launch-enrollment-ov',\n        click: () => {\n          Util.redirectWithFormGet(currentViewState.href);\n        }\n      }));\n    } else if (this.redirectView === INTERSTITIAL_REDIRECT_VIEW.DEFAULT) {\n      this.add('<div class=\"okta-waiting-spinner\"></div>');\n    }\n  }\n});\n\nexport default BaseView.extend({\n  Header: getHeader(),\n  Body: Body\n});\n"],"names":["CUSTOM_ACCESS_DENIED_KEY","UNLOCK_USER_SUCCESS_MESSAGE","Body","BaseForm","extend","title","titleString","loc","app","options","appState","get","user","Util","isAndroidOVEnrollment","redirectView","INTERSTITIAL_REDIRECT_VIEW","NONE","_","isEmpty","label","appInstanceName","name","appDisplayName","identifier","userEmail","appName","settings","showMessages","isUnlockSuccess","container","text","add","containsMessageStartingWithI18nKey","message","links","value","find","msg","i18n","key","createCallout","type","content","CustomAccessDeniedErrorMessage","prototype","call","containsMessageWithI18nKey","noButtonBar","initialize","apply","arguments","model","set","trigger","render","currentViewState","getCurrentViewState","createButton","className","id","click","redirectWithFormGet","href","DEFAULT","BaseView","Header","getHeader"],"mappings":"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"}