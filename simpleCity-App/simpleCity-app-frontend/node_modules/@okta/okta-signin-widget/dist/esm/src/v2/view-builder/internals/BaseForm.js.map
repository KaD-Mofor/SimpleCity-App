{"version":3,"file":"BaseForm.js","sources":["../../../../../../src/v2/view-builder/internals/BaseForm.ts"],"sourcesContent":["import hbs from '@okta/handlebars-inline-precompile';\n\nimport { _, Form, loc, internal, createCallout, View } from '@okta/courage';\nimport * as FormInputFactory from './FormInputFactory';\n\nconst { FormUtil } = internal.views.forms.helpers;\nconst INFO_MESSAGE_CLASS = 'INFO';\n\nexport default Form.extend({\n\n  layout: 'o-form-theme',\n  className: 'ion-form',\n  hasSavingState: true,\n  autoSave: false,\n  noCancelButton: true,\n\n  title() {\n    return loc('oform.title.authenticate', 'login');\n  },\n\n  save() {\n    return loc('oform.next', 'login');\n  },\n\n  modelEvents: {\n    'clearFormError': 'handleClearFormError',\n    'error': 'triggerAfterError',\n  },\n\n  initialize() {\n    const uiSchemas = this.getUISchema();\n    const inputOptions = uiSchemas.map(FormInputFactory.create);\n\n    //should be used before adding any other input components\n    this.showMessages();\n\n    // Render CAPTCHA if one of the form fields requires us to.\n    this.listenTo(this.options.appState, 'onCaptchaLoaded', (captchaObject) => {\n      this.captchaObject = captchaObject;\n    });\n\n    inputOptions.forEach(input => {\n      this.addInputOrView(input);\n    });\n\n    this.listenTo(this, 'save', this.saveForm);\n    this.listenTo(this, 'cancel', this.cancelForm);\n  },\n\n  focus(...args) {\n    if (this.settings.get('features.autoFocus')) {\n      Form.prototype.focus.apply(this, args);\n    }\n  },\n\n  handleClearFormError() {\n    const formErrorContainer = this.$('.o-form-error-container');\n    formErrorContainer.empty();\n    if (formErrorContainer.hasClass('o-form-has-errors')) {\n      this.clearErrors();\n    }\n  },\n\n  triggerAfterError(model, error) {\n    this.options.appState.trigger('afterError', error);\n  },\n\n  saveForm(model) {\n    //remove any existing warnings or messages before saving form\n    this.$el.find('.o-form-error-container').empty();\n\n    // Execute Captcha if enabled for this form.\n    if (this.captchaObject) {\n      this.captchaObject.execute();\n    } else {\n      this.options.appState.trigger('saveForm', model);\n    }\n  },\n\n  postRender() {\n    /**\n     * Widget would use infoContainer to display interactive messages that should be persisted during\n     * invalid form submissions. For eg resend-warning callout should not be cleared upon invalid form submit.\n     * Rerender would clear infoContainer or views classes can clear it explicitly.\n     */\n    const infoContainer= '<div class=\\'o-form-info-container\\'></div>';\n    this.$el.find('.o-form-error-container')\n      .attr('role', 'alert')\n      .before(infoContainer);\n\n    this.addIdentifier();\n  },\n\n  /**\n   * Render user identifier below title, or if no title, render below message.\n   */\n  addIdentifier() {\n    const { identifier } = this.options.appState.get('user') || {};\n    if (!identifier) {\n      return;\n    } else if (!this.settings.get('features.showIdentifier')) {\n      return;\n    }\n\n    const header = this.$el.find('[data-se=\"o-form-head\"]');\n    const identifierHTMLString = hbs('<div class=\"identifier-container\">\\\n        <span class=\"identifier no-translate\" data-se=\"identifier\" title=\"{{identifier}}\">{{identifier}}</span>\\\n      </div>')({identifier});\n\n    if (header.length) {\n      header.after(identifierHTMLString);\n    } else {\n      this.$el.find('.o-form-error-container').after(identifierHTMLString);\n    }\n  },\n\n  cancelForm() {\n    this.options.appState.trigger('invokeAction', 'cancel');\n  },\n\n  getUISchema() {\n    if (Array.isArray(this.options.currentViewState.uiSchema)) {\n      return this.options.currentViewState.uiSchema;\n    } else {\n      return [];\n    }\n  },\n\n  addInputOrView(input) {\n    if (input.visible === false || (input.mutable === false && input.visible !== true)) {\n      return;\n    }\n    if (input.View) {\n      this.add(input.View, _.omit(input, 'View', 'showWhen'));\n      if (input.showWhen) {\n        FormUtil.applyShowWhen(this.last(), input.showWhen);\n      }\n    } else {\n      this.addInput(input);\n    }\n\n    if (Array.isArray(input.optionsUiSchemas)) {\n      if (this.options.optionUiSchemaConfig[input.name]) {\n        const optionUiSchemaIndex = Number(this.options.optionUiSchemaConfig[input.name]);\n        const optionUiSchemas = input.optionsUiSchemas[optionUiSchemaIndex] || [];\n        optionUiSchemas.forEach(this.addInputOrView.bind(this));\n      }\n    }\n  },\n\n  /*\n  * Views should override this function to render custom error callouts for invalid form actions.\n  * Should return true when callout is customized\n  */\n  showCustomFormErrorCallout: null,\n\n  /*\n   * Renders the contents of messages object (if any, on error) during initialize\n   * This function is called during Form.initialize, and will display\n   * messages when the form reloads.\n   * Note: Any user action related form errors handled by FormController.showFormErrors\n   */\n  showMessages(options) {\n    const messages = this.options.appState.get('messages') || {};\n    const errContainer = '.o-form-error-container';\n    if (Array.isArray(messages.value) && !(options instanceof View)) {\n      this.add('<div class=\"ion-messages-container\"></div>', errContainer);\n      messages.value.forEach(obj => {\n        if(!obj?.class || obj.class === INFO_MESSAGE_CLASS) {\n          // add message as plain text\n          this.add(`<p>${obj.message}</p>`, '.ion-messages-container');\n        } else {\n          const errorObj = {\n            class: obj?.class ?? '',\n            message: obj?.message,\n            title: '',\n            ...options\n          };\n          this.add(createCallout({\n            content: errorObj.message,\n            type: errorObj.class.toLowerCase(),\n            title: errorObj.title\n          }), errContainer);\n          options = null; // prevent repeating first error message\n        }\n      });\n    } else if (options instanceof View) {\n      // if callee is showCustomFormErrorCallout. show custom error views\n      this.add(options, errContainer);\n    }\n  },\n});"],"names":["FormUtil","internal","views","forms","helpers","INFO_MESSAGE_CLASS","Form","extend","layout","className","hasSavingState","autoSave","noCancelButton","title","loc","save","modelEvents","initialize","uiSchemas","getUISchema","inputOptions","map","FormInputFactory","showMessages","listenTo","options","appState","captchaObject","forEach","input","addInputOrView","saveForm","cancelForm","focus","args","settings","get","prototype","apply","handleClearFormError","formErrorContainer","$","empty","hasClass","clearErrors","triggerAfterError","model","error","trigger","$el","find","execute","postRender","infoContainer","attr","before","addIdentifier","identifier","header","identifierHTMLString","length","after","Array","isArray","currentViewState","uiSchema","visible","mutable","View","add","_","omit","showWhen","applyShowWhen","last","addInput","optionsUiSchemas","optionUiSchemaConfig","name","optionUiSchemaIndex","Number","optionUiSchemas","bind","showCustomFormErrorCallout","messages","errContainer","value","obj","class","message","errorObj","createCallout","content","type","toLowerCase"],"mappings":"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"}