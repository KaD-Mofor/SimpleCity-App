{"version":3,"file":"ChallengeAuthenticatorDataPhoneView.js","sources":["../../../../../../../src/v2/view-builder/views/phone/ChallengeAuthenticatorDataPhoneView.js"],"sourcesContent":["import { _, loc } from '@okta/courage';\nimport { BaseForm, BaseView } from '../../internals';\nimport BaseAuthenticatorView from '../../components/BaseAuthenticatorView';\n\nconst Body = BaseForm.extend(\n  {\n    className: 'phone-authenticator-challenge',\n    events: {\n      'click a.phone-authenticator-challenge__link' : 'handleSecondaryLinkClick'\n    },\n\n    title() {\n      return loc('oie.phone.verify.title', 'login');\n    },\n\n    save() {\n      return (this.model.get('primaryMode') === 'sms')\n        ? loc('oie.phone.sms.primaryButton', 'login')\n        : loc('oie.phone.call.primaryButton', 'login');\n    },\n\n    handleSecondaryLinkClick(e) {\n      e.preventDefault();\n      // Call the API to send a code via secondary mode\n      const secondaryMode = this.model.get('secondaryMode');\n      this.model.set('authenticator.methodType', secondaryMode);\n      this.saveForm(this.model);\n    },\n\n    initialize() {\n      // This is needed when user clicks on secondary (say voice) and call fails with ratelimit server-side error.\n      // Then the user clicks primary button (say sms) and right methodType needs to be sent.\n      this.model.on('error', () => this.model.set('authenticator.methodType', this.model.get('primaryMode')));\n      BaseForm.prototype.initialize.apply(this, arguments);\n      const sendText = ( this.model.get('primaryMode') === 'sms' )\n        ? loc('oie.phone.verify.sms.sendText', 'login')\n        : loc('oie.phone.verify.call.sendText', 'login');\n      const carrierChargesText = loc('oie.phone.carrier.charges', 'login');\n      const isPhoneNumberAvailable = this.model.get('phoneNumber') !== loc('oie.phone.alternate.title', 'login');\n      const extraCssClasses = isPhoneNumberAvailable ? 'strong no-translate' : '';\n      let nicknameText = isPhoneNumberAvailable ? this.model.get('nickname') : '';\n      let extraNicknameCssClasses = '';\n      if (nicknameText !== '') {\n        nicknameText = ' (' + nicknameText + ')';\n        extraNicknameCssClasses = 'strong no-translate authenticator-verify-nickname';\n      }\n      const nicknameTemplate = nicknameText ? `<span ${ extraNicknameCssClasses ? \n        'class=\"' + extraNicknameCssClasses + '\"' : ''}>\n      ${nicknameText}.</span>` : '<span class=\"no-translate\">.</span>';\n      // Courage doesn't support HTML, hence creating a subtitle here.\n      this.add(`<div class=\"okta-form-subtitle\" data-se=\"o-form-explain\">${sendText}\n        <span ${ extraCssClasses ? 'class=\"' + extraCssClasses + '\"' : ''}>\n        ${this.model.escape('phoneNumber')}</span>${nicknameTemplate}\n        <p>${carrierChargesText}</p>\n      </div>`);\n    },\n\n    getUISchema() {\n      // Change the UI schema to not display radios here.\n      const uiSchemas = BaseForm.prototype.getUISchema.apply(this, arguments);\n      return uiSchemas.filter(schema => schema.name !== 'authenticator.methodType');\n    },\n\n    render() {\n      BaseForm.prototype.render.apply(this, arguments);\n      const secondaryMode = this.model.get('secondaryMode');\n      if (secondaryMode) {\n        const secondaryButtonTitle = (secondaryMode === 'sms')\n          ? loc('oie.phone.sms.secondaryButton', 'login')\n          : loc('oie.phone.call.secondaryButton', 'login');\n        this.add(\n          `<a href=\"#\"\n            class=\"link phone-authenticator-challenge__link\"\n            data-se=\"phone-authenticator-challenge__link\">${secondaryButtonTitle}</a>`,\n          '.o-form-button-bar');\n      }\n    },\n  },\n);\n\nexport default BaseAuthenticatorView.extend({\n  Body,\n\n  createModelClass({ uiSchema }) {\n    // It is important to get methods from here to maintain single source of truth.\n    const { options: methods } = _.find(uiSchema, schema => schema.name === 'authenticator.methodType');\n    const relatesToObject = this.options.currentViewState.relatesTo;\n    const { profile, nickname } = relatesToObject?.value || {};\n    const ModelClass = BaseView.prototype.createModelClass.apply(this, arguments);\n    const local = Object.assign({\n      primaryMode: {\n        'value': methods[0].value,\n        'type': 'string',\n      },\n      secondaryMode: {\n        'value': methods[1] && methods[1].value,\n        'type': 'string',\n      },\n      phoneNumber: {\n        'value': profile?.phoneNumber ? profile.phoneNumber : loc('oie.phone.alternate.title', 'login'),\n        'type': 'string',\n      },\n      nickname: {\n        'value': nickname ? nickname : '',\n        'type': 'string',\n      },\n    }, ModelClass.prototype.local);\n    return ModelClass.extend({ local });\n  },\n});\n"],"names":["Body","BaseForm","extend","className","events","title","loc","save","model","get","handleSecondaryLinkClick","e","preventDefault","secondaryMode","set","saveForm","initialize","on","prototype","apply","arguments","sendText","carrierChargesText","isPhoneNumberAvailable","extraCssClasses","nicknameText","extraNicknameCssClasses","nicknameTemplate","add","escape","getUISchema","uiSchemas","filter","schema","name","render","secondaryButtonTitle","BaseAuthenticatorView","createModelClass","uiSchema","options","methods","_","find","relatesToObject","currentViewState","relatesTo","profile","nickname","value","ModelClass","BaseView","local","Object","assign","primaryMode","phoneNumber"],"mappings":"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"}