{"version":3,"file":"EnrollOnPremController.js","sources":["../../../../../src/v1/controllers/EnrollOnPremController.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, loc } from '@okta/courage';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport Util from 'util/Util';\nimport Footer from 'v1/views/enroll-factors/Footer';\nimport TextBox from 'v1/views/shared/TextBox';\n\nfunction isRSA(provider) {\n  return provider === 'RSA';\n}\n\nfunction getClassName(provider) {\n  return isRSA(provider) ? 'enroll-rsa' : 'enroll-onprem';\n}\n\nexport default FormController.extend({\n  className: function() {\n    return getClassName(this.options.provider);\n  },\n  Model: function() {\n    const provider = this.options.provider;\n    const factors = this.options.appState.get('factors');\n    const factor = factors.findWhere(_.pick(this.options, 'provider', 'factorType'));\n    const profile = factor.get('profile');\n    const credentialId = profile && profile.credentialId ? profile.credentialId : '';\n\n    return {\n      props: {\n        credentialId: ['string', true, credentialId],\n        passCode: ['string', true],\n        factorId: 'string',\n      },\n      save: function() {\n        return this.doTransaction(function(transaction) {\n          const factor = _.findWhere(transaction.factors, {\n            factorType: 'token',\n            provider: provider,\n          });\n\n          return factor.enroll({\n            passCode: this.get('passCode'),\n            profile: { credentialId: this.get('credentialId') },\n          });\n        });\n      },\n    };\n  },\n\n  Form: function() {\n    const provider = this.options.provider;\n    const factors = this.options.appState.get('factors');\n    const factor = factors.findWhere(_.pick(this.options, 'provider', 'factorType'));\n    const vendorName = factor.get('vendorName');\n    const title = isRSA(provider) ? loc('factor.totpHard.rsaSecurId', 'login') : vendorName;\n\n    return {\n      title: title,\n      noButtonBar: true,\n      autoSave: true,\n      className: getClassName(provider),\n      initialize: function() {\n        this.listenTo(this.model, 'error', (source, error) => {\n          if (error && error.status === 409) {\n            // 409 means we are in change pin, so we should clear out answer input\n            this.$('.o-form-input-name-passCode input').val('');\n            this.$('.o-form-input-name-passCode input').trigger('change');\n            this.$('.o-form-input-name-passCode input').focus();\n          }\n        });\n      },\n      formChildren: [\n        FormType.Input({\n          label: loc('enroll.onprem.username.placeholder', 'login', [vendorName]),\n          'label-top': true,\n          explain: Util.createInputExplain(\n            'enroll.onprem.username.tooltip',\n            'enroll.onprem.username.placeholder',\n            'login',\n            [vendorName],\n            [vendorName]\n          ),\n          'explain-top': true,\n          name: 'credentialId',\n          input: TextBox,\n          type: 'text',\n        }),\n        FormType.Input({\n          label: loc('enroll.onprem.passcode.placeholder', 'login', [vendorName]),\n          'label-top': true,\n          explain: Util.createInputExplain(\n            'enroll.onprem.passcode.tooltip',\n            'enroll.onprem.passcode.placeholder',\n            'login',\n            [vendorName],\n            [vendorName]\n          ),\n          'explain-top': true,\n          name: 'passCode',\n          input: TextBox,\n          type: 'password',\n        }),\n        FormType.Toolbar({\n          noCancelButton: true,\n          save: loc('mfa.challenge.verify', 'login'),\n        }),\n      ],\n    };\n  },\n\n  Footer: Footer,\n});\n"],"names":["isRSA","provider","getClassName","FormController","extend","className","options","Model","factors","appState","get","factor","findWhere","_","pick","profile","credentialId","props","passCode","factorId","save","doTransaction","transaction","factorType","enroll","Form","vendorName","title","loc","noButtonBar","autoSave","initialize","listenTo","model","source","error","status","$","val","trigger","focus","formChildren","FormType","Input","label","explain","Util","createInputExplain","name","input","TextBox","type","Toolbar","noCancelButton","Footer"],"mappings":"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"}