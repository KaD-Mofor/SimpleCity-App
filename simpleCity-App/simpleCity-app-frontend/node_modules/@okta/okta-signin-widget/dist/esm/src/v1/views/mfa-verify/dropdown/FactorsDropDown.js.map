{"version":3,"file":"FactorsDropDown.js","sources":["../../../../../../../src/v1/views/mfa-verify/dropdown/FactorsDropDown.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, $, loc, internal } from '@okta/courage';\nimport FactorUtil from 'util/FactorUtil';\nimport Factor from 'v1//models/Factor';\nimport FactorsDropDownOptions from './FactorsDropDownOptions';\nconst { BaseDropDown } = internal.views.components;\n\n$(document).click(function(e) {\n  const $target = $(e.target);\n  const isDropdown = $target.closest('.option-selected').length > 0 && $target.closest('.dropdown').length > 0;\n\n  if (!isDropdown) {\n    $('.dropdown .options').hide();\n    $('.dropdown a.option-selected').attr('aria-expanded', false);\n  }\n});\n\nexport default BaseDropDown.extend({\n  className: 'bg-helper icon-button',\n  screenReaderText: function() {\n    const factors = this.options.appState.get('factors');\n    let factor;\n    let factorLabel;\n\n    if (factors) {\n      factor = FactorUtil.findFactorInFactorsArray(factors, this.options.provider, this.options.factorType);\n    } else {\n      factor = new Factor.Model(this.options.appState.get('factor'), this.toJSON());\n    }\n    factorLabel = factor.get('factorLabel');\n    return loc('mfa.factors.dropdown.sr.text', 'login', [factorLabel]);\n  },\n  events: {\n    'click a.option-selected': function(e) {\n      e.preventDefault();\n      if (_.result(this, 'disabled')) {\n        e.stopPropagation();\n      } else {\n        const expanded = this.$('.options').toggle().is(':visible');\n\n        this.$('a.option-selected').attr('aria-expanded', expanded);\n        if (expanded) {\n          this.$('#okta-dropdown-options').find('li.factor-option:first a').focus();\n        }\n      }\n    },\n    'click .dropdown-disabled': function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n    },\n  },\n  initialize: function() {\n    this.addOption(FactorsDropDownOptions.getDropdownOption('TITLE'));\n    const factorsList = this.options.appState.get('factors');\n    const multiplePushFactors = factorsList.hasMultipleFactorsOfSameType('push');\n\n    factorsList.each(function(factor) {\n      // Do not add okta totp if there are multiple okta push (each push will have an inline totp)\n      if (!(factor.get('factorType') === 'token:software:totp' && multiplePushFactors)) {\n        this.addOption(FactorsDropDownOptions.getDropdownOption(factor.get('factorName')), { model: factor });\n        this.listenTo(this.last(), 'options:toggle', function() {\n          this.$('.options').hide();\n          this.$('a.option-selected').attr('aria-expanded', false);\n        });\n      }\n    }, this);\n  },\n});\n"],"names":["BaseDropDown","internal","views","components","$","document","click","e","$target","target","isDropdown","closest","length","hide","attr","extend","className","screenReaderText","factors","options","appState","get","factor","factorLabel","FactorUtil","findFactorInFactorsArray","provider","factorType","Factor","Model","toJSON","loc","events","preventDefault","_","result","stopPropagation","expanded","toggle","is","find","focus","initialize","addOption","FactorsDropDownOptions","getDropdownOption","factorsList","multiplePushFactors","hasMultipleFactorsOfSameType","each","model","listenTo","last"],"mappings":"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"}