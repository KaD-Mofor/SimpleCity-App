{"version":3,"file":"emailVerifyCallback.js","sources":["../../../../../src/v2/client/emailVerifyCallback.ts"],"sourcesContent":["/*!\n * Copyright (c) 2021-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { ProceedOptions } from '@okta/okta-auth-js';\n\nexport async function emailVerifyCallback(settings) {\n  const authClient = settings.getAuthClient();\n  const idxOptions: ProceedOptions = {\n    exchangeCodeForTokens: false, // we handle this in interactionCodeFlow.js\n  };\n  const meta = await authClient.idx.getSavedTransactionMeta(); // meta can load in another tab using state if it matches\n  if (!meta || !meta.interactionHandle) {\n    // Flow can not continue in this tab. Create a synthetic server response and use it to display a message to the user\n    const messages = {\n      type: 'array',\n      value: [\n        // terminal-return-otp-only-no-location.json\n        {\n          'message': 'Enter the OTP in your original browser or device.',\n          'i18n': {\n            'key': 'idx.enter.otp.in.original.tab'\n          },\n          'class': 'INFO'\n        }\n      ]\n    };\n\n    const resp = {\n      neededToProceed: [],\n      // OKTA-382410 so bad that has to leverage rawIdxState\n      rawIdxState: {\n        messages,\n      },\n      context: {\n        messages,\n      }\n    };\n    return resp;\n  }\n  \n  // Proceed using the OTP code\n  const otp = settings.get('otp');\n  const idxResponse = await authClient.idx.proceed({\n    ...idxOptions,\n    otp\n  });\n  return idxResponse;\n}\n"],"names":["emailVerifyCallback","settings","authClient","getAuthClient","idxOptions","exchangeCodeForTokens","meta","idx","getSavedTransactionMeta","interactionHandle","messages","type","value","resp","neededToProceed","rawIdxState","context","otp","get","idxResponse","proceed"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIO,eAAeA,mBAAmB,CAACC,QAAQ,EAAE;AAClD,EAAA,MAAMC,UAAU,GAAGD,QAAQ,CAACE,aAAa,EAAE,CAAA;AAC3C,EAAA,MAAMC,UAA0B,GAAG;IACjCC,qBAAqB,EAAE,KAAK;GAC7B,CAAA;;EACD,MAAMC,IAAI,GAAG,MAAMJ,UAAU,CAACK,GAAG,CAACC,uBAAuB,EAAE,CAAC;AAC5D,EAAA,IAAI,CAACF,IAAI,IAAI,CAACA,IAAI,CAACG,iBAAiB,EAAE;AACpC;AACA,IAAA,MAAMC,QAAQ,GAAG;AACfC,MAAAA,IAAI,EAAE,OAAO;AACbC,MAAAA,KAAK,EAAE;AACL;AACA,MAAA;AACE,QAAA,SAAS,EAAE,mDAAmD;AAC9D,QAAA,MAAM,EAAE;AACN,UAAA,KAAK,EAAE,+BAAA;SACR;AACD,QAAA,OAAO,EAAE,MAAA;OACV,CAAA;KAEJ,CAAA;AAED,IAAA,MAAMC,IAAI,GAAG;AACXC,MAAAA,eAAe,EAAE,EAAE;AACnB;AACAC,MAAAA,WAAW,EAAE;AACXL,QAAAA,QAAQ,EAARA,QAAAA;OACD;AACDM,MAAAA,OAAO,EAAE;AACPN,QAAAA,QAAQ,EAARA,QAAAA;AACF,OAAA;KACD,CAAA;AACD,IAAA,OAAOG,IAAI,CAAA;AACb,GAAA;;AAEA;AACA,EAAA,MAAMI,GAAG,GAAGhB,QAAQ,CAACiB,GAAG,CAAC,KAAK,CAAC,CAAA;EAC/B,MAAMC,WAAW,GAAG,MAAMjB,UAAU,CAACK,GAAG,CAACa,OAAO,CAAC;AAC/C,IAAA,GAAGhB,UAAU;AACba,IAAAA,GAAG,EAAHA,GAAAA;AACF,GAAC,CAAC,CAAA;AACF,EAAA,OAAOE,WAAW,CAAA;AACpB;;;;"}