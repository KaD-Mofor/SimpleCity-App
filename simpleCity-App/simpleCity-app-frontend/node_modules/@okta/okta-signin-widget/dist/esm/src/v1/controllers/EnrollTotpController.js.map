{"version":3,"file":"EnrollTotpController.js","sources":["../../../../../src/v1/controllers/EnrollTotpController.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, View, loc } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport FactorUtil from 'util/FactorUtil';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport StoreLinks from 'v1/util/StoreLinks';\nimport Footer from 'v1/views/enroll-factors/Footer';\nconst showWhenDeviceTypeSelected = {\n  __deviceType__: function(val) {\n    return val !== undefined;\n  },\n};\nconst EnrollTotpControllerAppDownloadInstructionsView = View.extend({\n  attributes: { 'data-se': 'app-download-instructions' },\n  className: 'app-download-instructions',\n  template: hbs(\n    '\\\n      <span class=\"app-logo {{appIcon}}\"></span>\\\n      <p class=\"instructions\">{{{appStoreLinkText}}}</p>\\\n    '\n  ),\n  initialize: function() {\n    this.listenTo(this.model, 'change:__deviceType__', this.render);\n  },\n  postRender: function() {\n    const link  = this.$el.find('.instructions a');\n    if (link.length) {\n      link[0].setAttribute('target', '_blank');\n      link[0].setAttribute('rel', 'noreferer noopener');\n    }\n  },\n  getTemplateData: function() {\n    let appStoreLink;\n    let appIcon;\n    let appStoreName;\n    const factorName = FactorUtil.getFactorLabel(this.model.get('__provider__'), this.model.get('__factorType__'));\n\n    appStoreName = StoreLinks.STORE[this.model.get('__deviceType__')];\n    if (this.model.get('__provider__') === 'GOOGLE') {\n      appStoreLink = StoreLinks.GOOGLE[this.model.get('__deviceType__')];\n      appIcon = 'google-auth-38';\n    } else {\n      appStoreLink = StoreLinks.OKTA[this.model.get('__deviceType__')];\n      appIcon = 'okta-verify-download-icon';\n    }\n    const appStoreLinkText = appStoreName\n      ? loc('enroll.totp.downloadApp', 'login', [appStoreLink, factorName, appStoreName])\n      : null;\n    return {\n      appStoreLinkText: appStoreLinkText,\n      appIcon: appIcon,\n    };\n  },\n});\nconst EnrollTotpControllerEnrollTotpController = FormController.extend({\n  className: 'enroll-totp',\n  Model: function() {\n    return {\n      local: {\n        __deviceType__: 'string',\n        __factorType__: ['string', false, this.options.factorType],\n        __provider__: ['string', false, this.options.provider],\n      },\n      save: function() {\n        return this.doTransaction(function(transaction) {\n          const factor = _.findWhere(transaction.factors, {\n            factorType: this.get('__factorType__'),\n            provider: this.get('__provider__'),\n          });\n\n          return factor.enroll();\n        });\n      },\n    };\n  },\n\n  Form: {\n    title: function() {\n      const factorName = FactorUtil.getFactorLabel(this.model.get('__provider__'), this.model.get('__factorType__'));\n\n      return loc('enroll.totp.title', 'login', [factorName]);\n    },\n    noButtonBar: true,\n    attributes: { 'data-se': 'step-device-type' },\n\n    formChildren: function() {\n      const inputOptions = {\n        APPLE: loc('iphone', 'login'),\n        ANDROID: loc('android', 'login'),\n      };\n      const children = [\n        FormType.Input({\n          name: '__deviceType__',\n          type: 'radio',\n          options: inputOptions,\n          group: true,\n          label: _.partial(loc, 'enroll.totp.selectDevice', 'login'),\n        }),\n        FormType.Divider({ showWhen: showWhenDeviceTypeSelected }),\n        FormType.View({\n          View: EnrollTotpControllerAppDownloadInstructionsView,\n          showWhen: showWhenDeviceTypeSelected,\n        }),\n        FormType.Button({\n          title: loc('oform.next', 'login'),\n          attributes: {\n            'data-type': 'save'\n          },\n          className: 'button button-primary default-custom-button',\n          click: function() {\n            this.model.save();\n          },\n          showWhen: showWhenDeviceTypeSelected,\n        }),\n      ];\n\n      return children;\n    },\n  },\n\n  Footer: Footer,\n});\nexport default EnrollTotpControllerEnrollTotpController;\n"],"names":["showWhenDeviceTypeSelected","__deviceType__","val","undefined","EnrollTotpControllerAppDownloadInstructionsView","View","extend","attributes","className","template","initialize","listenTo","model","render","postRender","link","$el","find","length","setAttribute","getTemplateData","appStoreLink","appIcon","appStoreName","factorName","FactorUtil","getFactorLabel","get","StoreLinks","STORE","GOOGLE","OKTA","appStoreLinkText","loc","EnrollTotpControllerEnrollTotpController","FormController","Model","local","__factorType__","options","factorType","__provider__","provider","save","doTransaction","transaction","factor","_","findWhere","factors","enroll","Form","title","noButtonBar","formChildren","inputOptions","APPLE","ANDROID","children","FormType","Input","name","type","group","label","partial","Divider","showWhen","Button","click","Footer"],"mappings":"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"}