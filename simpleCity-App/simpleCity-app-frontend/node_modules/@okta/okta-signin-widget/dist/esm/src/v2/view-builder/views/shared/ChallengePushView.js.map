{"version":3,"file":"ChallengePushView.js","sources":["../../../../../../../src/v2/view-builder/views/shared/ChallengePushView.js"],"sourcesContent":["// Common view for OV push and custom push.\nimport { loc, createButton, View } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport { BaseFormWithPolling } from '../../internals';\nimport polling from '../shared/polling';\nimport { WARNING_TIMEOUT } from '../../utils/Constants';\nimport BaseAuthenticatorView from '../../components/BaseAuthenticatorView';\nimport { AUTHENTICATOR_KEY } from '../../../ion/RemediationConstants';\n\nconst warningTemplate = View.extend({\n  className: 'okta-form-infobox-warning infobox infobox-warning',\n  template: hbs`\n    <span class=\"icon warning-16\"></span>\n    <p>{{warning}}</p>\n  `\n});\nconst Body = BaseFormWithPolling.extend(Object.assign(\n  {\n    noButtonBar: true,\n\n    title() {\n      return this.isOV() ? loc('oie.okta_verify.push.title', 'login') :\n        loc('oie.verify.custom_app.title', 'login', [this.options.appState.getAuthenticatorDisplayName()]);\n    },\n\n    initialize() {\n      BaseFormWithPolling.prototype.initialize.apply(this, arguments);\n      // 'hasSavingState' would be true by default.\n      // Setting it to false when auth key is okta_verify or custom_app with autochallenge schema\n      // So that 'o-form-saving' css class is not added while polling and checkbox remains enabled.\n      if ((this.isOV() || this.isCustomApp()) && this.isAutoChallengeSupported()) {\n        this.hasSavingState = false;\n      }\n      this.listenTo(this.model, 'error', this.stopPoll);\n      this.addView();\n    },\n\n    addView() {\n      this.add(createButton({\n        className: 'button button-wide button-primary send-push link-button-disabled',\n        title: this.isOV() ? loc('oie.okta_verify.push.sent', 'login') : loc('oie.custom_app.push.sent', 'login'),\n        click: (e) => {\n          e.preventDefault();\n        }\n      }));\n      this.add(\n        `<span class='accessibility-text' role='alert'>\n        ${this.isOV() ? loc('oie.okta_verify.push.sent', 'login') : loc('oie.custom_app.push.sent', 'login')}</span>`,\n      );\n    },\n\n    render() {\n      BaseFormWithPolling.prototype.render.apply(this, arguments);\n\n      const checkbox = this.$el.find('[data-se=\"o-form-fieldset-autoChallenge\"]');\n\n      if (!this.isAutoChallengeSupported()) {\n        checkbox.length && checkbox.hide();\n      } else if (this.isOV() || this.isCustomApp()) {\n        // Move checkbox below the button\n        // Checkbox is rendered by BaseForm using remediation response and\n        // hence by default always gets added above buttons.\n        checkbox.length && this.$el.find('.o-form-fieldset-container').append(checkbox);\n      }\n    },\n\n    postRender() {\n      BaseFormWithPolling.prototype.postRender.apply(this, arguments);\n\n      const className = this.isOV() ?\n        'okta-verify-push-challenge' : ' custom-app-push-challenge';\n      this.$el.addClass(className);\n      this.startPoll();\n    },\n\n    startPoll() {\n      this.startPolling();\n      this.warningTimeout = setTimeout(() => {\n        const warningText = this.isOV() ? loc('oktaverify.warning', 'login') :\n          loc('oie.custom_app.push.warning', 'login', [this.options.appState.getAuthenticatorDisplayName()]);\n        this.showWarning(warningText);\n      }, WARNING_TIMEOUT);\n    },\n\n    stopPoll() {\n      this.stopPolling();\n      this.clearWarning();\n    },\n\n    showWarning(msg) {\n      this.clearWarning();\n      this.add(warningTemplate, '.o-form-error-container', {options: {warning: msg}});\n    },\n\n    clearWarning() {\n      if (this.$('.o-form-error-container div').hasClass('okta-form-infobox-warning')) {\n        this.$('.okta-form-infobox-warning').remove();\n      }\n      clearTimeout(this.warningTimeout);\n    },\n\n    remove() {\n      BaseFormWithPolling.prototype.remove.apply(this, arguments);\n      this.stopPoll();\n    },\n\n    isOV() {\n      return this.options.appState.get('authenticatorKey') === AUTHENTICATOR_KEY.OV;\n    },\n\n    isCustomApp() {\n      return this.options.appState.get('authenticatorKey') === AUTHENTICATOR_KEY.CUSTOM_APP;\n    },\n\n    isAutoChallengeSupported() {\n      return (this.options.appState.getSchemaByName('autoChallenge') !== null &&\n        this.options.appState.getSchemaByName('autoChallenge') !== undefined);\n    }\n  },\n\n  polling,\n));\n\nconst AuthenticatorView = BaseAuthenticatorView.extend({\n  Body,\n});\n\nexport {\n  AuthenticatorView as default,\n  Body,\n};\n"],"names":["warningTemplate","View","extend","className","template","Body","BaseFormWithPolling","Object","assign","noButtonBar","title","isOV","loc","options","appState","getAuthenticatorDisplayName","initialize","prototype","apply","arguments","isCustomApp","isAutoChallengeSupported","hasSavingState","listenTo","model","stopPoll","addView","add","createButton","click","e","preventDefault","render","checkbox","$el","find","length","hide","append","postRender","addClass","startPoll","startPolling","warningTimeout","setTimeout","warningText","showWarning","WARNING_TIMEOUT","stopPolling","clearWarning","msg","warning","$","hasClass","remove","clearTimeout","get","AUTHENTICATOR_KEY","OV","CUSTOM_APP","getSchemaByName","undefined","polling","AuthenticatorView","BaseAuthenticatorView"],"mappings":"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"}