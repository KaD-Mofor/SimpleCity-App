{"version":3,"file":"EnrollAuthenticatorPasswordView.js","sources":["../../../../../../../src/v2/view-builder/views/password/EnrollAuthenticatorPasswordView.js"],"sourcesContent":["import { loc } from '@okta/courage';\nimport { BaseForm, BaseView } from '../../internals';\nimport BaseAuthenticatorView from '../../components/BaseAuthenticatorView';\nimport {\n  getPasswordComplexityDescriptionForHtmlList,\n  removeRequirementsFromError } from '../../utils/AuthenticatorUtil';\nimport { generatePasswordPolicyHtml } from './PasswordPolicyUtil';\n\nconst Body = BaseForm.extend({\n  title() {\n    return loc('oie.password.enroll.title', 'login');\n  },\n  save() {\n    return loc('oform.next', 'login');\n  },\n\n  initialize() {\n    BaseForm.prototype.initialize.apply(this, arguments);\n    const policy = this.getPasswordPolicySettings();\n    this.displayPasswordPolicy(policy);\n  },\n\n  displayPasswordPolicy(policy) {\n    if (policy) {\n      const rulesList = getPasswordComplexityDescriptionForHtmlList( policy );\n      generatePasswordPolicyHtml(this, rulesList, true);\n    }\n  },\n\n  triggerAfterError(model, error) {\n    error.responseJSON = removeRequirementsFromError(error.responseJSON);\n    this.options.appState.trigger('afterError', error);\n  },\n\n  getPasswordPolicySettings() {\n    // This will be overridden by following scenario since the policies could be different for those.\n    // - password reset (`ReEnrollAuthenticatorPasswordView.js`)\n    //\n    const relatesToObject = this.options.currentViewState.relatesTo;\n    return relatesToObject?.value?.settings;\n  },\n\n  getUISchema() {\n    const uiSchemas = BaseForm.prototype.getUISchema.apply(this, arguments);\n    const confirmPassword = {\n      name: 'confirmPassword',\n      label: loc('oie.password.confirmPasswordLabel','login'),\n      type: 'password',\n      'label-top': true,\n      params: {\n        showPasswordToggle: this.settings.get('showPasswordToggle'),\n      }\n    };\n\n    const updatedSchema = [];\n\n    for (let field of uiSchemas) {\n      updatedSchema.push(field);\n      if (field.name === 'credentials.passcode') {\n        updatedSchema.push(confirmPassword);\n      }\n    }\n\n    return updatedSchema;\n  }\n});\n\nexport default BaseAuthenticatorView.extend({\n\n  Body,\n\n  createModelClass() {\n    const ModelClass = BaseView.prototype.createModelClass.apply(this, arguments);\n    const local = Object.assign(\n      {\n        confirmPassword: {\n          type: 'string',\n          required: true,\n        }\n      },\n      ModelClass.prototype.local,\n    );\n    return ModelClass.extend({\n      local,\n      validate() {\n        if (this.get('credentials.passcode') !== this.get('confirmPassword') &&\n            this.get('credential.value') !== this.get('confirmPassword')) {\n          const errors = {\n            'confirmPassword': loc('password.error.match', 'login'),\n          };\n          return errors;\n        } else {\n          return null;\n        }\n      }\n    });\n  }\n});\n"],"names":["Body","BaseForm","extend","title","loc","save","initialize","prototype","apply","arguments","policy","getPasswordPolicySettings","displayPasswordPolicy","rulesList","getPasswordComplexityDescriptionForHtmlList","generatePasswordPolicyHtml","triggerAfterError","model","error","responseJSON","removeRequirementsFromError","options","appState","trigger","relatesToObject","currentViewState","relatesTo","value","settings","getUISchema","uiSchemas","confirmPassword","name","label","type","params","showPasswordToggle","get","updatedSchema","field","push","BaseAuthenticatorView","createModelClass","ModelClass","BaseView","local","Object","assign","required","validate","errors"],"mappings":"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"}