{"version":3,"file":"BaseLoginModel.js","sources":["../../../../../src/v1/models/BaseLoginModel.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, Model } from '@okta/courage';\nimport Q from 'q';\nimport Enums from 'util/Enums';\nconst KNOWN_ERRORS = ['OAuthError', 'AuthSdkError', 'AuthPollStopError', 'AuthApiError'];\nexport default Model.extend({\n  // May return either a \"standard\" promise or a Q promise\n  doTransaction: function(fn, rethrow) {\n    const self = this;\n\n    return fn\n      .call(this, this.appState.get('transaction'))\n      .then(function(trans) {\n        self.trigger('setTransaction', trans);\n        return trans;\n      })\n      .catch(function(err) {\n        // Q may still consider AuthPollStopError to be unhandled\n        if (\n          err.name === 'AuthPollStopError' ||\n          err.name === Enums.AUTH_STOP_POLL_INITIATION_ERROR ||\n          err.name === Enums.WEBAUTHN_ABORT_ERROR\n        ) {\n          return;\n        }\n        self.trigger('error', self, err.xhr);\n        self.trigger('setTransactionError', err);\n        if (rethrow || _.indexOf(KNOWN_ERRORS, err.name) === -1) {\n          throw err;\n        }\n      });\n  },\n\n  manageTransaction: function(fn) {\n    const self = this;\n    const res = fn.call(this, this.appState.get('transaction'), _.bind(this.setTransaction, this));\n\n    // If it's a promise, listen for failures\n    if (Q.isPromiseAlike(res)) {\n      return res.catch(function(err) {\n        if (\n          err.name === 'AuthPollStopError' ||\n          err.name === Enums.AUTH_STOP_POLL_INITIATION_ERROR ||\n          err.name === Enums.WEBAUTHN_ABORT_ERROR\n        ) {\n          return;\n        }\n        self.trigger('error', self, err.xhr);\n        self.trigger('setTransactionError', err);\n      });\n    }\n\n    return Q.resolve(res);\n  },\n\n  startTransaction: function(fn) {\n    const self = this;\n    const res = fn.call(this, this.settings.getAuthClient());\n\n    // If it's a promise, then chain to it\n    if (Q.isPromiseAlike(res)) {\n      return res\n        .then(function(trans) {\n          self.trigger('setTransaction', trans);\n          return trans;\n        })\n        .catch(function(err) {\n          self.trigger('error', self, err.xhr);\n          self.trigger('setTransactionError', err);\n          throw err;\n        });\n    }\n\n    return Q.resolve(res);\n  },\n\n  setTransaction: function(trans) {\n    this.appState.set('transaction', trans);\n  },\n});\n"],"names":["KNOWN_ERRORS","Model","extend","doTransaction","fn","rethrow","self","call","appState","get","then","trans","trigger","catch","err","name","Enums","AUTH_STOP_POLL_INITIATION_ERROR","WEBAUTHN_ABORT_ERROR","xhr","_","indexOf","manageTransaction","res","bind","setTransaction","Q","isPromiseAlike","resolve","startTransaction","settings","getAuthClient","set"],"mappings":"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"}