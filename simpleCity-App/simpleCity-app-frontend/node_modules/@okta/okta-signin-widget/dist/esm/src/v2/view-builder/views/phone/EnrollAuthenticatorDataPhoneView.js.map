{"version":3,"file":"EnrollAuthenticatorDataPhoneView.js","sources":["../../../../../../../src/v2/view-builder/views/phone/EnrollAuthenticatorDataPhoneView.js"],"sourcesContent":["import { _, loc, Model } from '@okta/courage';\nimport { BaseForm, BaseView } from '../../internals';\nimport BaseAuthenticatorView from '../../components/BaseAuthenticatorView';\nimport CountryUtil from '../../../../util/CountryUtil';\n\nconst Body = BaseForm.extend({\n\n  className: 'phone-authenticator-enroll',\n\n  title() {\n    return loc('oie.phone.enroll.title', 'login');\n  },\n\n  subtitle() {\n    return this.model.get('authenticator.methodType') === 'voice'\n      ? loc('oie.phone.enroll.call.subtitle', 'login')\n      : loc('oie.phone.enroll.sms.subtitle', 'login');\n  },\n\n  render() {\n    BaseForm.prototype.render.apply(this, arguments);\n    const selectedMethod = this.model.get('authenticator.methodType');\n    const phoneField = this.el.querySelector('.phone-authenticator-enroll__phone');\n    const extensionField = this.el.querySelector('.phone-authenticator-enroll__phone-ext');\n\n    if (selectedMethod === 'voice') {\n      if (!phoneField.classList.contains('phone-authenticator-enroll__phone--small')) {\n        phoneField.classList.add('phone-authenticator-enroll__phone--small');\n      }\n      extensionField.classList.remove('hide');\n    }\n\n    if (selectedMethod === 'sms') {\n      phoneField.classList.remove('phone-authenticator-enroll__phone--small');\n      if (!extensionField.classList.contains('hide')) {\n        extensionField.classList.add('hide');\n      }\n    }\n\n    this.el.querySelector('.phone-authenticator-enroll__phone-code').innerText = `+${this.model.get('phoneCode')}`;\n  },\n\n  handlePhoneCodeChange() {\n    const countryCodeField = this.el.querySelector('.phone-authenticator-enroll__phone-code');\n    countryCodeField.innerText = `+${this.model.get('phoneCode')}`;\n  },\n\n  save() {\n    return this.model.get('authenticator.methodType') === 'voice'\n      ? loc('oie.phone.call.primaryButton', 'login')\n      : loc('oie.phone.sms.primaryButton', 'login');\n  },\n\n  getUISchema() {\n    const uiSchemas = BaseForm.prototype.getUISchema.apply(this, arguments);\n\n    // TODO: Using underscore to support IE, replace with Array.prototype methods (find, findIndex) when IE\n    // support is removed\n    const phoneNumberUISchemaIndex = _.findIndex(uiSchemas, ({ name }) => name === 'authenticator.phoneNumber');\n\n    const countryUISchema = {\n      'label-top': true,\n      label: loc('country.label', 'login'),\n      type: 'select',\n      options: CountryUtil.getCountries(),\n      name: 'country',\n      wide: true,\n    };\n\n    const inputId = 'okta-phone-number-input';\n    \n    // Create an input group - serves as a display wrapper\n    const phoneNumberWithCodeUISchema = {\n      label: loc('mfa.phoneNumber.placeholder', 'login'),\n      inputId,\n      type: 'group',\n      modelType: 'string',\n      'label-top': true,\n      name: 'phoneCode',\n      className : 'phone-authenticator-enroll__phone',\n      input: [\n        {\n          type: 'label',\n          /* eslint-disable-next-line @okta/okta/no-unlocalized-text */\n          label: `+${this.model.get('phoneCode')}`,\n          className: 'phone-authenticator-enroll__phone-code no-translate',\n        },\n        Object.assign({ inputId }, uiSchemas[phoneNumberUISchemaIndex]),\n      ],\n    };\n\n    const extensionUISchema = {\n      label: loc('phone.extention.label', 'login'),\n      type: 'text',\n      // Need to manually hide and show\n      // - toggleWhen puts display: block on the element when it unhides hence can't be used.\n      //   Because in this case, the element needs to be rendered as an inline-block.\n      // - showWhen has an animation on the element when unhiding\n      //   The animation makes the element look weird because of the way it is positioned,\n      //   hence can't be used\n      className: 'phone-authenticator-enroll__phone-ext hide',\n      'label-top': true,\n      name: 'extension',\n    };\n\n    if (phoneNumberUISchemaIndex !== -1) {\n      // Replace phoneNumberUISchema..\n      uiSchemas.splice(phoneNumberUISchemaIndex, 1, phoneNumberWithCodeUISchema);\n      // Add countryUISchema before & extensionUISchema after phone..\n      uiSchemas.splice(phoneNumberUISchemaIndex, 0, countryUISchema);\n      uiSchemas.splice(phoneNumberUISchemaIndex + 2, 0, extensionUISchema);\n    }\n\n    const methodType = _.find(uiSchemas,  ({ name }) => name === 'authenticator.methodType');\n\n    if (methodType && methodType.options.length === 1) {\n      methodType.className = 'hide';\n    }\n\n    return uiSchemas;\n  },\n\n  initialize() {\n    BaseForm.prototype.initialize.apply(this, arguments);\n    this.listenTo(this.model, 'change:authenticator.methodType', this.render.bind(this));\n    this.listenTo(this.model, 'change:phoneCode', this.handlePhoneCodeChange.bind(this));\n  },\n});\n\nexport default BaseAuthenticatorView.extend({\n\n  Body,\n\n  createModelClass() {\n    const ModelClass = BaseView.prototype.createModelClass.apply(this, arguments);\n    const local = Object.assign(\n      {\n        country: {\n          'value': this.settings.get('defaultCountryCode'),\n          'type': 'string',\n        },\n        extension: {\n          'type': 'string',\n        },\n      },\n      ModelClass.prototype.local,\n    );\n    const derived = Object.assign(\n      {\n        phoneCode: {\n          deps: [ 'country' ],\n          fn: function(country) {\n            return CountryUtil.getCallingCodeForCountry(country);\n          },\n        },\n      },\n      ModelClass.prototype.derived,\n    );\n    return ModelClass.extend({\n      local,\n      derived,\n      toJSON: function() {\n        const modelJSON = Model.prototype.toJSON.call(this, arguments);\n        const extension = this.get('extension');\n        const phoneCode = this.get('phoneCode');\n\n        // Add country code..\n        let formattedPhoneNumber = `+${phoneCode}${modelJSON.authenticator.phoneNumber}`;\n\n        // Add extension if present..\n        if (modelJSON.authenticator.methodType === 'voice' && extension?.trim().length) {\n          formattedPhoneNumber = `${formattedPhoneNumber}x${extension}`;\n        }\n        // Override phone with formatted number..\n        modelJSON.authenticator.phoneNumber = formattedPhoneNumber;\n        return modelJSON;\n      },\n    });\n  },\n});\n"],"names":["Body","BaseForm","extend","className","title","loc","subtitle","model","get","render","prototype","apply","arguments","selectedMethod","phoneField","el","querySelector","extensionField","classList","contains","add","remove","innerText","handlePhoneCodeChange","countryCodeField","save","getUISchema","uiSchemas","phoneNumberUISchemaIndex","_","findIndex","name","countryUISchema","label","type","options","CountryUtil","getCountries","wide","inputId","phoneNumberWithCodeUISchema","modelType","input","Object","assign","extensionUISchema","splice","methodType","find","length","initialize","listenTo","bind","BaseAuthenticatorView","createModelClass","ModelClass","BaseView","local","country","settings","extension","derived","phoneCode","deps","fn","getCallingCodeForCountry","toJSON","modelJSON","Model","call","formattedPhoneNumber","authenticator","phoneNumber","trim"],"mappings":"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"}