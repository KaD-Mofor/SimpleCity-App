{"version":3,"file":"Util.js","sources":["../../../../src/util/Util.js"],"sourcesContent":["/* eslint-disable max-statements */\n/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint complexity: [2, 13], max-depth: [2, 3] */\nimport _ from 'underscore';\nimport { loc } from './loc';\nimport Enums from './Enums';\nimport Logger from './Logger';\nimport BrowserFeatures from './BrowserFeatures';\n\nconst Util = {};\nconst ovDeepLink = 'redirect_uri=https://login.okta.com/oauth/callback';\n\nconst buildInputForParameter = function(name, value) {\n  const input = document.createElement('input');\n\n  input.name = name;\n  input.value = decodeURIComponent(value);\n  input.type = 'hidden';\n  return input;\n};\n\nconst buildSubmitInput = function() {\n  const input = document.createElement('input');\n  input.type = 'submit';\n  return input;\n};\n\nconst buildDynamicForm = function(url = '', method) {\n  const splitOnFragment = url.split('#');\n  const fragment = splitOnFragment[1];\n  const splitOnQuery = (splitOnFragment[0] || '').split('?');\n  const query = splitOnQuery[1];\n  let targetUrl = splitOnQuery[0];\n\n  if (fragment) {\n    targetUrl += '#' + fragment;\n  }\n\n  const form = document.createElement('form');\n\n  form.method = method;\n  form.style.display = 'none';\n  form.action = targetUrl;\n  if (query && query.length) {\n    const queryParts = query.split('&');\n\n    queryParts.forEach(queryPart => {\n      const parameterParts = queryPart.split('=');\n      const input = buildInputForParameter(parameterParts[0], parameterParts[1]);\n\n      form.appendChild(input);\n    });\n  }\n  form.appendChild(buildSubmitInput());\n\n  return form;\n};\n\n// eslint-disable-next-line complexity\nUtil.transformErrorXHR = function(xhr) {\n  // Handle network connection error\n  if (xhr.status === 0 && _.isEmpty(xhr.responseJSON)) {\n    xhr.responseJSON = { errorSummary: loc('error.network.connection', 'login') };\n    return xhr;\n  }\n  if (!xhr.responseJSON) {\n    if (!xhr.responseText) {\n      // Empty server response\n      xhr.responseJSON = { errorSummary: loc('error.unsupported.response', 'login') };\n      return xhr;\n    }\n    if (typeof xhr.responseText === 'string') {\n      try {\n        xhr.responseJSON = JSON.parse(xhr.responseText);\n      } catch (e) {\n        // Malformed server response\n        xhr.responseJSON = { errorSummary: loc('error.unsupported.response', 'login') };\n        return xhr;\n      }\n    } else if (typeof xhr.responseText === 'object') {\n      xhr.responseJSON = xhr.responseText;\n    }\n  }\n  // Temporary solution to display field errors\n  // Assuming there is only one field error in a response\n  if (xhr.responseJSON && xhr.responseJSON.errorCauses && xhr.responseJSON.errorCauses.length) {\n    xhr.responseJSON.errorSummary = xhr.responseJSON.errorCauses[0].errorSummary;\n  }\n  // Replace error messages\n  if (!_.isEmpty(xhr.responseJSON)) {\n    const { errorCode } = xhr.responseJSON;\n    const untranslatedErrorCodes = [\n      // API already provides localized and factor specific error message in errorCauses\n      'E0000068',\n    ];\n    const errorMsg = errorCode && !untranslatedErrorCodes.includes(errorCode)\n      // We don't pass parameters to the `loc()` util\n      // However some i18n keys like `errors.E0000001` require one parameter\n      // Don't dispatch custom 'okta-i18n-error' event in this case\n      ? loc('errors.' + errorCode, 'login', [], true)\n      : undefined;\n\n    if (errorMsg?.indexOf('L10N_ERROR[') === -1) {\n      xhr.responseJSON.errorSummary = errorMsg;\n      if (xhr.responseJSON && xhr.responseJSON.errorCauses && xhr.responseJSON.errorCauses.length) {\n        // BaseForm will consume errorCauses before errorSummary if it is an array,\n        // so, we have to make sure to remove it when we have a valid error code\n        delete xhr.responseJSON.errorCauses;\n      }\n    }\n  }\n  return xhr;\n};\n\n// Simple helper function to lowercase all strings in the given array\nUtil.toLower = function(strings) {\n  return _.map(strings, function(str) {\n    return str.toLowerCase();\n  });\n};\n\n// A languageCode can be composed of multiple parts, i.e:\n// {{language}}-{{region}}-{{dialect}}\n//\n// In these cases, it's necessary to generate a list of other possible\n// combinations that we might support (in preferred order).\n//\n// For example:\n// en-US -> [en-US, en]\n// de-DE-bavarian -> [de-DE-bavarian, de-DE, de]\nfunction expandLanguage(language) {\n  const expanded = [language];\n  const parts = language.split('-');\n\n  while (parts.pop() && parts.length > 0) {\n    expanded.push(parts.join('-'));\n  }\n  return expanded;\n}\n\n// Following the rules of expanding one language, this will generate\n// all potential languages in the given order (where higher priority is\n// given to expanded languages over other downstream languages).\nUtil.expandLanguages = function(languages) {\n  return _.chain(languages).map(expandLanguage).flatten().uniq().value();\n};\n\n//helper to call setTimeout\nUtil.callAfterTimeout = function(callback, time) {\n  return setTimeout(callback, time);\n};\n\n// Helper function to provide consistent formatting of template literals\n// that are logged when in development mode.\nUtil.debugMessage = function(message) {\n  Logger.warn(`\\n${message.replace(/^(\\s)+/gm, '')}`);\n};\n\nUtil.logConsoleError = function(message) {\n  Logger.error(message);\n};\n\n// Trigger an afterError event\nUtil.triggerAfterError = function(controller, err = {}) {\n  if (!err.statusCode && err.xhr && err.xhr.status) {\n    // Bring the statusCode to the top-level of the Error\n    err.statusCode = err.xhr.status;\n  }\n  // Some controllers return the className as a function - process it here:\n  const className = _.isFunction(controller.className) ? controller.className() : controller.className;\n\n  const error = _.pick(err, 'name', 'message', 'statusCode', 'xhr');\n\n  controller.trigger('afterError', { controller: className }, error);\n  // Logs to console only in dev mode\n  Logger.warn('controller: ' + className + ', error: ' + error);\n};\n\nUtil.redirect = function(url, win = window, isAppLink = false) {\n  if (!url) {\n    Logger.error(`Cannot redirect to empty URL: (${url})`);\n    return;\n  }\n  if (BrowserFeatures.isAndroid() && !isAppLink) {\n    Util.redirectWithFormGet(url);\n  } else {\n    win.location.href = url;\n  }\n};\n\nUtil.isAndroidOVEnrollment = function() {\n  const ovEnrollment = decodeURIComponent(window.location.href).includes(ovDeepLink);\n  return BrowserFeatures.isAndroid() && ovEnrollment;\n};\n\n/**\n * Why redirect via Form get rather using `window.location.href`?\n * At the time of writing, Chrome (<72) in Android would block window location change\n * at following case\n * 1. An AJAX is trigger because of user action.\n * 2. 5+ seconds passed without any further user interaction.\n * 3. User takes an action results in window location change.\n *\n * Luckily we discovered that uses Form submit would work around this problem\n * even though it changed window location.\n *\n * Check the commit history for more details.\n */\nUtil.redirectWithFormGet = function(url) {\n  Util.redirectWithForm(url, 'get');\n};\n\nUtil.redirectWithForm = function(url, method = 'post') {\n  if (!url) {\n    Logger.error(`Cannot redirect to empty URL: (${url})`);\n    return;\n  }\n\n  const mainContainer = document.getElementById(Enums.WIDGET_CONTAINER_ID);\n\n  if (!mainContainer) {\n    Logger.error('Cannot find okta-sign-in container append to which a form');\n    return;\n  }\n\n  const form = buildDynamicForm(url, method);\n\n  mainContainer.appendChild(form);\n  form.querySelector('input[type=\"submit\"]').click();\n};\n\n/**\n * When we want to show an explain text, we need to check if this is different from\n * the label text, to not have an explain that look like a duplicated label.\n * okta-signin-widget gives the possibility to customize every i18n, so we cannot\n * know ahead if these two are equal or different, we need to call this function everytime.\n */\nUtil.createInputExplain = function(explainKey, labelKey, bundleName, explainParams, labelParams) {\n  const explain = explainParams ? loc(explainKey, bundleName, explainParams) : loc(explainKey, bundleName);\n  const label = labelParams ? loc(labelKey, bundleName, labelParams) : loc(labelKey, bundleName);\n\n  if (explain === label) {\n    return false;\n  }\n  return explain;\n};\n\nUtil.isV1StateToken = function(token) {\n  return !!(token && _.isString(token) && token.startsWith('00'));\n};\n\nUtil.getAutocompleteValue = function(settings, defaultValue) {\n  const shouldDisableAutocomplete = settings?.get('features.disableAutocomplete');\n  if (shouldDisableAutocomplete) {\n    return 'off';\n  }\n  return defaultValue;\n};\n\n/**\n * Equivalent of `new URLSearchParams(params).toString()` with broadest browser support.\n * Does not include params with nullish values.\n */\nUtil.searchParamsToString = function(params) {\n  return Object.keys(params)\n    .filter((key) => {\n      const val = params[key];\n      return val !== undefined && val !== null;\n    })\n    .map((key) => {\n      return encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);\n    })\n    .join('&');\n};\n\nexport default Util;\n"],"names":["Util","ovDeepLink","buildInputForParameter","name","value","input","document","createElement","decodeURIComponent","type","buildSubmitInput","buildDynamicForm","url","method","splitOnFragment","split","fragment","splitOnQuery","query","targetUrl","form","style","display","action","length","queryParts","forEach","queryPart","parameterParts","appendChild","transformErrorXHR","xhr","status","_","isEmpty","responseJSON","errorSummary","loc","responseText","JSON","parse","e","errorCauses","errorCode","untranslatedErrorCodes","errorMsg","includes","undefined","indexOf","toLower","strings","map","str","toLowerCase","expandLanguage","language","expanded","parts","pop","push","join","expandLanguages","languages","chain","flatten","uniq","callAfterTimeout","callback","time","setTimeout","debugMessage","message","Logger","warn","replace","logConsoleError","error","triggerAfterError","controller","err","statusCode","className","isFunction","pick","trigger","redirect","win","window","isAppLink","BrowserFeatures","isAndroid","redirectWithFormGet","location","href","isAndroidOVEnrollment","ovEnrollment","redirectWithForm","mainContainer","getElementById","Enums","WIDGET_CONTAINER_ID","querySelector","click","createInputExplain","explainKey","labelKey","bundleName","explainParams","labelParams","explain","label","isV1StateToken","token","isString","startsWith","getAutocompleteValue","settings","defaultValue","shouldDisableAutocomplete","get","searchParamsToString","params","Object","keys","filter","key","val","encodeURIComponent"],"mappings":"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"}