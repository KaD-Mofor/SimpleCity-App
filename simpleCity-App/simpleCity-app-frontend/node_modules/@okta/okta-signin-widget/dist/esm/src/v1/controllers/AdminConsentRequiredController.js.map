{"version":3,"file":"AdminConsentRequiredController.js","sources":["../../../../../src/v1/controllers/AdminConsentRequiredController.js"],"sourcesContent":["/*!\n * Copyright (c) 2020, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, View, loc } from '@okta/courage';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport ScopeList from 'v1/views/admin-consent/ScopeList';\nimport consentLogoHeaderTemplate from 'v1/views/shared/templates/consentLogoHeaderTemplate';\n\nconst ConsentModel = {\n  props: {\n    scopes: ['array', true]\n  },\n  save: function() {\n    return this.doTransaction(function(transaction) {\n      return transaction.consent({\n        consent: {\n          scopes: _.pluck(this.get('scopes'), 'name')\n        }\n      });\n    });\n  },\n  cancel: function() {\n    var self = this;\n    return this.doTransaction(function(transaction) {\n      return transaction.cancel();\n    }).then(function() {\n      var consentCancelFn = self.settings.get('consent.cancel');\n      if (_.isFunction(consentCancelFn)) {\n        consentCancelFn();\n      }\n    });\n  }\n};\n\nconst ConsentHeader = View.extend({\n  className: 'consent-title detail-row',\n  template: consentLogoHeaderTemplate,\n  getTemplateData: function() {\n    var appState = this.options.appState;\n    return {\n      appName: appState.escape('targetLabel'),\n      customLogo: appState.get('targetLogo') && appState.get('targetLogo').href,\n      defaultLogo: appState.get('defaultAppLogo'),\n      clientURI: appState.get('targetClientURI') && appState.get('targetClientURI').href,\n      issuer: appState.get('issuer'),\n    };\n  }\n});\n\nconst ConsentForm = {\n  noCancelButton: false,\n  buttonOrder: ['cancel', 'save'],\n  autoSave: true,\n  save: _.partial(loc, 'consent.required.consentButton', 'login'),\n  cancel: _.partial(loc, 'consent.required.cancelButton', 'login'),\n  formChildren: [\n    FormType.View({\n      View: ConsentHeader\n    }),\n    FormType.View({\n      View: ScopeList,\n    }),\n  ],\n};\n\nconst AdminConsentRequiredController = FormController.extend({\n  Model: ConsentModel,\n\n  Form: ConsentForm,\n\n  className: 'admin-consent-required',\n\n  initialize: function() {\n    this.model.set('scopes', this.options.appState.get('scopes'));\n    this.listenTo(this.form, 'cancel', () => {\n      this.model.cancel();\n    });\n  },\n});\n\nexport default AdminConsentRequiredController;\n"],"names":["ConsentModel","props","scopes","save","doTransaction","transaction","consent","_","pluck","get","cancel","self","then","consentCancelFn","settings","isFunction","ConsentHeader","View","extend","className","template","consentLogoHeaderTemplate","getTemplateData","appState","options","appName","escape","customLogo","href","defaultLogo","clientURI","issuer","ConsentForm","noCancelButton","buttonOrder","autoSave","partial","loc","formChildren","FormType","ScopeList","AdminConsentRequiredController","FormController","Model","Form","initialize","model","set","listenTo","form"],"mappings":"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"}