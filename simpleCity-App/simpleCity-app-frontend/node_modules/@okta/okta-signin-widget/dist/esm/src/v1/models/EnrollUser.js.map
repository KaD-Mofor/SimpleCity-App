{"version":3,"file":"EnrollUser.js","sources":["../../../../../src/v1/models/EnrollUser.js"],"sourcesContent":["/*!\n * Copyright (c) 2019, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the 'License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, loc } from '@okta/courage';\nimport BaseLoginModel from './BaseLoginModel';\nexport default BaseLoginModel.extend({\n  initialize: function(options) {\n    this.options = options || {};\n    this.appState = this.options.appState;\n  },\n  constructPostData: function(profileAttributes) {\n    const postData = {\n      registration: {\n        profile: profileAttributes,\n      },\n    };\n\n    // send createNewAccount flag for new user creation\n    if (this.appState.get('policy').registration.createNewAccount) {\n      postData.registration['createNewAccount'] = true;\n    }\n    return postData;\n  },\n  getEnrollFormData: function() {\n    return this.manageTransaction(function(transaction, setTransaction) {\n      return transaction.enroll().then(function(trans) {\n        setTransaction(trans);\n      });\n    });\n  },\n  save: function() {\n    let data = BaseLoginModel.prototype.toJSON.apply(this, arguments);\n\n    data = _.omit(data, ['appState', 'settings', 'createNewAccount']);\n    if (_.isEmpty(data)) {\n      const error = {\n        errorSummary: loc('oform.errorbanner.title', 'login'),\n      };\n\n      this.trigger('error', this, {\n        responseJSON: error,\n      });\n    } else {\n      return this.manageTransaction(function(transaction, setTransaction) {\n        transaction.enroll(this.constructPostData(data)).then(function(trans) {\n          setTransaction(trans);\n        });\n      });\n    }\n  },\n});\n"],"names":["BaseLoginModel","extend","initialize","options","appState","constructPostData","profileAttributes","postData","registration","profile","get","createNewAccount","getEnrollFormData","manageTransaction","transaction","setTransaction","enroll","then","trans","save","data","prototype","toJSON","apply","arguments","_","omit","isEmpty","error","errorSummary","loc","trigger","responseJSON"],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA,iBAAeA,cAAc,CAACC,MAAM,CAAC;EACnCC,UAAU,EAAE,UAASC,OAAO,EAAE;AAC5B,IAAA,IAAI,CAACA,OAAO,GAAGA,OAAO,IAAI,EAAE,CAAA;AAC5B,IAAA,IAAI,CAACC,QAAQ,GAAG,IAAI,CAACD,OAAO,CAACC,QAAQ,CAAA;GACtC;EACDC,iBAAiB,EAAE,UAASC,iBAAiB,EAAE;AAC7C,IAAA,MAAMC,QAAQ,GAAG;AACfC,MAAAA,YAAY,EAAE;AACZC,QAAAA,OAAO,EAAEH,iBAAAA;AACX,OAAA;KACD,CAAA;;AAED;AACA,IAAA,IAAI,IAAI,CAACF,QAAQ,CAACM,GAAG,CAAC,QAAQ,CAAC,CAACF,YAAY,CAACG,gBAAgB,EAAE;AAC7DJ,MAAAA,QAAQ,CAACC,YAAY,CAAC,kBAAkB,CAAC,GAAG,IAAI,CAAA;AAClD,KAAA;AACA,IAAA,OAAOD,QAAQ,CAAA;GAChB;AACDK,EAAAA,iBAAiB,EAAE,YAAW;IAC5B,OAAO,IAAI,CAACC,iBAAiB,CAAC,UAASC,WAAW,EAAEC,cAAc,EAAE;MAClE,OAAOD,WAAW,CAACE,MAAM,EAAE,CAACC,IAAI,CAAC,UAASC,KAAK,EAAE;QAC/CH,cAAc,CAACG,KAAK,CAAC,CAAA;AACvB,OAAC,CAAC,CAAA;AACJ,KAAC,CAAC,CAAA;GACH;AACDC,EAAAA,IAAI,EAAE,YAAW;AACf,IAAA,IAAIC,IAAI,GAAGpB,cAAc,CAACqB,SAAS,CAACC,MAAM,CAACC,KAAK,CAAC,IAAI,EAAEC,SAAS,CAAC,CAAA;AAEjEJ,IAAAA,IAAI,GAAGK,cAAC,CAACC,IAAI,CAACN,IAAI,EAAE,CAAC,UAAU,EAAE,UAAU,EAAE,kBAAkB,CAAC,CAAC,CAAA;AACjE,IAAA,IAAIK,cAAC,CAACE,OAAO,CAACP,IAAI,CAAC,EAAE;AACnB,MAAA,MAAMQ,KAAK,GAAG;AACZC,QAAAA,YAAY,EAAEC,GAAG,CAAC,yBAAyB,EAAE,OAAO,CAAA;OACrD,CAAA;AAED,MAAA,IAAI,CAACC,OAAO,CAAC,OAAO,EAAE,IAAI,EAAE;AAC1BC,QAAAA,YAAY,EAAEJ,KAAAA;AAChB,OAAC,CAAC,CAAA;AACJ,KAAC,MAAM;MACL,OAAO,IAAI,CAACf,iBAAiB,CAAC,UAASC,WAAW,EAAEC,cAAc,EAAE;AAClED,QAAAA,WAAW,CAACE,MAAM,CAAC,IAAI,CAACX,iBAAiB,CAACe,IAAI,CAAC,CAAC,CAACH,IAAI,CAAC,UAASC,KAAK,EAAE;UACpEH,cAAc,CAACG,KAAK,CAAC,CAAA;AACvB,SAAC,CAAC,CAAA;AACJ,OAAC,CAAC,CAAA;AACJ,KAAA;AACF,GAAA;AACF,CAAC,CAAC;;;;"}