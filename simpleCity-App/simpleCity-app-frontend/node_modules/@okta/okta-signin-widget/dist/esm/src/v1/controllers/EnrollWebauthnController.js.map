{"version":3,"file":"EnrollWebauthnController.js","sources":["../../../../../src/v1/controllers/EnrollWebauthnController.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, loc, View } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport Q from 'q';\nimport BrowserFeatures from 'util/BrowserFeatures';\nimport CryptoUtil from 'util/CryptoUtil';\nimport { WebauthnAbortError, WebAuthnError } from 'util/Errors';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport webauthn from 'util/webauthn';\nimport Footer from 'v1/views/enroll-factors/Footer';\nimport HtmlErrorMessageView from 'v1/views/mfa-verify/HtmlErrorMessageView';\n\nfunction getExcludeCredentials(credentials) {\n  const excludeCredentials = [];\n\n  _.each(credentials, function(credential) {\n    excludeCredentials.push({\n      type: 'public-key',\n      id: CryptoUtil.strToBin(credential.id),\n    });\n  });\n  return excludeCredentials;\n}\n\nexport default FormController.extend({\n  className: 'enroll-webauthn',\n  Model: {\n    local: {\n      __enrolled__: 'boolean',\n    },\n\n    save: function() {\n      this.trigger('request');\n\n      if (this.get('__enrolled__')) {\n        return this.activate();\n      }\n\n      return this.doTransaction(function(transaction) {\n        const factor = _.findWhere(transaction.factors, {\n          factorType: 'webauthn',\n          provider: 'FIDO',\n        });\n\n        return factor.enroll();\n      });\n    },\n\n    activate: function() {\n      this.set('__enrolled__', true);\n      this.trigger('errors:clear');\n      this.appState.on('backToFactors', () => {\n        if (this.webauthnAbortController) {\n          this.webauthnAbortController.abort();\n          this.webauthnAbortController = null;\n        }\n      });\n\n      return this.doTransaction(function(transaction) {\n        const activation = transaction.factor.activation;\n        // enroll via browser webauthn js\n\n        const self = this;\n\n        if (webauthn.isNewApiAvailable()) {\n          const options = _.extend({}, activation, {\n            challenge: CryptoUtil.strToBin(activation.challenge),\n            user: {\n              id: CryptoUtil.strToBin(activation.user.id),\n              name: activation.user.name,\n              displayName: activation.user.displayName,\n            },\n            excludeCredentials: getExcludeCredentials(activation.excludeCredentials),\n          });\n\n          // AbortController is not supported in IE11\n          if (typeof AbortController !== 'undefined') {\n            self.webauthnAbortController = new AbortController();\n          }\n          return new Q(\n            navigator.credentials.create({\n              publicKey: options,\n              signal: self.webauthnAbortController && self.webauthnAbortController.signal,\n            })\n          )\n            .then(function(newCredential) {\n              return transaction.activate({\n                attestation: CryptoUtil.binToStr(newCredential.response.attestationObject),\n                clientData: CryptoUtil.binToStr(newCredential.response.clientDataJSON),\n                // example data: [\"nfc\", \"usb\"]\n                transports: webauthn.processWebAuthnResponse(newCredential.response.getTransports,\n                  newCredential.response),\n                // example data: {\"credProps\":{\"rk\":true}}\n                clientExtensions: webauthn.processWebAuthnResponse(newCredential.getClientExtensionResults,\n                  newCredential)\n              });\n            })\n            .catch(function(error) {\n              self.trigger('errors:clear');\n              // Do not display if it is abort error triggered by code when switching.\n              // self.webauthnAbortController would be null if abort was triggered by code.\n              if (!self.webauthnAbortController) {\n                throw new WebauthnAbortError();\n              } else {\n                throw new WebAuthnError({\n                  xhr: { responseJSON: { errorSummary: error.message } },\n                });\n              }\n            })\n            .finally(function() {\n              // unset webauthnAbortController on successful authentication or error\n              self.webauthnAbortController = null;\n            });\n        }\n      });\n    },\n  },\n\n  Form: {\n    title: _.partial(loc, 'enroll.webauthn.biometric.title', 'login'),\n    save: _.partial(loc, 'enroll.webauthn.save', 'login'),\n    noCancelButton: true,\n    hasSavingState: false,\n    autoSave: true,\n    className: 'enroll-webauthn-form',\n    noButtonBar: function() {\n      return !webauthn.isNewApiAvailable();\n    },\n    modelEvents: {\n      request: '_startEnrollment',\n      error: '_stopEnrollment',\n    },\n    formChildren: function() {\n      const children = [];\n\n      if (webauthn.isNewApiAvailable()) {\n        //enroll.webauthn.biometric.instructions.edge is unescaped because it contains html\n        children.push(\n          FormType.View({\n            View: View.extend({\n              className: 'webauthn-enroll-text',\n              template: hbs(\n                '\\\n                <div class=\"webauthn-enroll-instructions\">\\\n                  <p>{{i18n code=\"enroll.webauthn.biometric.instructions\" bundle=\"login\"}}</p>\\\n                </div>\\\n                {{#if isEdge}}\\\n                  <div class=\"webauthn-edge-text\">\\\n                     <p>{{{i18n code=\"enroll.webauthn.biometric.instructions.edge\" bundle=\"login\"}}}</p>\\\n                  </div>\\\n                {{/if}}\\\n                {{#if onlySupportsSecurityKey}}\\\n                  <div class=\"webauthn-restrictions-text\">\\\n                     <p>{{{i18n code=\"enroll.webauthn.instructions.noSupportForBiometric\" bundle=\"login\"}}}</p>\\\n                  </div>\\\n                {{/if}}\\\n                <div data-se=\"webauthn-waiting\" class=\"okta-waiting-spinner hide\"></div>\\\n              '\n              ),\n              getTemplateData: function() {\n                return {\n                  isEdge: BrowserFeatures.isEdge(),\n                  onlySupportsSecurityKey: (BrowserFeatures.isFirefox() || BrowserFeatures.isSafari()) &&\n                    BrowserFeatures.isMac(),\n                };\n              },\n            }),\n          })\n        );\n      } else {\n        let errorMessageKey = 'webauthn.biometric.error.factorNotSupported';\n\n        if (this.options.appState.get('factors').length === 1) {\n          errorMessageKey = 'webauthn.biometric.error.factorNotSupported.oneFactor';\n        }\n        children.push(\n          FormType.View(\n            { View: new HtmlErrorMessageView({ message: loc(errorMessageKey, 'login') }) },\n            { selector: '.o-form-error-container' }\n          )\n        );\n      }\n\n      return children;\n    },\n\n    _startEnrollment: function() {\n      this.$('.okta-waiting-spinner').show();\n      this.$('.o-form-button-bar').hide();\n    },\n\n    _stopEnrollment: function() {\n      this.$('.okta-waiting-spinner').hide();\n      this.$('.o-form-button-bar').show();\n    },\n  },\n\n  Footer: Footer,\n\n  trapAuthResponse: function() {\n    if (this.options.appState.get('isMfaEnrollActivate')) {\n      this.model.activate();\n      return true;\n    }\n  },\n});\n"],"names":["getExcludeCredentials","credentials","excludeCredentials","_","each","credential","push","type","id","CryptoUtil","strToBin","FormController","extend","className","Model","local","__enrolled__","save","trigger","get","activate","doTransaction","transaction","factor","findWhere","factors","factorType","provider","enroll","set","appState","on","webauthnAbortController","abort","activation","self","webauthn","isNewApiAvailable","options","challenge","user","name","displayName","AbortController","Q","navigator","create","publicKey","signal","then","newCredential","attestation","binToStr","response","attestationObject","clientData","clientDataJSON","transports","processWebAuthnResponse","getTransports","clientExtensions","getClientExtensionResults","catch","error","WebauthnAbortError","WebAuthnError","xhr","responseJSON","errorSummary","message","finally","Form","title","partial","loc","noCancelButton","hasSavingState","autoSave","noButtonBar","modelEvents","request","formChildren","children","FormType","View","template","getTemplateData","isEdge","BrowserFeatures","onlySupportsSecurityKey","isFirefox","isSafari","isMac","errorMessageKey","length","HtmlErrorMessageView","selector","_startEnrollment","$","show","hide","_stopEnrollment","Footer","trapAuthResponse","model"],"mappings":"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"}