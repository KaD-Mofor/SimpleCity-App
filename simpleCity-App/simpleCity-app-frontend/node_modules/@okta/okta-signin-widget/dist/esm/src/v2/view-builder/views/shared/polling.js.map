{"version":3,"file":"polling.js","sources":["../../../../../../../src/v2/view-builder/views/shared/polling.js"],"sourcesContent":["import { _ } from '@okta/courage';\nimport { MS_PER_SEC } from '../../utils/Constants';\n\nexport default {\n  startPolling(newRefreshInterval) {\n    this.fixedPollingInterval = this.options.currentViewState.refresh;\n    this.dynamicPollingInterval = newRefreshInterval;\n    this.countDownCounterValue = Math.ceil(this.pollingInterval / MS_PER_SEC);\n    // Poll is present in remediation form\n    if (this.fixedPollingInterval) {\n      this._startRemediationPolling();\n    } else {\n      // Poll is present in authenticator/ authenticator Enrollment obj.\n      // Authenticator won't co-exists hence it's safe to trigger both.\n      this._startAuthenticatorPolling();\n    }\n  },\n\n  _startAuthenticatorPolling() {\n    // Authenticator won't co-exists hence it's safe to trigger both.\n    [\n      'currentAuthenticator',\n      'currentAuthenticatorEnrollment',\n    ].some(responseKey => {\n      if (this.options.appState.has(responseKey)) {\n        const authenticator = this.options.appState.get(responseKey);\n        const authenticatorPollAction = `${responseKey}-poll`;\n        const pollInterval = this.dynamicPollingInterval || authenticator?.poll?.refresh;\n        if (_.isNumber(pollInterval)) {\n          this.polling = setTimeout(()=>{\n            this.options.appState.trigger('invokeAction', authenticatorPollAction);\n          }, pollInterval);\n        }\n        return true;\n      } else {\n        return false;\n      }\n    });\n  },\n\n  _startRemediationPolling() {\n    const pollInterval = this.dynamicPollingInterval || this.fixedPollingInterval;\n    if (_.isNumber(pollInterval)) {\n      this.polling = setTimeout(() => {\n        this.options.appState.trigger('saveForm', this.model);\n      }, pollInterval);\n    }\n  },\n\n  stopPolling() {\n    if (this.polling) {\n      clearTimeout(this.polling);\n      this.polling = null;\n    }\n  }\n};\n"],"names":["startPolling","newRefreshInterval","fixedPollingInterval","options","currentViewState","refresh","dynamicPollingInterval","countDownCounterValue","Math","ceil","pollingInterval","MS_PER_SEC","_startRemediationPolling","_startAuthenticatorPolling","some","responseKey","appState","has","authenticator","get","authenticatorPollAction","pollInterval","poll","_","isNumber","polling","setTimeout","trigger","model","stopPolling","clearTimeout"],"mappings":";;;;;;;;;;;;AAGA,cAAe;EACbA,YAAY,EAAA,UAACC,kBAAkB,EAAE;IAC/B,IAAI,CAACC,oBAAoB,GAAG,IAAI,CAACC,OAAO,CAACC,gBAAgB,CAACC,OAAO,CAAA;IACjE,IAAI,CAACC,sBAAsB,GAAGL,kBAAkB,CAAA;AAChD,IAAA,IAAI,CAACM,qBAAqB,GAAGC,IAAI,CAACC,IAAI,CAAC,IAAI,CAACC,eAAe,GAAGC,UAAU,CAAC,CAAA;AACzE;IACA,IAAI,IAAI,CAACT,oBAAoB,EAAE;MAC7B,IAAI,CAACU,wBAAwB,EAAE,CAAA;AACjC,KAAC,MAAM;AACL;AACA;MACA,IAAI,CAACC,0BAA0B,EAAE,CAAA;AACnC,KAAA;GACD;AAEDA,EAAAA,0BAA0B,EAAG,YAAA;AAC3B;IACA,CACE,sBAAsB,EACtB,gCAAgC,CACjC,CAACC,IAAI,CAACC,WAAW,IAAI;MACpB,IAAI,IAAI,CAACZ,OAAO,CAACa,QAAQ,CAACC,GAAG,CAACF,WAAW,CAAC,EAAE;AAAA,QAAA,IAAA,mBAAA,CAAA;QAC1C,MAAMG,aAAa,GAAG,IAAI,CAACf,OAAO,CAACa,QAAQ,CAACG,GAAG,CAACJ,WAAW,CAAC,CAAA;AAC5D,QAAA,MAAMK,uBAAuB,GAAI,CAAEL,EAAAA,WAAY,CAAM,KAAA,CAAA,CAAA;AACrD,QAAA,MAAMM,YAAY,GAAG,IAAI,CAACf,sBAAsB,KAAIY,aAAa,KAAbA,IAAAA,IAAAA,aAAa,8CAAbA,aAAa,CAAEI,IAAI,MAAA,IAAA,IAAA,mBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAnB,oBAAqBjB,OAAO,CAAA,CAAA;AAChF,QAAA,IAAIkB,cAAC,CAACC,QAAQ,CAACH,YAAY,CAAC,EAAE;AAC5B,UAAA,IAAI,CAACI,OAAO,GAAGC,UAAU,CAAC,MAAI;YAC5B,IAAI,CAACvB,OAAO,CAACa,QAAQ,CAACW,OAAO,CAAC,cAAc,EAAEP,uBAAuB,CAAC,CAAA;WACvE,EAAEC,YAAY,CAAC,CAAA;AAClB,SAAA;AACA,QAAA,OAAO,IAAI,CAAA;AACb,OAAC,MAAM;AACL,QAAA,OAAO,KAAK,CAAA;AACd,OAAA;AACF,KAAC,CAAC,CAAA;GACH;AAEDT,EAAAA,wBAAwB,EAAG,YAAA;IACzB,MAAMS,YAAY,GAAG,IAAI,CAACf,sBAAsB,IAAI,IAAI,CAACJ,oBAAoB,CAAA;AAC7E,IAAA,IAAIqB,cAAC,CAACC,QAAQ,CAACH,YAAY,CAAC,EAAE;AAC5B,MAAA,IAAI,CAACI,OAAO,GAAGC,UAAU,CAAC,MAAM;AAC9B,QAAA,IAAI,CAACvB,OAAO,CAACa,QAAQ,CAACW,OAAO,CAAC,UAAU,EAAE,IAAI,CAACC,KAAK,CAAC,CAAA;OACtD,EAAEP,YAAY,CAAC,CAAA;AAClB,KAAA;GACD;AAEDQ,EAAAA,WAAW,EAAG,YAAA;IACZ,IAAI,IAAI,CAACJ,OAAO,EAAE;AAChBK,MAAAA,YAAY,CAAC,IAAI,CAACL,OAAO,CAAC,CAAA;MAC1B,IAAI,CAACA,OAAO,GAAG,IAAI,CAAA;AACrB,KAAA;AACF,GAAA;AACF,CAAC;;;;"}