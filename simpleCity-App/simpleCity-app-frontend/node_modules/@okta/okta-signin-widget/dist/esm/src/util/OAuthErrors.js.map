{"version":3,"file":"OAuthErrors.js","sources":["../../../../src/util/OAuthErrors.ts"],"sourcesContent":["import { loc } from './loc';\n\nimport { AuthSdkError, OAuthError as SdkOAuthError} from '@okta/okta-auth-js';\nimport { OAuthError } from './Errors';\nimport { ErrorDetails } from '../types/errors';\n\ntype ErrorTraits = 'inline' | 'terminal';\n\ntype ErrorType = {\n  [key in ErrorTraits]?: boolean;\n};\n\nclass InlineErrorType implements ErrorType {\n  inline = true;\n}\n\nclass TerminalErrorType implements ErrorType {\n  terminal = true;\n}\n\nclass TypedOAuthError<T extends ErrorType> extends OAuthError {\n  errorType: T;\n  orginalError: AuthSdkError | SdkOAuthError;\n  errorDetails: ErrorDetails\n\n  constructor(originalError: AuthSdkError | SdkOAuthError, errorTypeCtor: new () => T) {\n    super(originalError.message);\n    this.errorType = new errorTypeCtor();\n    this.orginalError = originalError;\n\n    this.errorDetails = {\n      errorSummary: this.getErrorSummary(),\n      errorCode: originalError.errorCode,\n      errorCauses: 'errorCauses' in originalError ? originalError.errorCauses : undefined,\n    }\n  }\n\n  protected getErrorSummary() {\n    return this.orginalError.errorSummary;\n  }\n\n  public is(errorTrait: ErrorTraits) {\n    return Boolean(Object.getOwnPropertyDescriptor(this.errorType, errorTrait as PropertyKey)?.value);\n  }\n}\n\nclass RecoverableError<T extends ErrorType> extends TypedOAuthError<T> {\n\n}\n\nclass NonRecoverableError<T extends ErrorType> extends TypedOAuthError<T> {\n\n}\n\nclass ClockDriftError extends RecoverableError<TerminalErrorType> {\n  constructor(error: AuthSdkError | SdkOAuthError) {\n    super(error, TerminalErrorType);\n  }\n\n  getErrorSummary(): string {\n    return loc('error.unsynced.clock', 'login');\n  }\n}\n\nclass UserNotAssignedError extends RecoverableError<InlineErrorType> {\n  constructor(error: AuthSdkError | SdkOAuthError) {\n    super(error, InlineErrorType);\n  }\n}\n\nclass JITProfileProvisioningError extends RecoverableError<InlineErrorType> {\n  constructor(error: AuthSdkError | SdkOAuthError) {\n    super(error, InlineErrorType);\n  }\n  getErrorSummary(): string {\n    return loc('error.jit_failure', 'login');\n  }\n}\n\nclass MfaRequiredError extends NonRecoverableError<InlineErrorType> {\n  constructor(error: AuthSdkError | SdkOAuthError) {\n    super(error, InlineErrorType);\n  }\n\n  getErrorSummary(): string {\n    return loc('error.mfa.required', 'login');\n  }\n}\n\nfunction getTypedOAuthError(error: AuthSdkError | SdkOAuthError) {\n  switch(error.errorCode) {\n    case 'access_denied':\n      return new UserNotAssignedError(error);\n\n    case 'jit_failure_missing_fields':\n    case 'jit_failure_invalid_login_format':\n    case 'jit_failure_values_not_match_pattern':\n    case 'jit_failure_values_too_long':\n    case 'jit_failure_invalid_locale':\n      return new JITProfileProvisioningError(error);\n\n    case 'login_required':\n      const mfaRequiredMsg = 'The client specified not to prompt, but the client app requires re-authentication or MFA.';\n      if (error.message === mfaRequiredMsg) {\n        return new MfaRequiredError(error);\n      }\n\n    case 'INTERNAL':\n      const clockDriftMsg = 'The JWT was issued in the future';\n      if (error.message === clockDriftMsg) {\n        return new ClockDriftError(error);\n      }\n\n    default:\n      return new RecoverableError(error, Object);\n  }\n}\n\nexport {\n  RecoverableError,\n  NonRecoverableError,\n  JITProfileProvisioningError,\n  ClockDriftError,\n  UserNotAssignedError,\n  MfaRequiredError,\n  TypedOAuthError,\n  getTypedOAuthError\n}\n"],"names":["InlineErrorType","inline","TerminalErrorType","terminal","TypedOAuthError","OAuthError","constructor","originalError","errorTypeCtor","message","errorType","orginalError","errorDetails","errorSummary","getErrorSummary","errorCode","errorCauses","undefined","is","errorTrait","Boolean","Object","getOwnPropertyDescriptor","value","RecoverableError","NonRecoverableError","ClockDriftError","error","loc","UserNotAssignedError","JITProfileProvisioningError","MfaRequiredError","getTypedOAuthError","mfaRequiredMsg","clockDriftMsg"],"mappings":";;;AAYA,MAAMA,eAAe,CAAsB;AAAA,EAAA,WAAA,GAAA;IAAA,IACzCC,CAAAA,MAAM,GAAG,IAAI,CAAA;AAAA,GAAA;AACf,CAAA;AAEA,MAAMC,iBAAiB,CAAsB;AAAA,EAAA,WAAA,GAAA;IAAA,IAC3CC,CAAAA,QAAQ,GAAG,IAAI,CAAA;AAAA,GAAA;AACjB,CAAA;AAEA,MAAMC,eAAe,SAA8BC,UAAU,CAAC;AAK5DC,EAAAA,WAAW,CAACC,aAA2C,EAAEC,aAA0B,EAAE;AACnF,IAAA,KAAK,CAACD,aAAa,CAACE,OAAO,CAAC,CAAA;AAAC,IAAA,IAAA,CAL/BC,SAAS,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CACTC,YAAY,GAAA,KAAA,CAAA,CAAA;AAAA,IAAA,IAAA,CACZC,YAAY,GAAA,KAAA,CAAA,CAAA;AAIV,IAAA,IAAI,CAACF,SAAS,GAAG,IAAIF,aAAa,EAAE,CAAA;IACpC,IAAI,CAACG,YAAY,GAAGJ,aAAa,CAAA;IAEjC,IAAI,CAACK,YAAY,GAAG;AAClBC,MAAAA,YAAY,EAAE,IAAI,CAACC,eAAe,EAAE;MACpCC,SAAS,EAAER,aAAa,CAACQ,SAAS;MAClCC,WAAW,EAAE,aAAa,IAAIT,aAAa,GAAGA,aAAa,CAACS,WAAW,GAAGC,SAAAA;KAC3E,CAAA;AACH,GAAA;AAEUH,EAAAA,eAAe,GAAG;AAC1B,IAAA,OAAO,IAAI,CAACH,YAAY,CAACE,YAAY,CAAA;AACvC,GAAA;EAEOK,EAAE,CAACC,UAAuB,EAAE;AAAA,IAAA,IAAA,qBAAA,CAAA;AACjC,IAAA,OAAOC,OAAO,CAAA,CAAA,qBAAA,GAACC,MAAM,CAACC,wBAAwB,CAAC,IAAI,CAACZ,SAAS,EAAES,UAAU,CAAgB,MAA1E,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qBAAA,CAA4EI,KAAK,CAAC,CAAA;AACnG,GAAA;AACF,CAAA;AAEA,MAAMC,gBAAgB,SAA8BpB,eAAe,CAAI,EAAA;AAIvE,MAAMqB,mBAAmB,SAA8BrB,eAAe,CAAI,EAAA;AAI1E,MAAMsB,eAAe,SAASF,gBAAgB,CAAoB;EAChElB,WAAW,CAACqB,KAAmC,EAAE;AAC/C,IAAA,KAAK,CAACA,KAAK,EAAEzB,iBAAiB,CAAC,CAAA;AACjC,GAAA;AAEAY,EAAAA,eAAe,GAAW;AACxB,IAAA,OAAOc,GAAG,CAAC,sBAAsB,EAAE,OAAO,CAAC,CAAA;AAC7C,GAAA;AACF,CAAA;AAEA,MAAMC,oBAAoB,SAASL,gBAAgB,CAAkB;EACnElB,WAAW,CAACqB,KAAmC,EAAE;AAC/C,IAAA,KAAK,CAACA,KAAK,EAAE3B,eAAe,CAAC,CAAA;AAC/B,GAAA;AACF,CAAA;AAEA,MAAM8B,2BAA2B,SAASN,gBAAgB,CAAkB;EAC1ElB,WAAW,CAACqB,KAAmC,EAAE;AAC/C,IAAA,KAAK,CAACA,KAAK,EAAE3B,eAAe,CAAC,CAAA;AAC/B,GAAA;AACAc,EAAAA,eAAe,GAAW;AACxB,IAAA,OAAOc,GAAG,CAAC,mBAAmB,EAAE,OAAO,CAAC,CAAA;AAC1C,GAAA;AACF,CAAA;AAEA,MAAMG,gBAAgB,SAASN,mBAAmB,CAAkB;EAClEnB,WAAW,CAACqB,KAAmC,EAAE;AAC/C,IAAA,KAAK,CAACA,KAAK,EAAE3B,eAAe,CAAC,CAAA;AAC/B,GAAA;AAEAc,EAAAA,eAAe,GAAW;AACxB,IAAA,OAAOc,GAAG,CAAC,oBAAoB,EAAE,OAAO,CAAC,CAAA;AAC3C,GAAA;AACF,CAAA;AAEA,SAASI,kBAAkB,CAACL,KAAmC,EAAE;EAC/D,QAAOA,KAAK,CAACZ,SAAS;AACpB,IAAA,KAAK,eAAe;AAClB,MAAA,OAAO,IAAIc,oBAAoB,CAACF,KAAK,CAAC,CAAA;AAExC,IAAA,KAAK,4BAA4B,CAAA;AACjC,IAAA,KAAK,kCAAkC,CAAA;AACvC,IAAA,KAAK,sCAAsC,CAAA;AAC3C,IAAA,KAAK,6BAA6B,CAAA;AAClC,IAAA,KAAK,4BAA4B;AAC/B,MAAA,OAAO,IAAIG,2BAA2B,CAACH,KAAK,CAAC,CAAA;AAE/C,IAAA,KAAK,gBAAgB;MACnB,MAAMM,cAAc,GAAG,2FAA2F,CAAA;AAClH,MAAA,IAAIN,KAAK,CAAClB,OAAO,KAAKwB,cAAc,EAAE;AACpC,QAAA,OAAO,IAAIF,gBAAgB,CAACJ,KAAK,CAAC,CAAA;AACpC,OAAA;AAEF,IAAA,KAAK,UAAU;MACb,MAAMO,aAAa,GAAG,kCAAkC,CAAA;AACxD,MAAA,IAAIP,KAAK,CAAClB,OAAO,KAAKyB,aAAa,EAAE;AACnC,QAAA,OAAO,IAAIR,eAAe,CAACC,KAAK,CAAC,CAAA;AACnC,OAAA;AAEF,IAAA;AACE,MAAA,OAAO,IAAIH,gBAAgB,CAACG,KAAK,EAAEN,MAAM,CAAC,CAAA;AAAC,GAAA;AAEjD;;;;"}