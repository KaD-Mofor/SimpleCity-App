{"version":3,"file":"SignInWithDeviceOption.js","sources":["../../../../../../../src/v2/view-builder/views/signin/SignInWithDeviceOption.js"],"sourcesContent":["import { View, createButton, loc } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport Util from '../../../../util/Util';\nimport Enums from '../../../../util/Enums';\nimport { UNIVERSAL_LINK_POST_DELAY } from '../../utils/Constants';\nimport { FORMS } from '../../../ion/RemediationConstants';\nimport { appendLoginHint } from '../../utils/ChallengeViewUtil';\n\nexport default View.extend({\n  className: 'sign-in-with-device-option',\n  template: hbs`\n    <div class=\"okta-verify-container\">\n    {{#if signInWithDeviceIsRequired}}\n      <div class=\"signin-with-ov-description\">\n      </div>\n    {{/if}}\n    </div>\n    {{#unless signInWithDeviceIsRequired}}\n    <div class=\"separation-line\">\n      <span>{{i18n code=\"authbutton.divider.text\" bundle=\"login\"}}</span>\n    </div>\n    {{/unless}}\n  `,\n  initialize() {\n    const appState = this.options.appState;\n    const deviceChallengePollRemediation = appState.hasRemediationObject(FORMS.LAUNCH_AUTHENTICATOR);\n    \n    const deviceChallenge = deviceChallengePollRemediation?.relatesTo?.value;\n    this.add(createButton({\n      className: 'button',\n      icon: 'okta-verify-authenticator',\n      title: loc('oktaVerify.button', 'login'),\n      click() {\n        if (this.model.get('identifier')) {\n          this.options.settings.set('identifier', encodeURIComponent(this.model.get('identifier')));\n        }\n\n        const isUVapproach = deviceChallenge?.challengeMethod === Enums.UNIVERSAL_LINK_CHALLENGE;\n        if (isUVapproach) {\n          // launch the Okta Verify app\n          let deviceChallengeUrl = appendLoginHint(deviceChallenge.href, this.options?.settings?.get('identifier'));\n          Util.redirect(deviceChallengeUrl);\n        }\n\n        const isAppLinkapproach = deviceChallenge?.challengeMethod === Enums.APP_LINK_CHALLENGE;\n        if (isAppLinkapproach) {\n          // launch the Okta Verify app\n          let deviceChallengeUrl = appendLoginHint(deviceChallenge.href, this.options?.settings?.get('identifier'));\n          Util.redirect(deviceChallengeUrl, window, true);\n        }\n\n        // OKTA-350084\n        // For the universal link (iOS) and app link (Android) approach,\n        // we need to 1. launch the Okta Verify app\n        // and 2. take the enduser to the next step right away\n        // In Safari, when Okta Verify app is not installed, step 1 responds with error immediately,\n        // then step 2 will respond with error.\n        // To avoid showing the error right before switching to the next UI,\n        // wait for 500 milliseconds before invoking step 2\n        Util.callAfterTimeout(() => {\n          if (this.options.isRequired) {\n            appState.trigger('saveForm', this.model);\n          } else {\n            appState.trigger('invokeAction', FORMS.LAUNCH_AUTHENTICATOR, {'rememberMe': this.model.get('rememberMe')});\n          }\n        }, isUVapproach || isAppLinkapproach ? UNIVERSAL_LINK_POST_DELAY : 0);\n      }\n    }), '.okta-verify-container');\n  },\n\n  getTemplateData() {\n    return {\n      signInWithDeviceIsRequired: !!this.options.isRequired,\n    };\n  },\n\n  postRender() {\n    if(this.options.isRequired) {\n      const appLabel = this.options.appState.attributes?.app?.label;\n      const resourceLabel = appLabel ? loc('oktaVerify.appDescription', 'login', [appLabel]) : \n        loc('oktaVerify.description', 'login');\n      const ovDescContainer = this.$el.find('.signin-with-ov-description');\n      ovDescContainer.text(resourceLabel);\n    }\n  }\n});\n"],"names":["View","extend","className","template","initialize","appState","options","deviceChallengePollRemediation","hasRemediationObject","FORMS","LAUNCH_AUTHENTICATOR","deviceChallenge","relatesTo","value","add","createButton","icon","title","loc","click","model","get","settings","set","encodeURIComponent","isUVapproach","challengeMethod","Enums","UNIVERSAL_LINK_CHALLENGE","deviceChallengeUrl","appendLoginHint","href","Util","redirect","isAppLinkapproach","APP_LINK_CHALLENGE","window","callAfterTimeout","isRequired","trigger","UNIVERSAL_LINK_POST_DELAY","getTemplateData","signInWithDeviceIsRequired","postRender","appLabel","attributes","app","label","resourceLabel","ovDescContainer","$el","find","text"],"mappings":"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"}