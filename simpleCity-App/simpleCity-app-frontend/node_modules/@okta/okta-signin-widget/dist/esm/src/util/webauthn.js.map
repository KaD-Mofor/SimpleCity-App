{"version":3,"file":"webauthn.js","sources":["../../../../src/util/webauthn.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport Q from 'q';\nimport FidoUtil from 'util/FidoUtil';\n\nfunction adaptToOkta(promise) {\n  return new Q(promise);\n}\n\nfunction makeCredential(accountInfo, cryptoParams, challenge) {\n  cryptoParams = cryptoParams.map(function(param) {\n    return { type: 'FIDO_2_0', algorithm: param.algorithm };\n  });\n\n  const promise = window.msCredentials.makeCredential(accountInfo, cryptoParams, challenge).then(function(cred) {\n    return Object.freeze({\n      credential: { id: cred.id },\n      publicKey: JSON.parse(cred.publicKey),\n      attestation: cred.attestation,\n    });\n  });\n\n  return adaptToOkta(promise);\n}\n\nfunction getAssertion(challenge, allowList) {\n  const accept = allowList.map(function(item) {\n    return { type: 'FIDO_2_0', id: item.id };\n  });\n  const filters = { accept: accept };\n  const promise = window.msCredentials.getAssertion(challenge, filters).then(function(attestation) {\n    const signature = attestation.signature;\n\n    return Object.freeze({\n      credential: { id: attestation.id },\n      clientData: signature.clientData,\n      authenticatorData: signature.authnrData,\n      signature: signature.signature,\n    });\n  });\n\n  return adaptToOkta(promise);\n}\n\nfunction processWebAuthnResponse(inputFunction, context) {\n  if (typeof inputFunction === 'undefined') {\n    return null;\n  }\n  const responseValue = inputFunction.apply(context);\n  if (responseValue === undefined || responseValue === null) {\n    return null;\n  }\n  return JSON.stringify(responseValue);\n}\n\nexport default {\n  makeCredential: makeCredential,\n  getAssertion: getAssertion,\n  processWebAuthnResponse: processWebAuthnResponse,\n  isAvailable: function() {\n    return Object.prototype.hasOwnProperty.call(window, 'msCredentials');\n  },\n  isNewApiAvailable: function() {\n    // navigator.credentials is not supported in IE11\n    // eslint-disable-next-line compat/compat\n    return navigator && navigator.credentials && navigator.credentials.create;\n  },\n  isWebauthnOrU2fAvailable: function() {\n    return this.isNewApiAvailable() || FidoUtil.isU2fAvailable();\n  },\n};\n"],"names":["adaptToOkta","promise","Q","makeCredential","accountInfo","cryptoParams","challenge","map","param","type","algorithm","window","msCredentials","then","cred","Object","freeze","credential","id","publicKey","JSON","parse","attestation","getAssertion","allowList","accept","item","filters","signature","clientData","authenticatorData","authnrData","processWebAuthnResponse","inputFunction","context","responseValue","apply","undefined","stringify","isAvailable","prototype","hasOwnProperty","call","isNewApiAvailable","navigator","credentials","create","isWebauthnOrU2fAvailable","FidoUtil","isU2fAvailable"],"mappings":"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"}