{"version":3,"file":"payloadTransformer.js","sources":["../../../../../src/v2/ion/payloadTransformer.js"],"sourcesContent":["/*!\n * Copyright (c) 2020, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { FORMS as RemediationForms } from './RemediationConstants';\n\nconst flattenObj = (obj) => {\n  let result = {};\n\n  Object.keys(obj).forEach((key) => {\n    if (typeof obj[key] !== 'object') {\n      result[key] = obj[key];\n      return;\n    }\n\n    const tempObj = flattenObj(obj[key]);\n    Object.keys(tempObj).forEach((j) => {\n      result[key + '.' + j] = tempObj[j];\n    });\n  });\n  return result;\n};\n\n/**\n * This function is for the Granular Consent remediation, scopes within the optedScopes\n * property can include a singular value or n values delimited by a \".\"\n * When they are delimited, BackBone's toJSON function will create a nested object, however,\n * these should not be nested and the delimited key names should stay as is. So this function will\n * flatten those nested proeprties to format it how the backend expects it. \n * i.e. { optedScopes: { some: { scope: true }}} = { optedScopes: { 'some.scope': true }}\n * Currently, this is only used when the Granular Consent view form is saved see:\n * src/v2/view-builder/views/consent/GranularConsentView.js\n * \n * @param {JSON} modelJSON JSON Equivalent of the Backbone Model's attributes/fields\n * @returns If the JSON contains the optedScopes Property, we will flatten the fields from\n * a nested object into K/V pair with dot notation for nested key names. Otherwise, we will return\n * the JSON as is.\n */\nconst transformOptedScopes = (modelJSON) => {\n  if (modelJSON.optedScopes && typeof modelJSON.optedScopes !== 'string') {\n    const data = {\n      ...modelJSON,\n      optedScopes: flattenObj(modelJSON.optedScopes),\n    };\n    return data;\n  }\n  return modelJSON;\n};\n\nconst FormNameToTransformerHandler = {\n  [RemediationForms.CONSENT_GRANULAR]: transformOptedScopes,\n};\n\n/**\n * The purpose of this function is the transform the\n * Backbone Model's attributes/fields into a JSON equivalent before sending to IDX,\n * since the Model fields are all flattend when the UI Schema is transformed on consumption.\n * \n * @param {string} formName Form name of the current remediation\n * @param {Model} model Backbone Model Class\n * @returns JSON equivalent of the Model\n */\nconst transformPayload = (formName, model) => {\n  const modelJSON = model.toJSON();\n  const transformHandler = FormNameToTransformerHandler[formName];\n  if (typeof transformHandler === 'undefined') {\n    return modelJSON;\n  }\n  return transformHandler(modelJSON);\n};\n\nexport default transformPayload;\n"],"names":["flattenObj","obj","result","Object","keys","forEach","key","tempObj","j","transformOptedScopes","modelJSON","optedScopes","data","FormNameToTransformerHandler","RemediationForms","CONSENT_GRANULAR","transformPayload","formName","model","toJSON","transformHandler"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA,MAAMA,UAAU,GAAIC,GAAG,IAAK;EAC1B,IAAIC,MAAM,GAAG,EAAE,CAAA;EAEfC,MAAM,CAACC,IAAI,CAACH,GAAG,CAAC,CAACI,OAAO,CAAEC,GAAG,IAAK;AAChC,IAAA,IAAI,OAAOL,GAAG,CAACK,GAAG,CAAC,KAAK,QAAQ,EAAE;AAChCJ,MAAAA,MAAM,CAACI,GAAG,CAAC,GAAGL,GAAG,CAACK,GAAG,CAAC,CAAA;AACtB,MAAA,OAAA;AACF,KAAA;IAEA,MAAMC,OAAO,GAAGP,UAAU,CAACC,GAAG,CAACK,GAAG,CAAC,CAAC,CAAA;IACpCH,MAAM,CAACC,IAAI,CAACG,OAAO,CAAC,CAACF,OAAO,CAAEG,CAAC,IAAK;MAClCN,MAAM,CAACI,GAAG,GAAG,GAAG,GAAGE,CAAC,CAAC,GAAGD,OAAO,CAACC,CAAC,CAAC,CAAA;AACpC,KAAC,CAAC,CAAA;AACJ,GAAC,CAAC,CAAA;AACF,EAAA,OAAON,MAAM,CAAA;AACf,CAAC,CAAA;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMO,oBAAoB,GAAIC,SAAS,IAAK;EAC1C,IAAIA,SAAS,CAACC,WAAW,IAAI,OAAOD,SAAS,CAACC,WAAW,KAAK,QAAQ,EAAE;AACtE,IAAA,MAAMC,IAAI,GAAG;AACX,MAAA,GAAGF,SAAS;AACZC,MAAAA,WAAW,EAAEX,UAAU,CAACU,SAAS,CAACC,WAAW,CAAA;KAC9C,CAAA;AACD,IAAA,OAAOC,IAAI,CAAA;AACb,GAAA;AACA,EAAA,OAAOF,SAAS,CAAA;AAClB,CAAC,CAAA;AAED,MAAMG,4BAA4B,GAAG;EACnC,CAACC,KAAgB,CAACC,gBAAgB,GAAGN,oBAAAA;AACvC,CAAC,CAAA;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMO,gBAAgB,GAAG,CAACC,QAAQ,EAAEC,KAAK,KAAK;AAC5C,EAAA,MAAMR,SAAS,GAAGQ,KAAK,CAACC,MAAM,EAAE,CAAA;AAChC,EAAA,MAAMC,gBAAgB,GAAGP,4BAA4B,CAACI,QAAQ,CAAC,CAAA;AAC/D,EAAA,IAAI,OAAOG,gBAAgB,KAAK,WAAW,EAAE;AAC3C,IAAA,OAAOV,SAAS,CAAA;AAClB,GAAA;EACA,OAAOU,gBAAgB,CAACV,SAAS,CAAC,CAAA;AACpC;;;;"}