{"version":3,"file":"InlineTOTPForm.js","sources":["../../../../../../src/v1/views/mfa-verify/InlineTOTPForm.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { loc, createButton, Form } from '@okta/courage';\nimport TextBox from 'v1/views/shared/TextBox';\n\nfunction addInlineTotp(form) {\n  form.addDivider();\n  form.addInput({\n    label: loc('mfa.challenge.enterCode.placeholder', 'login'),\n    'label-top': true,\n    className: 'o-form-fieldset o-form-label-top inline-input auth-passcode',\n    name: 'answer',\n    input: TextBox,\n    type: 'tel',\n  });\n  form.add(\n    createButton({\n      attributes: { 'data-se': 'inline-totp-verify' },\n      className: 'button inline-totp-verify margin-top-30',\n      title: loc('mfa.challenge.verify', 'login'),\n      click: function() {\n        form.clearErrors();\n        if (!form.isValid()) {\n          return;\n        }\n        form.model.manageTransaction(function(transaction, setTransaction) {\n          // This is the case where we enter the TOTP code and verify while there is an\n          // active Push request (or polling) running. We need to invoke previous() on authClient\n          // and then call model.save(). If not, we would still be in MFA_CHALLENGE state and\n          // verify would result in a wrong request (push verify instead of a TOTP verify).\n          if (transaction.status === 'MFA_CHALLENGE' && transaction.prev) {\n            form.options.appState.set('trapMfaRequiredResponse', true);\n            return transaction.prev().then(function(trans) {\n              setTransaction(trans);\n              form.model.save();\n            });\n          } else {\n            // Push is not active and we enter the code to verify.\n            form.model.save();\n          }\n        });\n      },\n    })\n  );\n  form.at(1).focus();\n}\n\nexport default Form.extend({\n  autoSave: true,\n  noButtonBar: true,\n  scrollOnError: false,\n  layout: 'o-form-theme',\n\n  className: 'mfa-verify-totp-inline',\n\n  attributes: { 'data-se': 'factor-inline-totp' },\n\n  initialize: function() {\n    const form = this;\n\n    this.listenTo(this.model, 'error', function() {\n      this.clearErrors();\n    });\n    this.add(\n      createButton({\n        className: 'link',\n        attributes: { 'data-se': 'inline-totp-add' },\n        title: loc('mfa.challenge.orEnterCode', 'login'),\n        click: function() {\n          this.remove();\n          addInlineTotp(form);\n        },\n      })\n    );\n  },\n});\n"],"names":["addInlineTotp","form","addDivider","addInput","label","loc","className","name","input","TextBox","type","add","createButton","attributes","title","click","clearErrors","isValid","model","manageTransaction","transaction","setTransaction","status","prev","options","appState","set","then","trans","save","at","focus","Form","extend","autoSave","noButtonBar","scrollOnError","layout","initialize","listenTo","remove"],"mappings":"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"}