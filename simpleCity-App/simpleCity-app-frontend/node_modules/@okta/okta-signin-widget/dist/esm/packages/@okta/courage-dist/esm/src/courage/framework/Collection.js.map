{"version":3,"file":"Collection.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/framework/Collection.js"],"sourcesContent":["import oktaUnderscore from '../util/underscore-wrapper.js';\nimport Backbone from '../vendor/lib/backbone.js';\n\nvar STATE = '__STATE__';\nvar FETCH_DATA = 'FETCH_DATA';\nvar PAGINATION_DATA = 'PAGINATION_DATA';\nvar DEFAULT_PARAMS = 'DEFAULT_PARAMS';\nvar LINK_BY_HEADER = 'LINK_BY_HEADER';\nvar XHR = 'XHR'; // ################################################\n// # Source: https://gist.github.com/deiu/9335803\n// ################################################\n// unquote string (utility)\n\nfunction unquote(value) {\n  if (value.charAt(0) === '\"' && value.charAt(value.length - 1) === '\"') {\n    return value.substring(1, value.length - 1);\n  }\n\n  return value;\n}\n/*\nparse a Link header\nLink:<https://example.org/.meta>; rel=meta\nvar r = parseLinkHeader(xhr.getResponseHeader('Link');\nr['meta']['href'] outputs https://example.org/.meta\n*/\n\n\nfunction parseLinkHeader(header) {\n  /* eslint max-statements: 0 */\n  var linkexp = /<[^>]*>\\s*(\\s*;\\s*[^()<>@,;:\"/[\\]?={} \\t]+=(([^()<>@,;:\"/[\\]?={} \\t]+)|(\"[^\"]*\")))*(,|$)/g;\n  var paramexp = /[^()<>@,;:\"/[\\]?={} \\t]+=(([^()<>@,;:\"/[\\]?={} \\t]+)|(\"[^\"]*\"))/g;\n  var matches = header.match(linkexp);\n  var rels = {};\n\n  for (var i = 0; i < matches.length; i++) {\n    var split = matches[i].split('>');\n    var href = split[0].substring(1);\n    var link = {\n      href: undefined,\n      rel: undefined\n    };\n    link.href = href;\n    var s = split[1].match(paramexp);\n\n    for (var j = 0; j < s.length; j++) {\n      var paramsplit = s[j].split('=');\n      var name = paramsplit[0];\n      link[name] = unquote(paramsplit[1]);\n    }\n\n    if (link.rel !== undefined) {\n      rels[link.rel] = link;\n    }\n  }\n\n  return rels;\n}\n/*\n * Sets the next page URL on the collection from link headers\n * See: http://www.rfc-editor.org/rfc/rfc5988.txt\n *\n * This method is looking for a link header with `rel=\"next\"`\n * An set's it as the next page's URL.\n *\n * If it doesn't find a next page, and current page is set by a link header\n * it assumes we are at the last page and deletes the current `next`\n */\n\n\nfunction setLinkHeadersPagination(collection, xhr) {\n  try {\n    var links = parseLinkHeader(xhr.getResponseHeader('link'));\n    collection[STATE].set(LINK_BY_HEADER, true);\n    collection.setPagination(links['next'].href);\n  } catch (e) {\n    if (collection[STATE].get(LINK_BY_HEADER)) {\n      collection.setPagination(null);\n    }\n  }\n}\n\nfunction parseQuery(url) {\n  var params = {};\n  var rawQueryStr = url && url.split('?')[1];\n  var queryString = rawQueryStr && decodeURIComponent(rawQueryStr.split('#')[0]).replace(/\\+/g, ' ');\n  var props = queryString ? queryString.split('&') : [];\n\n  for (var i = 0; i < props.length; i++) {\n    var parts = props[i].split('=');\n    params[parts.shift()] = parts.join('=');\n  }\n\n  return params;\n} // ################################################\n// # /Source\n// ################################################\n//\n\n\nconst collectionProps =\n/** @lends src/framework/Collection.prototype */\n{\n  /**\n   * Default fetch parameters\n   * @type {Object|Function}\n   */\n  params: {},\n  preinitialize: function (models, options) {\n    const state = new Backbone.Model();\n\n    const defaultParams = oktaUnderscore.defaults(options && options.params || {}, oktaUnderscore.result(this, 'params') || {});\n\n    state.set(DEFAULT_PARAMS, defaultParams);\n    this[STATE] = state; // Adds support for child class to convert to ES6 Class.\n    // After conversion, `this.model` has to be a pure function to return Model Class.\n    // The changes below is trying to distinguish the ambiguity between a Class and normal function,\n    // as both are JavaScript function essentially.\n    // There are three ways to define class for `this.model`\n    // 1. Object properties: `model: BaseModel.extend({..})`\n    // 2. Function constructor:\n    // See example from\n    // - appversions/src/models/CustomType.js\n    // - appversions/src/models/EnumType.js\n    // - appversions/src/models/SignOnMode.js\n    // - authn-factors/src/models/Feature.js\n    // - shared/src/models/SamlAttribute.js\n    // 3. Function that returns a class.\n    //    model: function() { return BaseModel.extend({..}); }\n    //\n    // option 1 and 2 exists in code base today\n    // option 3 is introduced to support child class to convert to ES6 class.\n    // TODO: think of remove following check\n    // The reason for `this.model !== Backbone.Model` is because `this.model` is default to `Backbone.Model`\n    // set at Backbone.Collection.\n\n    if (oktaUnderscore.isFunction(this.model) && this.model.length === 0 && this.model.isCourageModel !== true) {\n      this.model = oktaUnderscore.result(this, 'model');\n    }\n\n    Backbone.Collection.prototype.preinitialize.apply(this, arguments);\n  },\n\n  /**\n   * See [Backbone Collection.sync](http://backbonejs.org/#Collection-sync).\n   */\n  sync: function (method, collection, options) {\n    var self = this;\n    var success = options.success;\n\n    options.success = function (resp, status, xhr) {\n      // its important to set the pagination data *before* we call the success callback\n      // because we want the pagination data to be ready when the collection triggers the `sync` event\n      setLinkHeadersPagination(self, xhr);\n      success.apply(null, arguments);\n    };\n\n    return Backbone.Collection.prototype.sync.call(this, method, collection, options);\n  },\n\n  /**\n   * See [Backbone Collection.fetch](http://backbonejs.org/#Collection-fetch).\n   */\n  fetch: function (options) {\n    options || (options = {});\n    var state = this[STATE];\n    var xhr = state.get(XHR);\n    options.data = oktaUnderscore.extend({}, state.get(DEFAULT_PARAMS), options.data || {});\n    options.fromFetch = true;\n    state.set(FETCH_DATA, options.data);\n\n    if (xhr && xhr.abort && options.abort !== false) {\n      xhr.abort();\n    }\n\n    xhr = Backbone.Collection.prototype.fetch.call(this, options);\n    state.set(XHR, xhr);\n    return xhr;\n  },\n\n  /**\n   * Set pagination data to get to the next page\n   * @param {Mixed} params\n   * @param {Object} [options]\n   * @param {Boolean} [options.fromFetch] should we include data from the previous fetch call in this object\n   * @example\n   * collection.setPagination({q: 'foo', page: '2'}); //=> {q: 'foo', page: '2'}\n   *\n   * collection.setPagination('/path/to/resource?q=baz&page=4'); //=> {q: 'baz', page: '4'}\n   *\n   * collection.setPagination('/path/to/resource'); //=> {}\n   *\n   * collection.fetch({data: {q: 'foo'}});\n   * collection.setPagination({page: 2}, {fromFetch: true}); //=> {q: 'foo', page: 2}\n   *\n   * any \"falsy\" value resets pagination\n   * collection.setPagination(); //=> {}\n   * collection.setPagination(null); //=> {}\n   * collection.setPagination(false); //=> {}\n   * collection.setPagination(''); //=> {}\n   * collection.setPagination(0); //=> {}\n   * @protected\n   */\n  setPagination: function (params, options) {\n    /* eslint complexity: [2, 8] */\n    if (oktaUnderscore.isString(params) && params) {\n      params = parseQuery(params);\n    }\n\n    if (!oktaUnderscore.isObject(params) || oktaUnderscore.isArray(params) || !oktaUnderscore.size(params)) {\n      params = null;\n    } else if (options && options.fromFetch) {\n      params = oktaUnderscore.extend({}, this.getFetchData(), params);\n    }\n\n    this[STATE].set(PAGINATION_DATA, params);\n  },\n\n  /**\n   * Returns the `data` parameters applied in th most recent `fetch` call\n   * It will include parameters set by {@link #params} and optios.params passed to the constructor\n   * @return {Object}\n   * @protected\n   */\n  getFetchData: function () {\n    return this[STATE].get(FETCH_DATA) || {};\n  },\n\n  /**\n   * Data object for constructing a request to fetch the next page\n   * @return {Object}\n   * @protected\n   */\n  getPaginationData: function () {\n    return this[STATE].get(PAGINATION_DATA) || {};\n  },\n\n  /**\n   * Does this collection have more data on the server (e.g is there a next \"page\")\n   * @return {Boolean}\n   */\n  hasMore: function () {\n    return oktaUnderscore.size(this.getPaginationData()) > 0;\n  },\n\n  /**\n   * Get the next page from the server\n   * @return {Object} xhr returned by {@link #fetch}\n   */\n  fetchMore: function () {\n    if (!this.hasMore()) {\n      throw new Error('Invalid Request');\n    }\n\n    return this.fetch({\n      data: this.getPaginationData(),\n      add: true,\n      remove: false,\n      update: true\n    });\n  },\n\n  /**\n   * See [Backbone Collection.reset](http://backbonejs.org/#Collection-reset).\n   */\n  reset: function (models, options) {\n    options || (options = {}); // only reset the pagination when reset is being called explicitly.\n    // this is to avoid link headers pagination being overriden and reset when\n    // fetching the collection using `collection.fetch({reset: true})`\n\n    if (!options.fromFetch) {\n      this.setPagination(null);\n    }\n\n    return Backbone.Collection.prototype.reset.apply(this, arguments);\n  },\n  // we want \"where\" to be able to search through derived properties as well\n  where: function (attrs, first) {\n    if (oktaUnderscore.isEmpty(attrs)) {\n      return first ? void 0 : [];\n    }\n\n    return this[first ? 'find' : 'filter'](function (model) {\n      for (var key in attrs) {\n        if (attrs[key] !== model.get(key)) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n  },\n\n  /**\n   * See [Backbone Collection.create](http://backbonejs.org/#Collection-create).\n   */\n  create: function (model, options) {\n    options || (options = {});\n\n    if (!oktaUnderscore.result(model, 'urlRoot')) {\n      options.url = oktaUnderscore.result(this, 'url');\n    }\n\n    return Backbone.Collection.prototype.create.call(this, model, options);\n  },\n  // Use Object.create instead of {} on _byId to avoid __proto__ functions to return\n  // This can be removed once the issue has addressed in backbone framework\n  // https://github.com/jashkenas/backbone/pull/4225\n  _reset: function () {\n    Backbone.Collection.prototype['_reset'].call(this);\n    this._byId = Object.create(null);\n  }\n};\n/**\n *\n * Archer.Collection is a standard [Backbone.Collection](http://backbonejs.org/#Collection) with pre-set `data`\n * parameters and built in pagination - works with [http link headers](https://tools.ietf.org/html/rfc5988)\n * out of the box:\n *\n * @class src/framework/Collection\n * @extends external:Backbone.Collection\n * @example\n * var Users = Archer.Collection.extend({\n *   url: '/api/v1/users'\n *   params: {expand: true}\n * });\n * var users = new Users(null, {params: {type: 'new'}}),\n *     $button = this.$('a.fetch-more');\n *\n * $button.click(function () {\n *   users.fetchMore();\n * });\n *\n * this.listenTo(users, 'sync', function () {\n *   $button.toggle(users.hasMore());\n * });\n *\n * collection.fetch(); //=> '/api/v1/users?expand=true&type=new'\n */\n\nconst Collection = Backbone.Collection.extend(collectionProps);\n/**\n * It's used for distinguishing the ambiguity from _.isFunction()\n * which returns True for both a JavaScript Class constructor function\n * and normal function. With this flag, we can tell a function is actually\n * a Collection Class.\n * This flag is added in order to support the type of a parameter can be\n * either a Class or pure function that returns a Class.\n */\n\nCollection.isCourageCollection = true;\n\nexport { Collection as default };\n"],"names":["STATE","FETCH_DATA","PAGINATION_DATA","DEFAULT_PARAMS","LINK_BY_HEADER","XHR","unquote","value","charAt","length","substring","parseLinkHeader","header","linkexp","paramexp","matches","match","rels","i","split","href","link","undefined","rel","s","j","paramsplit","name","setLinkHeadersPagination","collection","xhr","links","getResponseHeader","set","setPagination","e","get","parseQuery","url","params","rawQueryStr","queryString","decodeURIComponent","replace","props","parts","shift","join","collectionProps","preinitialize","models","options","state","Backbone","Model","defaultParams","oktaUnderscore","defaults","result","isFunction","model","isCourageModel","Collection","prototype","apply","arguments","sync","method","self","success","resp","status","call","fetch","data","extend","fromFetch","abort","isString","isObject","isArray","size","getFetchData","getPaginationData","hasMore","fetchMore","Error","add","remove","update","reset","where","attrs","first","isEmpty","key","create","_reset","_byId","Object","isCourageCollection"],"mappings":"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"}