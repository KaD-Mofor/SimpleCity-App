{"version":3,"file":"BaseController.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/util/BaseController.js"],"sourcesContent":["import oktaJQueryStatic from './jquery-wrapper.js';\nimport oktaUnderscore from './underscore-wrapper.js';\nimport BaseRouter from './BaseRouter.js';\nimport SettingsModel from './SettingsModel.js';\nimport StateMachine from './StateMachine.js';\nimport BaseView from '../views/BaseView.js';\n\nfunction clean(obj) {\n  const res = {};\n\n  oktaUnderscore.each(obj, function (value, key) {\n    if (!oktaUnderscore.isNull(value)) {\n      res[key] = value;\n    }\n  });\n\n  return res;\n}\n\nconst proto =\n/** @lends module:Okta.Controller.prototype */\n{\n  preinitialize: function (options = {}) {\n    // If 'state' is passed down as options, use it, else create a 'new StateMachine()'\n    this.state = oktaUnderscore.result(this, 'state');\n    const hasStateBeenInitialized = this.state instanceof StateMachine || options.state instanceof StateMachine;\n\n    if (!hasStateBeenInitialized) {\n      const stateData = oktaUnderscore.defaults(clean(options.state), this.state || {}); // TODO:\n      // `framework/View.js set `this.state = options.state.`.\n      // Therefore we could consider to do\n      // 1. `options.state = new StateMachine()`\n      // 2. remove `delete options.state`\n\n\n      this.state = new StateMachine(stateData);\n      delete options.state;\n    }\n\n    if (!options.settings) {\n      // allow the controller to live without a router\n      options.settings = new SettingsModel(oktaUnderscore.omit(options || {}, 'el'));\n      this.listen('notification', BaseRouter.prototype._notify);\n      this.listen('confirmation', BaseRouter.prototype._confirm);\n    }\n\n    BaseView.prototype.preinitialize.call(this, options);\n  },\n  constructor: function (options = {}) {\n    BaseView.call(this, options);\n    this.listenTo(this.state, '__invoke__', function () {\n      const args = oktaUnderscore.toArray(arguments);\n\n      const method = args.shift();\n\n      if (oktaUnderscore.isFunction(this[method])) {\n        this[method].apply(this, args);\n      }\n    });\n    let MainView; // if `this.View` is already a Backbone View\n\n    if (this.View && this.View.isCourageView) {\n      MainView = this.View;\n    } // if `this.View` is a pure function that returns a Backbone View\n    else if (oktaUnderscore.result(this, 'View') && oktaUnderscore.result(this, 'View').isCourageView) {\n      MainView = oktaUnderscore.result(this, 'View');\n    }\n\n    if (MainView) {\n      this.add(new MainView(this.toJSON()));\n    }\n  },\n\n  /**\n   * The default values of our application state\n   * @type {Object}\n   * @default {}\n   */\n  state: {},\n\n  /**\n   * The main view this controller operate on\n   * @type {module:Okta.View}\n   * @default null\n   */\n  View: null,\n\n  /**\n   * Renders the {@link module:Okta.Controller#View|main view} after the DOM is ready\n   * in case the controller is the root component of the page (e.g there's no router)\n   */\n  render: function () {\n    const args = arguments;\n    const self = this;\n    oktaJQueryStatic(function () {\n      BaseView.prototype.render.apply(self, args);\n    });\n    return this;\n  },\n\n  /**\n   * Creates the view constructor options\n   * @param {Object} [options] Extra options\n   * @return {Object} The view constructor options\n   */\n  toJSON: function (options) {\n    return oktaUnderscore.extend(oktaUnderscore.pick(this, 'state', 'settings', 'collection', 'model'), options || {});\n  },\n\n  /**\n   * Removes the child views, empty the DOM element and stop listening to events\n   */\n  remove: function () {\n    this.removeChildren();\n    this.stopListening();\n    this.$el.empty();\n    return this;\n  }\n};\n/**\n * A Controller is our application control flow component.\n *\n * Typically it will:\n * - Initialize the models, controller and main views\n * - Listen to events\n * - Create, read, update and delete models\n * - Create modal dialogs, confirmation dialogs and alert dialogs\n * - Control the application flow\n *\n * The constructor is responsible for:\n * - Create the application state object\n * - Assign or creates the application settings object\n * - Create an instance of the main view with the relevant parameters\n *\n * See:\n * [Hello World Tutorial](https://github.com/okta/courage/wiki/Hello-World),\n * [Test Spec](https://github.com/okta/okta-ui/blob/master/packages/courage/test/spec/util/BaseController_spec.js)\n *\n * @class module:Okta.Controller\n * @param {Object} options Options Hash\n * @param {SettingsModel} [options.settings] Application Settings Model\n * @param {String} options.el a jQuery selector string stating where to attach the controller in the DOM\n */\n\nvar BaseController = BaseView.extend(proto);\n\nexport { BaseController as default };\n"],"names":["clean","obj","res","oktaUnderscore","each","value","key","isNull","proto","preinitialize","options","state","result","hasStateBeenInitialized","StateMachine","stateData","defaults","settings","SettingsModel","omit","listen","BaseRouter","prototype","_notify","_confirm","BaseView","call","constructor","listenTo","args","toArray","arguments","method","shift","isFunction","apply","MainView","View","isCourageView","add","toJSON","render","self","oktaJQueryStatic","extend","pick","remove","removeChildren","stopListening","$el","empty","BaseController"],"mappings":"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"}