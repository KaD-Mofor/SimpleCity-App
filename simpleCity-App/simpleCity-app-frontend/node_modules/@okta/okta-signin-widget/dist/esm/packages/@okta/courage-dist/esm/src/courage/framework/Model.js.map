{"version":3,"file":"Model.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/framework/Model.js"],"sourcesContent":["import oktaUnderscore from '../util/underscore-wrapper.js';\nimport Backbone from '../vendor/lib/backbone.js';\nimport Logger from '../util/Logger.js';\n\nfunction isModelPropertySchema(obj) {\n  return obj && obj.type || obj.deps;\n}\n\n/**\n   * Archer.Model is a standard [Backbone.Model](http://backbonejs.org/#Model) with a few additions:\n   *\n   * - {@link src/framework/Model#derived Derived properties}\n   * - {@link src/framework/Model#props Built in schema validation}\n   * - {@link src/framework/Model#local Private properties (with schema validation)}\n   * - {@link src/framework/Model#flat Flattening of nested objects}\n   *\n   * Both derived and private properties are filtered out when sending the data to the server.\n   *\n   * See [Backbone.Model](http://backbonejs.org/#Model-constructor).\n   *\n   * @class src/framework/Model\n   * @extends external:Backbone.Model\n   * @param {Object} [attributes] - Initial model attributes (data)\n   * @param {Object} [options] - Options hash\n   * @example\n   * var Person = Archer.Model.extend({\n   *   props: {\n   *     'fname': 'string',\n   *     'lname': 'string'\n   *   },\n   *   local: {\n   *     isLoggedIn: 'boolean'\n   *   },\n   *   derived: {\n   *     name: {\n   *       deps: ['fname', 'lname'],\n   *       fn: function (fname, lname) {\n   *         return fname + ' ' + lname;\n   *       }\n   *     }\n   *   }\n   * });\n   * var model = new Person({fname: 'Joe', lname: 'Doe'});\n   * model.get('name'); //=> \"Joe Doe\"\n   * model.toJSON(); //=> {fname: 'Joe', lname: 'Doe'}\n   *\n   * model.set('isLoggedIn', true);\n   * model.get('isLoggedIn'); //=> true\n   * model.toJSON(); //=> {fname: 'Joe', lname: 'Doe'}\n   */\nlet Model;\nconst statics = {\n  ERROR_BLANK: 'model.validation.field.blank',\n  ERROR_WRONG_TYPE: 'model.validation.field.wrong.type',\n  ERROR_NOT_ALLOWED: 'model.validation.field.value.not.allowed',\n  ERROR_INVALID: 'model.validation.field.invalid',\n  ERROR_IARRAY_UNIQUE: 'model.validation.field.array.unique',\n  ERROR_INVALID_FORMAT_EMAIL: 'model.validation.field.invalid.format.email',\n  ERROR_INVALID_FORMAT_URI: 'model.validation.field.invalid.format.uri',\n  ERROR_INVALID_FORMAT_IPV4: 'model.validation.field.invalid.format.ipv4',\n  ERROR_INVALID_FORMAT_HOSTNAME: 'model.validation.field.invalid.format.hostname',\n  ERROR_STRING_STRING_MIN_LENGTH: 'model.validation.field.string.minLength',\n  ERROR_STRING_STRING_MAX_LENGTH: 'model.validation.field.string.maxLength'\n};\n\nfunction flatten(value, objectTypeFields, key, target) {\n  var filter = oktaUnderscore.contains(objectTypeFields, key);\n\n  target || (target = {});\n\n  if (!filter && oktaUnderscore.isObject(value) && !oktaUnderscore.isArray(value) && !oktaUnderscore.isFunction(value)) {\n    oktaUnderscore.each(value, function (val, i) {\n      flatten(val, objectTypeFields, key ? key + '.' + i : i, target);\n    });\n  } // Case where target is an empty object. Guard against returning {undefined: undefined}.\n  else if (key !== undefined) {\n    target[key] = value;\n  }\n\n  return target;\n}\n\nfunction unflatten(data) {\n  oktaUnderscore.each(data, function (value, key, data) {\n    if (key.indexOf('.') === -1) {\n      return;\n    }\n\n    var part;\n    var ref = data;\n    var parts = key.split('.');\n\n    while ((part = parts.shift()) !== undefined) {\n      if (!ref[part]) {\n        ref[part] = parts.length ? {} : value;\n      }\n\n      ref = ref[part];\n    }\n\n    delete data[key];\n  });\n\n  return data;\n}\n\nfunction createMessage(field, msg) {\n  var obj = {};\n  obj[field.name] = msg;\n  return obj;\n}\n\nfunction normalizeSchemaDef(field, name) {\n  var target;\n\n  if (oktaUnderscore.isString(field)) {\n    target = {\n      type: field\n    };\n  } else if (oktaUnderscore.isArray(field)) {\n    target = {\n      type: field[0],\n      required: field[1],\n      value: field[2]\n    };\n  } else {\n    target = oktaUnderscore.clone(field);\n  }\n\n  oktaUnderscore.defaults(target, {\n    required: false,\n    name: name\n  });\n\n  return target;\n}\n\nfunction capitalize(string) {\n  return string.toLowerCase().replace(/\\b[a-z]/g, function (letter) {\n    return letter.toUpperCase();\n  });\n}\n\nfunction _validateRegex(value, pattern, error) {\n  if (!pattern.test(value)) {\n    return error;\n  }\n}\n\nvar StringFormatValidators = {\n  /*eslint max-len: 0 */\n  email: function (value) {\n    // Taken from  http://emailregex.com/ on 2017-03-06.\n    var pattern = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return _validateRegex(value, pattern, Model.ERROR_INVALID_FORMAT_EMAIL);\n  },\n  uri: function (value) {\n    // source: https://mathiasbynens.be/demo/url-regex\n    var pattern = /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n    return _validateRegex(value, pattern, Model.ERROR_INVALID_FORMAT_URI);\n  },\n  ipv4: function (value) {\n    // source: https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9780596802837/ch07s16.html\n    var pattern = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\n    return _validateRegex(value, pattern, Model.ERROR_INVALID_FORMAT_IPV4);\n  },\n  hostname: function (value) {\n    // source: http://www.regextester.com/23\n    var pattern = /^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$/;\n    return _validateRegex(value, pattern, Model.ERROR_INVALID_FORMAT_HOSTNAME);\n  }\n};\n\nfunction validateStringFormat(field, value) {\n  var validator = StringFormatValidators[field.format];\n\n  if (field.format && !validator) {\n    throw new TypeError(field.format + ' is not a supported string format');\n  }\n\n  return validator && validator(value);\n}\n\nfunction validateString(field, value) {\n  var createMessageWith = oktaUnderscore.partial(createMessage, field);\n\n  var invalidFormat = validateStringFormat(field, value);\n\n  if (invalidFormat) {\n    return createMessageWith(invalidFormat);\n  }\n\n  if (value && field.minLength && value.length < field.minLength) {\n    return createMessageWith(Model.ERROR_STRING_STRING_MIN_LENGTH);\n  }\n\n  if (value && field.maxLength && value.length > field.maxLength) {\n    return createMessageWith(Model.ERROR_STRING_STRING_MAX_LENGTH);\n  }\n}\n\nfunction validateField(field, value) {\n  /* eslint complexity: [2, 25], max-statements: [2, 30] */\n  var createMessageWith = oktaUnderscore.partial(createMessage, field);\n\n  var isDefined = !oktaUnderscore.isUndefined(value) && !oktaUnderscore.isNull(value);\n  var checkType;\n  var errorMessage; // If using an array validator, perform the validation\n\n  if (Array.isArray(field.validate)) {\n    const output = [];\n    let foundError = false;\n    let result;\n    field.validate.forEach(item => {\n      if (!value) {\n        result = false;\n      } else {\n        switch (item.type.toLowerCase()) {\n          case 'regex':\n            result = new RegExp(item.value.pattern, item.value.flags || '').test(value);\n            break;\n\n          default:\n            result = false;\n        }\n      } // Append the result.\n\n\n      foundError = foundError || !result;\n      output.push({\n        // eslint-disable-next-line no-prototype-builtins\n        message: item.hasOwnProperty('message') ? item.message : '',\n        passed: result\n      });\n    });\n\n    if (foundError) {\n      return createMessageWith(output);\n    }\n\n    return;\n  } // check required fields\n\n\n  if (field.required && (!isDefined || oktaUnderscore.isNull(value) || value === '')) {\n    return createMessageWith(Model.ERROR_BLANK);\n  } // check type\n\n\n  checkType = oktaUnderscore['is' + capitalize(field.type)];\n\n  if (isDefined && field.type !== 'any' && (!oktaUnderscore.isFunction(checkType) || !checkType(value))) {\n    return createMessageWith(Model.ERROR_WRONG_TYPE);\n  } // validate string format\n\n\n  if (value && field.type === 'string') {\n    var error = validateString(field, value);\n\n    if (error) {\n      return error;\n    }\n  } // check pre set values (enum)\n\n\n  if (isDefined && field.values && !oktaUnderscore.contains(field.values, value)) {\n    return createMessageWith(Model.ERROR_NOT_ALLOWED);\n  } // check validate method\n\n\n  if (oktaUnderscore.isFunction(field.validate)) {\n    var result = field.validate(value);\n\n    if (oktaUnderscore.isString(result) && result) {\n      return createMessageWith(result);\n    } else if (result === false) {\n      return createMessageWith(Model.ERROR_INVALID);\n    }\n  } // check array items\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n\n\n  if (isDefined && field.type === 'array' && (errorMessage = validateArrayField(field, value))) {\n    return createMessageWith(errorMessage);\n  }\n}\n\nfunction validateArrayField(field, arr) {\n  if (field.minItems && arr.length < field.minItems) {\n    return 'model.validation.field.array.minItems';\n  } else if (field.maxItems && arr.length > field.maxItems) {\n    return 'model.validation.field.array.maxItems';\n  } else if (field.uniqueItems && arr.length > oktaUnderscore.uniq(arr).length) {\n    return Model.ERROR_IARRAY_UNIQUE;\n  } else if (field.items) {\n    /* eslint max-depth: [2, 3] */\n    var arrayField = normalizeSchemaDef(field.items, 'placeholder');\n\n    for (var i = 0; i < arr.length; i++) {\n      var value = arr[i];\n      var error = validateField(arrayField, value);\n\n      if (error) {\n        return error['placeholder'];\n      }\n    }\n  }\n}\n\nconst props =\n/** @lends src/framework/Model.prototype */\n{\n  /**\n     * Pass props as an object to extend, describing the observable properties of your model. The props\n     * properties should not be set on an instance, as this won't define new properties, they should only be passed to\n     * extend.\n     * Properties can be defined in three different ways:\n     *\n     * - As a string with the expected dataType. One of string, number, boolean, array, object, date, or any.\n     * Eg: `name: 'string'`.\n     * - An array of `[dataType, required, default]`\n     * - An object `{type: 'string', format: '', required: true, value: '', values: [], validate: function() {}`\n     *   - `value` will be the value that the property will be set to if it is undefined, either by not being set during\n     *   initialization, or by being explicitly set to undefined.\n     *   - `format` is a json-schame derived string format. Supported formats are: `email`, `uri`, `hostname` and `ipv4`.\n     *   - If `required` is true, one of two things will happen. If a default is set for the property, the property will\n     *   start with that value. If a default is not set for the property, validation will fail\n     *   - If `values` array is passed, then you'll be able to change a property to one of those values only.\n     *   - If `validate` is defined, it should return false or a custom message string when the validation fails.\n     *   - If the type is defined as `array`, the array elements could be defined by `minItems` (Number),\n     *   `uniqueItems` (Boolean) and `items` (a field definition such as this one that will validate each array member)\n     *   To the `validate` method\n     *   - Trying to set a property to an invalid type will raise an exception.\n     *\n     * @type {Mixed|Function}\n     * @example\n     * var Person = Model.extend({\n     *   props: {\n     *     name: 'string',\n     *     age: 'number',\n     *     paying: ['boolean', true, false], //required attribute, defaulted to false\n     *     type: {\n     *       type: 'string',\n     *       values: ['regular-hero', 'super-hero', 'mega-hero']\n     *     },\n     *     likes: {\n     *       type: 'string',\n     *       validate: function (value) {\n     *         return /^[\\w]+ing$/.test(value)\n     *       }\n     *     }\n     *   }\n     * });\n     */\n  props: {},\n\n  /**\n     * Derived properties (also known as computed properties) are properties of the model that depend on the\n     * other (props, local or even derived properties to determine their value. Best demonstrated with an example:\n     *\n     * Each derived property, is defined as an object with the current properties:\n     *\n     * - `deps` {Array} - An array of property names which the derived property depends on.\n     * - `fn` {Function} - A function which returns the value of the computed property. It is called in the context of\n     * the current object, so that this is set correctly.\n     * - `cache` {Boolean} -  - Whether to cache the property. Uncached properties are computed every time they are\n     * accessed. Useful if it depends on the current time for example. Defaults to `true`.\n     *\n     * Derived properties are retrieved and fire change events just like any other property. They cannot be set\n     * directly.\n     * @type {Object|Function}\n     * @example\n     * var Person = Model.extend({\n     *   props: {\n     *     firstName: 'string',\n     *     lastName: 'string'\n     *   },\n     *   derived: {\n     *     fullName: {\n     *       deps: ['firstName', 'lastName'],\n     *       fn: function (firstName, lastName) {\n     *         return firstName + ' ' + lastName;\n     *       }\n     *     }\n     *   }\n     * });\n     *\n     * var person = new Person({ firstName: 'Phil', lastName: 'Roberts' })\n     * console.log(person.get('fullName')) //=> \"Phil Roberts\"\n     *\n     * person.set('firstName', 'Bob');\n     * console.log(person.get('fullName')) //=> \"Bob Roberts\"\n     */\n  derived: {},\n\n  /**\n     * local properties are defined and work in exactly the same way as {@link src/framework/Model#props|props}, but generally only exist for\n     * the lifetime of the page.\n     * They would not typically be persisted to the server, and are not returned by calls to {@link src/framework/Model#toJSON|toJSON}.\n     *\n     * @type {Object|Function}\n     * @example\n     * var Person = Model.extend({\n     *   props: {\n     *     name: 'string',\n     *   },\n     *   local: {\n     *     isLoggedIn: 'boolean'\n     *   }\n     * );\n     */\n  local: {},\n\n  /**\n     * Flatten the payload into dot notation string keys:\n     *\n     * @type {Boolean|Function}\n     * @example\n     * var Person = Model.extend({\n     *   props: {\n     *     'profile.fname': 'string',\n     *     'profile.lname': 'string',\n     *     'profile.languages': 'object'\n     *   },\n     *   flat: true\n     * });\n     * var person = new Person({'profile': {\n     *                            'fname': 'John',\n     *                            'lname': 'Doe',\n     *                            'languages': {name: \"English\", value: \"EN\"}\n     *                         }}, {parse: true});\n     * person.get('profile'); //=> undefined\n     * person.get('profile.fname'); //=> 'John'\n     * person.get('profile.lname'); //=> 'Doe'\n     * person.get('profile.languages'); //=> {name: \"English\", value: \"EN\"}\n     * person.get('profile.languages.name'); //=> undefined\n     * person.toJSON(); //=> {'profile': {'fname': 'John'} }\n     */\n  flat: true,\n\n  /**\n     * @deprecated\n     * @alias Backbone.Model#defaults\n     */\n  defaults: {},\n  // FIXME: preinitialize takes parameter `attributes` and `options`, which inherit from constructor.\n  preinitialize: function (options, ...rest) {\n    this.options = options || {};\n    var schema = this['__schema__'] = {};\n    var objectTypeFields = [];\n    schema.computedProperties = {};\n    schema.props = oktaUnderscore.clone(oktaUnderscore.result(this, 'props') || {});\n    schema.derived = oktaUnderscore.clone(oktaUnderscore.result(this, 'derived') || {});\n    schema.local = oktaUnderscore.clone(oktaUnderscore.result(this, 'local') || {});\n    var defaults = {};\n\n    oktaUnderscore.each(oktaUnderscore.extend({}, schema.props, schema.local), function (options, name) {\n      var schemaDef = normalizeSchemaDef(options, name);\n\n      if (!oktaUnderscore.isUndefined(schemaDef.value)) {\n        defaults[name] = schemaDef.value;\n      }\n\n      if (schemaDef.type === 'object') {\n        objectTypeFields.push(name);\n      }\n    }, this);\n\n    if (oktaUnderscore.size(defaults)) {\n      var localDefaults = oktaUnderscore.result(this, 'defaults');\n\n      this.defaults = function () {\n        return oktaUnderscore.defaults({}, defaults, localDefaults);\n      };\n    } // override `validate`\n\n\n    this.validate = oktaUnderscore.wrap(this.validate, function (validate) {\n      var args = oktaUnderscore.rest(arguments);\n\n      var res = oktaUnderscore.extend(this._validateSchema.apply(this, args), validate.apply(this, args));\n\n      return oktaUnderscore.size(res) && res || undefined;\n    }); // override `parse`\n\n    this.parse = oktaUnderscore.wrap(this.parse, function (parse) {\n      var target = parse.apply(this, oktaUnderscore.rest(arguments));\n\n      if (oktaUnderscore.result(this, 'flat')) {\n        target = flatten(target, objectTypeFields);\n      }\n\n      return target;\n    });\n    Backbone.Model.prototype.preinitialize.call(this, options, ...rest);\n  },\n  // FIXME:\n  // constructor takes parameter `attributes` and `options`.\n  constructor: function () {\n    Backbone.Model.apply(this, arguments);\n    var schema = this['__schema__'];\n\n    oktaUnderscore.each(schema.derived, function (options, name) {\n      schema.computedProperties[name] = this.__getDerivedValue(name); // set initial value;\n\n      var deps = isModelPropertySchema(options) ? options.deps || [] : [];\n\n      if (deps.length) {\n        this.on('cache:clear change:' + deps.join(' change:'), function () {\n          var value = this.__getDerivedValue(name);\n\n          if (value !== schema.computedProperties[name]) {\n            schema.computedProperties[name] = value;\n            this.trigger('change:' + name, this, value);\n          }\n        }, this);\n      }\n    }, this);\n\n    this.on('sync', function () {\n      this.__syncedData = this.toJSON();\n    }, this);\n  },\n  validate: function () {},\n\n  /**\n     * Check if the schema settings allow this field to exist in the model\n     * @param  {String} key\n     * @return {Boolean}\n     */\n  allows: function (key) {\n    var schema = this['__schema__'];\n\n    var all = oktaUnderscore.extend({}, schema.props, schema.local);\n\n    if (!oktaUnderscore.has(all, key)) {\n      Logger.warn('Field not defined in schema', key);\n    }\n\n    return true;\n  },\n\n  /**\n     * Returns the schema for the specific property\n     *\n     * @param propName - The name of the property\n     * @returns {*} | null\n     */\n  getPropertySchema: function (propName) {\n    var schema = this['__schema__'];\n    return oktaUnderscore.reduce([schema.props, schema.local], function (result, options) {\n      return result || normalizeSchemaDef(options[propName], propName);\n    }, null);\n  },\n  set: function (key, val) {\n    var attrs;\n\n    if (typeof key === 'object') {\n      attrs = key;\n    } else {\n      (attrs = {})[key] = val;\n    } // Don't override a computed properties\n\n\n    oktaUnderscore.each(attrs, function (value, key) {\n      if (oktaUnderscore.has(this['__schema__'].derived, key)) {\n        throw new Error(`overriding derived properties is not supported: ${key}`);\n      }\n    }, this); // Schema validation\n\n\n    var errorFields = [];\n\n    oktaUnderscore.each(attrs, function (value, key) {\n      this.allows(key) || errorFields.push(key);\n    }, this);\n\n    if (errorFields.length) {\n      throw new Error(`field not allowed: ${errorFields.join(', ')}`);\n    }\n\n    return Backbone.Model.prototype.set.apply(this, arguments);\n  },\n  get: function (attr) {\n    var schema = this['__schema__'];\n\n    if (oktaUnderscore.has(schema.derived, attr)) {\n      if (schema.derived[attr].cache !== false) {\n        return schema.computedProperties[attr];\n      } else {\n        return this.__getDerivedValue(attr);\n      }\n    }\n\n    return Backbone.Model.prototype.get.apply(this, arguments);\n  },\n\n  /**\n     * Return a shallow copy of the model's attributes for JSON stringification.\n     * This can be used for persistence, serialization, or for augmentation before being sent to the server.\n     * The name of this method is a bit confusing, as it doesn't actually return a JSON string â€”\n     * but I'm afraid that it's the way that the JavaScript API for JSON.stringify works.\n     *\n     * See [Backbone.Model.toJSON](http://backbonejs.org/#Model-toJSON)\n     *\n     * @param  {Object} options\n     * @return {Object}\n     * @example\n     * var artist = new Model({\n     *   firstName: 'Wassily',\n     *   lastName: 'Kandinsky'\n     * });\n     *\n     * artist.set({birthday: 'December 16, 1866'});\n     * JSON.stringify(artist); //=> {'firstName':'Wassily','lastName':'Kandinsky','birthday':'December 16, 1866'}\n     */\n  toJSON: function (options) {\n    options || (options = {});\n\n    var res = oktaUnderscore.clone(Backbone.Model.prototype.toJSON.apply(this, arguments));\n\n    var schema = this['__schema__']; // cleanup local properties\n\n    if (!options.verbose) {\n      res = oktaUnderscore.omit(res, oktaUnderscore.keys(schema.local));\n    } else {\n      // add derived properties\n      oktaUnderscore.each(schema.derived, function (options, name) {\n        res[name] = this.get(name);\n      }, this);\n    }\n\n    if (this.flat) {\n      res = unflatten(res);\n    }\n\n    return res;\n  },\n\n  /**\n     * Removes all attributes from the model, including the id attribute.\n     * Fires a `\"change\"` event unless `silent` is passed as an option.\n     * Sets the default values to the model\n     * @param {Object} [options]\n     */\n  reset: function (options) {\n    this.clear(options);\n    this.set(oktaUnderscore.result(this, 'defaults'), options);\n  },\n\n  /**\n     * Is the data on the model has local modifications since the last sync event?\n     * @return {Boolean} is the model in sync with the server\n     */\n  isSynced: function () {\n    return oktaUnderscore.isEqual(this.__syncedData, this.toJSON());\n  },\n\n  /**\n     * validate a specific field in the model.\n     * @param  {String} key\n     * @return {Object} returns `{fieldName: errorMessage}` if invalid, otherwise undefined.\n     * @readonly\n     */\n  validateField: function (key) {\n    var schema = key && this.getPropertySchema(key);\n    return schema && validateField(schema, this.get(key));\n  },\n\n  /**\n     * Runs local schema validation. Invoked internally by {@link src/framework/Model#validate|validate}.\n     * @return {Object}\n     * @protected\n     */\n  _validateSchema: function () {\n    var schema = this['__schema__'];\n    return oktaUnderscore.reduce(oktaUnderscore.extend({}, schema.props, schema.local), function (memo, options, name) {\n      return oktaUnderscore.extend(memo, this.validateField(name) || {});\n    }, {}, this);\n  },\n  __getDerivedValue: function (name) {\n    var options = this['__schema__'].derived[name];\n\n    if (oktaUnderscore.isString(options)) {\n      var key = options;\n      options = {\n        deps: [key],\n        fn: function () {\n          return this.get(key);\n        }\n      };\n    }\n\n    var deps = options.deps || [];\n    return options.fn.apply(this, oktaUnderscore.map(deps, this.get, this));\n  }\n};\nModel = Backbone.Model.extend(props, statics);\n/**\n * It's used for distinguishing the ambiguity from _.isFunction()\n * which returns True for both a JavaScript Class constructor function\n * and normal function. With this flag, we can tell a function is actually\n * a Model Class.\n * This flag is added in order to support the type of a parameter can be\n * either a Class or pure function that returns a Class.\n */\n\nModel.isCourageModel = true;\nvar FrameworkModel = Model;\n\nexport { FrameworkModel as default, isModelPropertySchema };\n"],"names":["isModelPropertySchema","obj","type","deps","Model","statics","ERROR_BLANK","ERROR_WRONG_TYPE","ERROR_NOT_ALLOWED","ERROR_INVALID","ERROR_IARRAY_UNIQUE","ERROR_INVALID_FORMAT_EMAIL","ERROR_INVALID_FORMAT_URI","ERROR_INVALID_FORMAT_IPV4","ERROR_INVALID_FORMAT_HOSTNAME","ERROR_STRING_STRING_MIN_LENGTH","ERROR_STRING_STRING_MAX_LENGTH","flatten","value","objectTypeFields","key","target","filter","oktaUnderscore","contains","isObject","isArray","isFunction","each","val","i","undefined","unflatten","data","indexOf","part","ref","parts","split","shift","length","createMessage","field","msg","name","normalizeSchemaDef","isString","required","clone","defaults","capitalize","string","toLowerCase","replace","letter","toUpperCase","_validateRegex","pattern","error","test","StringFormatValidators","email","uri","ipv4","hostname","validateStringFormat","validator","format","TypeError","validateString","createMessageWith","partial","invalidFormat","minLength","maxLength","validateField","isDefined","isUndefined","isNull","checkType","errorMessage","Array","validate","output","foundError","result","forEach","item","RegExp","flags","push","message","hasOwnProperty","passed","values","validateArrayField","arr","minItems","maxItems","uniqueItems","uniq","items","arrayField","props","derived","local","flat","preinitialize","options","rest","schema","computedProperties","extend","schemaDef","size","localDefaults","wrap","args","arguments","res","_validateSchema","apply","parse","Backbone","prototype","call","constructor","__getDerivedValue","on","join","trigger","__syncedData","toJSON","allows","all","has","Logger","warn","getPropertySchema","propName","reduce","set","attrs","Error","errorFields","get","attr","cache","verbose","omit","keys","reset","clear","isSynced","isEqual","memo","fn","map","isCourageModel","FrameworkModel"],"mappings":"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A;AAEA,MAAM6C,KAAK;AAEX;AACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEA,KAAK,EAAE,EAAE;AAET;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,OAAO,EAAE,EAAE;AAEX;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,KAAK,EAAE,EAAE;AAET;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACEC,EAAAA,IAAI,EAAE,IAAI;AAEV;AACF;AACA;AACA;EACEzD,QAAQ,EAAE,EAAE;AACZ;AACA0D,EAAAA,aAAa,EAAE,UAAUC,OAAO,EAAE,GAAGC,IAAI,EAAE;AACzC,IAAA,IAAI,CAACD,OAAO,GAAGA,OAAO,IAAI,EAAE,CAAA;IAC5B,IAAIE,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,CAAA;IACpC,IAAI3F,gBAAgB,GAAG,EAAE,CAAA;AACzB2F,IAAAA,MAAM,CAACC,kBAAkB,GAAG,EAAE,CAAA;AAC9BD,IAAAA,MAAM,CAACP,KAAK,GAAGhF,cAAc,CAACyB,KAAK,CAACzB,cAAc,CAAC8D,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,IAAI,EAAE,CAAC,CAAA;AAC/EyB,IAAAA,MAAM,CAACN,OAAO,GAAGjF,cAAc,CAACyB,KAAK,CAACzB,cAAc,CAAC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"}