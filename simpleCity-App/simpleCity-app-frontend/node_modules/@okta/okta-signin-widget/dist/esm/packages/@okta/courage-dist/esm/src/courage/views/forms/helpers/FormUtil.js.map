{"version":3,"file":"FormUtil.js","sources":["../../../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/views/forms/helpers/FormUtil.js"],"sourcesContent":["import oktaUnderscore from '../../../util/underscore-wrapper.js';\nimport Keys from '../../../util/Keys.js';\nimport Logger from '../../../util/Logger.js';\nimport StringUtil from '../../../util/StringUtil.js';\nimport ViewUtil from '../../../util/ViewUtil.js';\nimport BaseView from '../../BaseView.js';\n\n/* eslint max-params: [2, 6] */\nconst LABEL_OPTIONS = ['model', 'id', 'inputId', 'type', 'label', 'sublabel', 'tooltip', 'name', 'group'];\nconst CONTAINER_OPTIONS = ['wide', 'multi', 'input', 'label-top', 'explain', 'explain-top', 'customExplain', 'model', 'name', 'type', 'autoRender', 'multirowError'];\nconst WRAPPER_OPTIONS = ['model', 'name', 'label-top', 'readOnly', 'events', 'initialize', 'showWhen', 'bindings', 'render', 'className', 'data-se', 'toggleWhen', 'group'];\nconst INPUT_OPTIONS = ['model', 'name', 'inputId', 'type', // base options\n'input', // custom input\n'placeholder', 'label', // labels\n'readOnly', 'read', 'disabled', 'readModeString', // modes\n'options', // select/radio\n'deps', // used to specify inputs that have dependencies and show a callout to user on select\n'from', 'to', // model transformers,\n'autoRender', // model attributes change event to trigger rerendering of the input\n'inlineValidation', // control inline validating against the model on focus lost\n'validateOnlyIfDirty', // check if field has been interacted with and then validate\n'ariaLabel', // 508 compliance for inputs that do not have label associated with them\n'params', 'autoComplete', // autocomplete attribute\n'sortByKey'];\nconst OTHER_OPTIONS = ['errorField' // widgets params - for input specific widgets\n];\n\nconst ALL_OPTIONS = oktaUnderscore.uniq(oktaUnderscore.union(LABEL_OPTIONS, CONTAINER_OPTIONS, WRAPPER_OPTIONS, INPUT_OPTIONS, OTHER_OPTIONS));\n\nconst SAVE_BUTTON_PHASES = ['•         ', '•  •      ', '•  •  •   ', '•  •  •  •', '   •  •  •', '      •  •', '         •', '          ', '          ', '          '];\n\nfunction decorateDoWhen(doWhen) {\n  if (doWhen && !doWhen['__edit__']) {\n    return oktaUnderscore.extend({\n      __edit__: oktaUnderscore.constant(true)\n    }, doWhen);\n  }\n}\n\nfunction createButton(options) {\n  options = oktaUnderscore.pick(options || {}, 'action', 'id', 'className', 'text', 'type');\n  let timeoutId;\n  let intervalId;\n  let phaseCount;\n  return BaseView.extend({\n    tagName: 'input',\n    className: 'button',\n    events: {\n      click: function () {\n        if (options.action && !this.disabled()) {\n          options.action.call(this);\n        }\n      },\n      keyup: function (e) {\n        if (Keys.isEnter(e) && options.action && !this.disabled()) {\n          options.action.call(this);\n        }\n      }\n    },\n    disabled: function () {\n      return this.$el.prop('disabled') === true;\n    },\n    disable: function () {\n      this.$el.prop('disabled', true);\n      this.$el.addClass('btn-disabled');\n    },\n    enable: function () {\n      this.$el.prop('disabled', false);\n      this.$el.removeClass('btn-disabled');\n    },\n    initialize: function () {\n      const self = this;\n      this.$el.attr('type', options.type === 'save' ? 'submit' : 'button');\n      this.$el.val(options.text);\n\n      if (options.id) {\n        this.$el.attr('id', options.id);\n      }\n\n      if (options.className) {\n        this.$el.addClass(options.className);\n      }\n\n      if (options.type) {\n        this.$el.attr('data-type', options.type);\n      }\n\n      this.$el.mousedown(function () {\n        self.model.set('__pending__', true);\n      });\n      this.$el.mouseup(function () {\n        self.model.set('__pending__', false);\n      });\n      this.listenTo(this.model, 'form:set-saving-state', function () {\n        this.disable();\n\n        if (options.type === 'save') {\n          timeoutId = setTimeout(oktaUnderscore.bind(this.__changeSaveText, this), 1000);\n        }\n      });\n      this.listenTo(this.model, 'form:clear-saving-state', function () {\n        this.enable();\n\n        if (options.type === 'save') {\n          clearTimeout(timeoutId);\n          clearInterval(intervalId);\n          this.$el.val(options.text);\n        }\n      });\n    },\n    __changeSaveText: function () {\n      phaseCount = 0;\n      intervalId = setInterval(oktaUnderscore.bind(this.__showLoadingText, this), 200);\n    },\n    __showLoadingText: function () {\n      this.$el.val(SAVE_BUTTON_PHASES[phaseCount++ % SAVE_BUTTON_PHASES.length]);\n    }\n  });\n}\n\nfunction validateInput(options, model) {\n  /* eslint max-statements: 0, complexity: 0 */\n  options || (options = {});\n\n  if (options.type === 'label') {\n    if (!options.label) {\n      Logger.warn('A label input must have a \"label\" parameter', options);\n    }\n\n    return;\n  }\n\n  if (options.type === 'button') {\n    if (!options.title && !options.icon) {\n      Logger.warn('A button input must have a \"title\" and/or an \"icon\" parameter', options);\n    }\n\n    if (!options.click && !options.href) {\n      Logger.warn('A button input must have a \"click\" and/or an \"href\" parameter', options);\n    }\n\n    return;\n  }\n\n  if (!options.name && !options.input) {\n    Logger.warn('Missing \"name\" or \"input\" parameters', options);\n  }\n\n  if (oktaUnderscore.isArray(options.name) && oktaUnderscore.isArray(options.input)) {\n    throw new Error('Not allowed to have both \"name\" and \"input\" defined as array.');\n  }\n\n  if (options.type !== 'list' && options.name && model && model.allows) {\n    let names = [];\n\n    if (oktaUnderscore.isArray(options.name)) {\n      names = options.name;\n    } else {\n      names.push(options.name);\n    }\n\n    oktaUnderscore.each(names, function (name) {\n      if (!model.allows(name)) {\n        throw new Error('field not allowed: ' + options.name);\n      }\n    });\n  }\n\n  if (oktaUnderscore.isArray(options.input) && options.type !== 'list') {\n    oktaUnderscore.each(options.input, function (input) {\n      validateInput(input, model);\n    });\n  }\n\n  const keys = oktaUnderscore.keys(options);\n\n  const intersection = oktaUnderscore.intersection(keys, ALL_OPTIONS);\n\n  if (oktaUnderscore.size(intersection) !== oktaUnderscore.size(options)) {\n    const fields = oktaUnderscore.clone(ALL_OPTIONS);\n\n    Logger.warn('Invalid input parameters', oktaUnderscore.without(keys, ...fields), options);\n  }\n}\n\nfunction generateInputOptions(options, form, createFn) {\n  options = oktaUnderscore.clone(options);\n\n  if (oktaUnderscore.contains(['list', 'group'], options.type)) {\n    options.params = oktaUnderscore.defaults({\n      create: createFn,\n      inputs: oktaUnderscore.map(oktaUnderscore.isArray(options.input) ? options.input : [options.input], function (input) {\n        return oktaUnderscore.first(generateInputOptions(input, form, createFn));\n      })\n    }, options.params || {});\n    delete options.input;\n  }\n\n  const inputs = oktaUnderscore.isArray(options.input) ? oktaUnderscore.clone(options.input) : [options];\n  return oktaUnderscore.map(inputs, function (input) {\n    const target = oktaUnderscore.defaults({\n      model: form.model\n    }, input, oktaUnderscore.omit(options, 'input', 'inputs'), form.options, {\n      id: oktaUnderscore.uniqueId('input'),\n      readOnly: form.isReadOnly(),\n      read: form.hasReadMode()\n    });\n\n    if (form.isReadOnly()) {\n      target.read = target.readOnly = true;\n    }\n\n    return target;\n  });\n}\n\nvar FormUtil = {\n  LABEL_OPTIONS: LABEL_OPTIONS,\n  CONTAINER_OPTIONS: CONTAINER_OPTIONS,\n  WRAPPER_OPTIONS: WRAPPER_OPTIONS,\n  INPUT_OPTIONS: INPUT_OPTIONS,\n  generateInputOptions: generateInputOptions,\n  changeEventString: function (fieldNames) {\n    return 'change:' + fieldNames.join(' change:');\n  },\n  createReadFormButton: function (options) {\n    let action;\n    let text;\n    let ariaLabel;\n\n    if (options.type === 'cancel') {\n      text = ariaLabel = StringUtil.localize('oform.cancel', 'courage');\n\n      action = function () {\n        this.model.trigger('form:cancel');\n      };\n    } else {\n      text = StringUtil.localize('oform.edit', 'courage');\n      ariaLabel = text + ' ' + options.formTitle;\n\n      action = function () {\n        this.model.set('__edit__', true);\n      };\n    }\n\n    return BaseView.extend({\n      tagName: 'a',\n      className: options.className,\n      attributes: {\n        href: '#',\n        'aria-label': ariaLabel\n      },\n      // TODO: refactor to enforce precompiled templates OKTA-309852\n      // eslint-disable-next-line @okta/okta-ui/no-bare-templates\n      template: function () {\n        return oktaUnderscore.escape(text);\n      },\n      events: {\n        click: function (e) {\n          e.preventDefault();\n          action.call(this);\n        }\n      }\n    });\n  },\n  createButton: function (options) {\n    options = oktaUnderscore.clone(options);\n\n    switch (options.type) {\n      case 'save':\n        oktaUnderscore.defaults(options, {\n          className: 'button-primary'\n        });\n\n        break;\n\n      case 'cancel':\n        oktaUnderscore.defaults(options, {\n          className: 'button-clear',\n          text: StringUtil.localize('oform.cancel', 'courage'),\n          action: function () {\n            this.model.trigger('form:cancel');\n          }\n        });\n\n        break;\n\n      case 'previous':\n        oktaUnderscore.defaults(options, {\n          text: StringUtil.localize('oform.previous', 'courage'),\n          action: function () {\n            this.model.trigger('form:previous');\n          }\n        });\n\n        break;\n    }\n\n    return createButton(options);\n  },\n  validateInput: validateInput,\n\n  /**\n   * Applies a show-when logic on a view instance.\n   * The show-when is a map of a model field name -> a boolean or a function that returns a boolean.\n   * The view will toggle based on the field value.\n   *\n   * @param  {Okta.View} view a view instance that has a this.model attached to it\n   * @param  {Object} showWhen\n   */\n  applyShowWhen: function (view, showWhen) {\n    const toggleAndResize = function (bool) {\n      return function () {\n        // The `toggle` is here since an event may be triggered before the el is in the DOM\n        // and in that case slide events may not function as expected.\n        view.$el.toggle(bool);\n        view.model.trigger('form:resize');\n      };\n    };\n\n    ViewUtil.applyDoWhen(view, decorateDoWhen(showWhen), function (bool, options) {\n      if (!options.animate) {\n        view.$el.toggle(bool);\n      } else {\n        view.$el['slide' + (bool ? 'Down' : 'Up')](200, toggleAndResize(bool));\n      }\n    });\n  },\n  applyToggleWhen: function (view, toggleWhen) {\n    ViewUtil.applyDoWhen(view, decorateDoWhen(toggleWhen), function (bool, options) {\n      view.$el.toggle(bool);\n      view.model.trigger('form:resize');\n\n      if (options.animate) {\n        view.render();\n      }\n    });\n  }\n};\n\nexport { FormUtil as default };\n"],"names":["LABEL_OPTIONS","CONTAINER_OPTIONS","WRAPPER_OPTIONS","INPUT_OPTIONS","OTHER_OPTIONS","ALL_OPTIONS","oktaUnderscore","uniq","union","SAVE_BUTTON_PHASES","decorateDoWhen","doWhen","extend","__edit__","constant","createButton","options","pick","timeoutId","intervalId","phaseCount","BaseView","tagName","className","events","click","action","disabled","call","keyup","e","Keys","isEnter","$el","prop","disable","addClass","enable","removeClass","initialize","self","attr","type","val","text","id","mousedown","model","set","mouseup","listenTo","setTimeout","bind","__changeSaveText","clearTimeout","clearInterval","setInterval","__showLoadingText","length","validateInput","label","Logger","warn","title","icon","href","name","input","isArray","Error","allows","names","push","each","keys","intersection","size","fields","clone","without","generateInputOptions","form","createFn","contains","params","defaults","create","inputs","map","first","target","omit","uniqueId","readOnly","isReadOnly","read","hasReadMode","FormUtil","changeEventString","fieldNames","join","createReadFormButton","ariaLabel","StringUtil","localize","trigger","formTitle","attributes","template","escape","preventDefault","applyShowWhen","view","showWhen","toggleAndResize","bool","toggle","ViewUtil","applyDoWhen","animate","applyToggleWhen","toggleWhen","render"],"mappings":"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"}