{"version":3,"file":"BaseRouter.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/util/BaseRouter.js"],"sourcesContent":["import Backbone from '../vendor/lib/backbone.js';\nimport ConfirmationDialog from '../../empty.js';\nimport oktaJQueryStatic from './jquery-wrapper.js';\nimport oktaUnderscore from './underscore-wrapper.js';\nimport Logger from './Logger.js';\nimport SettingsModel from './SettingsModel.js';\nimport Notification from '../views/components/Notification.js';\n\nfunction getRoute(router, route) {\n  const root = oktaUnderscore.result(router, 'root') || '';\n\n  if (root && oktaUnderscore.isString(route)) {\n    return [root, route].join('/').replace(/\\/{2,}/g, '/');\n  }\n\n  return route;\n}\n/**\n * BaseRouter is a standard [Backbone.Router](http://backbonejs.org/#Router)\n * with a few additions:\n * - Explicit mapping between routes and controllers\n * - Support for rendering notification and confirmation dialogs\n *\n * Checkout the [Hello World Tutorial](https://github.com/okta/courage/wiki/Hello-World)\n * for a step-by-step guide to using this.\n *\n * @class module:Okta.Router\n * @extends external:Backbone.Router\n * @param {Object} options options hash\n * @param {String} options.el a jQuery selector string stating where to attach the controller in the DOM\n */\n\n\nconst props =\n/** @lends module:Okta.Router.prototype */\n{\n  /**\n   * The root URL for the router. When setting {@link http://backbonejs.org/#Router-routes|routes},\n   * it will be prepended to each route.\n   * @type {String|Function}\n   */\n  root: '',\n  listen: Notification.prototype.listen,\n  constructor: function (options = {}) {\n    this.el = options.el;\n    /**\n     * Make sure `this.settings` has been set before invoke super - `Backbone.Router.apply`,\n     * which will invoke `this.initialize`, which could use `this.settings`.\n     *\n     * In theory we can set `this.settings` in `this.initialize` and assume `child.initialize`\n     * will invoke `super.initialize` first. But in reality, `child.initialize` doesn't call\n     * `super.initialize` at all.\n     */\n\n    this.settings = new SettingsModel(oktaUnderscore.omit(options, 'el'));\n\n    if (options.root) {\n      this.root = options.root;\n    }\n\n    Backbone.Router.apply(this, arguments);\n    this.listen('notification', this._notify);\n    this.listen('confirmation', this._confirm);\n  },\n\n  /**\n   * Fires up a confirmation dialog\n   *\n   * @param  {Object} options Options Hash\n   * @param  {String} options.title The title\n   * @param  {Array<string>} buttonOrder The order of the buttons\n   * @param  {String} options.subtitle The explain text\n   * @param  {String} options.save The text for the save button\n   * @param  {Function} options.ok The callback function to run when hitting \"OK\"\n   * @param  {String} options.cancel The text for the cancel button\n   * @param  {Function} options.cancelFn The callback function to run when hitting \"Cancel\"\n   * @param  {Boolean} options.noCancelButton Don't render the cancel button (useful for alert dialogs)\n   * @param  {Boolean} options.noSubmitButton Don't render the primary button (useful for alert dialogs)\n   * @private\n   *\n   * @return {Okta.View} the dialog view\n   */\n  _confirm: function (options = {}) {\n    const Dialog = ConfirmationDialog.extend(oktaUnderscore.pick(options, 'title', 'subtitle', 'save', 'ok', 'cancel', 'cancelFn', 'noCancelButton', 'noSubmitButton', 'content', 'danger', 'type', 'closeOnOverlayClick', 'buttonOrder'));\n    const dialog = new Dialog({\n      model: this.settings\n    }); // The model is here because itsa part of the BaseForm paradigm.\n    // It will be ignored in the context of a confirmation dialog.\n\n    dialog.render();\n    return dialog; // test hook\n  },\n\n  /**\n   * Fires up a notification banner\n   *\n   * @param  {Object} options Options Hash\n   * @return {Okta.View} the notification view\n   * @private\n   */\n  _notify: function (options) {\n    const notification = new Notification(options);\n    oktaJQueryStatic('#content').prepend(notification.render().el);\n    return notification; // test hook\n  },\n\n  /**\n   * Renders a Controller\n   * This will initialize new instance of a controller and call render on it\n   *\n   * @param  {Okta.Controller} Controller The controller Class we which to render\n   * @param  {Object} [options] Extra options to the controller constructor\n   */\n  render: function (Controller, options) {\n    this.unload();\n    options = oktaUnderscore.extend(oktaUnderscore.pick(this, 'settings', 'el'), options || {});\n    this.controller = new Controller(options);\n    this.controller.render();\n  },\n\n  /**\n   * Starts the backbone history object\n   *\n   * Waits for the dom to be ready before calling `Backbone.history.start()` (IE issue).\n   *\n   * See [Backbone History](http://backbonejs.org/#History) for more information.\n   */\n  start: function (...args) {\n    oktaJQueryStatic(function () {\n      if (Backbone.History.started) {\n        Logger.error('History has already been started');\n        return;\n      }\n\n      Backbone.history.start(...args);\n    });\n  },\n\n  /**\n   * Removes active controller and frees up event listeners\n   */\n  unload: function () {\n    if (this.controller) {\n      this.stopListening(this.controller);\n      this.stopListening(this.controller.state);\n      this.controller.remove();\n    }\n  },\n  route: function (route, name, callback) {\n    return Backbone.Router.prototype.route.call(this, getRoute(this, route), name, callback);\n  },\n  navigate: function (fragment, options) {\n    return Backbone.Router.prototype.navigate.call(this, getRoute(this, fragment), options);\n  }\n};\nvar BaseRouter = Backbone.Router.extend(props);\n\nexport { BaseRouter as default };\n"],"names":["getRoute","router","route","root","oktaUnderscore","result","isString","join","replace","props","listen","Notification","prototype","constructor","options","el","settings","SettingsModel","omit","Backbone","Router","apply","arguments","_notify","_confirm","Dialog","ConfirmationDialog","extend","pick","dialog","model","render","notification","oktaJQueryStatic","prepend","Controller","unload","controller","start","args","History","started","Logger","error","history","stopListening","state","remove","name","callback","call","navigate","fragment","BaseRouter"],"mappings":"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"}