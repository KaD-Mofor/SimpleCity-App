{"version":3,"file":"BaseModel.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/models/BaseModel.js"],"sourcesContent":["import oktaUnderscore from '../util/underscore-wrapper.js';\nimport Model from './Model.js';\n\nconst hasProps = function (model) {\n  const local = oktaUnderscore.omit(model.local, oktaUnderscore.keys(model._builtInLocalProps));\n\n  return oktaUnderscore.size(model.props) + oktaUnderscore.size(local) > 0;\n};\n\nconst props =\n/** @lends module:Okta.BaseModel.prototype */\n{\n  /**\n   * @type {Boolean}\n   */\n  flat: false,\n  constructor: function () {\n    Model.apply(this, arguments);\n    this.on('sync', this._setSynced);\n  },\n  allows: function () {\n    if (hasProps(this)) {\n      return Model.prototype.allows.apply(this, arguments);\n    } else {\n      return true;\n    }\n  },\n  // bw compatibility support for old computed properties\n  set: function (key, val) {\n    let attrs;\n\n    if (typeof key === 'object') {\n      attrs = key;\n    } else {\n      (attrs = {})[key] = val;\n    } // computed properties\n\n\n    oktaUnderscore(attrs).each(function (fn, attr) {\n      if (!fn || !oktaUnderscore.isArray(fn.__attributes)) {\n        return;\n      }\n\n      this.on('change:' + fn.__attributes.join(' change:'), function () {\n        const val = this.get(attr);\n\n        if (val !== this['__schema__'].computedProperties[attr]) {\n          this['__schema__'].computedProperties[attr] = val;\n          this.trigger('change:' + attr, val);\n        }\n      }, this);\n    }, this);\n\n    return Model.prototype.set.apply(this, arguments);\n  },\n\n  /**\n   * Get the current value of an attribute from the model. For example: `note.get(\"title\")`\n   *\n   * See [Model.get](http://backbonejs.org/#Model-get)\n   * @param {String} attribute\n   * @return {Mixed} The value of the model attribute\n   */\n  get: function () {\n    const value = Model.prototype.get.apply(this, arguments);\n\n    if (oktaUnderscore.isFunction(value)) {\n      return value.apply(this, oktaUnderscore.map(value.__attributes || [], this.get, this));\n    }\n\n    return value;\n  },\n\n  /**\n   * Return a shallow copy of the model's attributes for JSON stringification.\n   * This can be used for persistence, serialization, or for augmentation before being sent to the server.\n   * The name of this method is a bit confusing, as it doesn't actually return a JSON string â€”\n   *  but I'm afraid that it's the way that the JavaScript API for JSON.stringify works.\n   *\n   * ```javascript\n   * var artist = new Model({\n   *   firstName: \"Wassily\",\n   *   lastName: \"Kandinsky\"\n   * });\n   *\n   * artist.set({birthday: \"December 16, 1866\"});\n   * alert(JSON.stringify(artist)); // {\"firstName\":\"Wassily\",\"lastName\":\"Kandinsky\",\"birthday\":\"December 16, 1866\"}\n   * ```\n   * See [Model.toJSON](http://backbonejs.org/#Model-toJSON)\n   * @param  {Object} options\n   * @return {Object}\n   */\n  toJSON: function (options) {\n    options || (options = {});\n    const res = Model.prototype.toJSON.apply(this, arguments); // cleanup computed properties\n\n    oktaUnderscore(res).each(function (value, key) {\n      if (typeof value === 'function') {\n        if (options.verbose) {\n          res[key] = this.get(key);\n        } else {\n          delete res[key];\n        }\n      }\n    }, this); // cleanup private properties\n\n\n    if (!options.verbose) {\n      oktaUnderscore(res).each(function (value, key) {\n        if (/^__\\w+__$/.test(key)) {\n          delete res[key];\n        }\n      });\n    }\n\n    return res;\n  },\n  sanitizeAttributes: function (attributes) {\n    const attrs = {};\n\n    oktaUnderscore.each(attributes, function (value, key) {\n      if (!oktaUnderscore.isFunction(value)) {\n        attrs[key] = value;\n      }\n    });\n\n    return attrs;\n  },\n  reset: function (options) {\n    this.clear(options);\n    this.set(this.sanitizeAttributes(this.defaults), options);\n  },\n  clear: function (options) {\n    const attrs = {};\n\n    oktaUnderscore.each(this.sanitizeAttributes(this.attributes), function (value, key) {\n      attrs[key] = void 0;\n    });\n\n    return this.set(attrs, oktaUnderscore.extend({}, options, {\n      unset: true\n    }));\n  },\n\n  /**\n   * @private\n   */\n  _setSynced: function (newModel) {\n    this._syncedData = newModel && oktaUnderscore.isFunction(newModel.toJSON) ? newModel.toJSON() : {};\n  },\n\n  /**\n   * @private\n   */\n  _getSynced: function () {\n    return this._syncedData;\n  },\n  isSynced: function () {\n    return oktaUnderscore.isEqual(this._getSynced(), this.toJSON());\n  }\n};\nconst statics =\n/** @lends module:Okta.BaseModel.prototype */\n{\n  /**\n   * @static\n   *\n   * Example:\n   *\n   * ```javascript\n   * var Model = BaseModel.extend({\n   *   defaults: {\n   *     name: BaseModel.ComputedProperty(['fname', 'lname'], function (fname, lname) {\n   *       return fname + ' ' + lname;\n   *     })\n   *   }\n   * });\n   * var model = new Model({fname: 'Joe', lname: 'Doe'});\n   * model.get('name'); // Joe Doe\n   * model.toJSON(); // {fname: 'Joe', lname: 'Doe'}\n   * ```\n   *\n   * @param {Array} attributes (optional) - an array of the attribute names this method depends on\n   * @param {Function} callback the function that computes the value of the property\n   *\n   * @deprecated Use {@link #derived} instead\n   */\n  ComputedProperty: function (attributes, fn) {\n    // First parameter is optional\n    if (!fn && typeof attributes === 'function') {\n      fn = attributes;\n    } else {\n      fn.__attributes = attributes;\n    }\n\n    return fn;\n  }\n};\n/**\n * @class module:Okta.BaseModel\n * @extends module:Okta.Model\n * @deprecated Use {@link module:Okta.Model|Okta.Model} instead\n * @example\n * var Model = BaseModel.extend({\n *   defaults: {\n *     name: BaseModel.ComputedProperty(['fname', 'lname'], function (fname, lname) {\n *       return fname + ' ' + lname;\n *     })\n *   }\n * });\n * var model = new Model({fname: 'Joe', lname: 'Doe'});\n * model.get('name'); //=> \"Joe Doe\"\n * model.toJSON(); //=> {fname: 'Joe', lname: 'Doe'}\n *\n * model.set('__private__', 'private property');\n * model.get('__private__'); //=> \"private property\"\n * model.toJSON(); //=> {fname: 'Joe', lname: 'Doe'}\n */\n\nvar BaseModel = Model.extend(props, statics);\n\nexport { BaseModel as default };\n"],"names":["hasProps","model","local","oktaUnderscore","omit","keys","_builtInLocalProps","size","props","flat","constructor","Model","apply","arguments","on","_setSynced","allows","prototype","set","key","val","attrs","each","fn","attr","isArray","__attributes","join","get","computedProperties","trigger","value","isFunction","map","toJSON","options","res","verbose","test","sanitizeAttributes","attributes","reset","clear","defaults","extend","unset","newModel","_syncedData","_getSynced","isSynced","isEqual","statics","ComputedProperty","BaseModel"],"mappings":"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"}