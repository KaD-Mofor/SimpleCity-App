{"version":3,"file":"EnumTypeHelper.js","sources":["../../../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/views/forms/helpers/EnumTypeHelper.js"],"sourcesContent":["import oktaJQueryStatic from '../../../util/jquery-wrapper.js';\nimport oktaUnderscore from '../../../util/underscore-wrapper.js';\nimport SchemaUtils from '../../../util/SchemaUtil.js';\nimport StringUtil from '../../../util/StringUtil.js';\n\n/* eslint max-statements: 0 */\nconst NAME = 'name';\nconst ENUM_KEY_PREFIX = '_enum_';\n/**\n * Generate Input Options in order to create an input in an Form for Enum type attribute.\n * @param {Object} config informations for creating input options\n *   config.name        schema property name\n *   config.title       schema property title\n *   config.readOnly    create an read only input?\n *   config.explain     sub-title to the input\n *   config.enumValues  list of enum values for creating input options (Dropdown/SimpleCheckBoxSet)\n *   config.displayType display type of schema property\n *\n * @return {Object} inputOptions options for create an Input view. (Dropdown/SimpleCheckBoxSet)\n *\n */\n\nfunction getEnumInputOptions(config) {\n  const enumOneOf = convertToOneOf(config.enumValues);\n  const inputOptions = {\n    name: config.name,\n    label: config.title,\n    readOnly: config.readOnly,\n    customExplain: config.explain,\n    params: {\n      enumOneOf: enumOneOf\n    },\n    options: getDropdownOptionsFromOneOf(enumOneOf)\n  }; // input type\n\n  if (SchemaUtils.isArrayDataType(config.displayType)) {\n    inputOptions.type = 'checkboxset';\n    inputOptions.to = valuesToEnumObjects;\n    inputOptions.from = enumObjectsToValues;\n  } else {\n    inputOptions.type = 'select';\n    inputOptions.to = valueToEnumObject;\n    inputOptions.from = enumObjectToValue;\n  }\n\n  inputOptions.input = null;\n  return inputOptions;\n}\n\nfunction getDropdownOptions(values) {\n  return oktaUnderscore.isArray(values) ? getDropdownOptionsFromOneOf(convertToOneOf(values)) : {};\n}\n\nfunction getDropdownOptionsFromOneOf(values) {\n  if (!isOneOfEnumObject(values)) {\n    return {};\n  }\n\n  return oktaUnderscore.reduce(values, function (options, value, index) {\n    options[convertIndexToEnumIndex(index)] = value.title;\n    return options;\n  }, {});\n}\n\nfunction convertToOneOf(values) {\n  // assume this is a legacy enum array and convert to oneOf object\n  if (!oktaUnderscore.all(values, oktaJQueryStatic.isPlainObject)) {\n    return convertEnumToOneOf(values); // we assume object without const and title is an enum object which need special conversion\n  } else if (!isOneOfEnumObject(values)) {\n    return convertEnumObjectToOneOf(values);\n  }\n\n  return values;\n}\n\nfunction isOneOfEnumObject(values) {\n  return oktaUnderscore.isArray(values) && oktaUnderscore.all(values, function (value) {\n    return oktaUnderscore.has(value, 'const') && oktaUnderscore.has(value, 'title');\n  });\n}\n\nfunction convertEnumToOneOf(values) {\n  return oktaUnderscore.map(values, function (value) {\n    return {\n      const: value,\n      title: valueToTitle(value)\n    };\n  });\n}\n\nfunction valueToTitle(value) {\n  if (oktaUnderscore.isObject(value)) {\n    return JSON.stringify(value);\n  }\n\n  if (oktaUnderscore.isNumber(value)) {\n    return value + '';\n  }\n\n  return value;\n}\n\nfunction convertEnumObjectToOneOf(values) {\n  const findKey = oktaUnderscore.partial(oktaUnderscore.has, oktaUnderscore, NAME); // If all object found the key NAME, use the NAME's value as display name\n\n\n  if (oktaUnderscore.all(values, findKey)) {\n    return oktaUnderscore.chain(values).filter(function (value) {\n      return oktaJQueryStatic.isPlainObject(value) && oktaUnderscore.has(value, NAME);\n    }).map(function (value) {\n      return {\n        const: value,\n        title: value[NAME]\n      };\n    }).value();\n  } // Assume a legacy object array does not need special handling and just convert to const/title enum\n\n\n  return convertEnumToOneOf(values);\n}\n\nfunction convertIndexToEnumIndex(index) {\n  return `${ENUM_KEY_PREFIX}${index}`;\n}\n\nfunction enumObjectToValue(obj) {\n  const index = oktaUnderscore.findIndex(this.options.params.enumOneOf, function (oneOfObj) {\n    return oktaUnderscore.isObject(obj) ? oktaUnderscore.isEqual(oneOfObj.const, obj) : oneOfObj.const === obj;\n  }); // Cannot rely on comparator in findIndex when compare objects so need special handling\n\n\n  return index > -1 ? convertIndexToEnumIndex(index) : obj;\n}\n\nfunction valueToEnumObject(val) {\n  if (!oktaUnderscore.isString(val) || val.indexOf(ENUM_KEY_PREFIX) !== 0) {\n    return val;\n  }\n\n  const index = val.replace(ENUM_KEY_PREFIX, '');\n  const enumValue = this.options.params && oktaUnderscore.isArray(this.options.params.enumOneOf) ? this.options.params.enumOneOf[index] : null; // @see `getEnumInputOptions` how enumValues has been set.\n\n  return oktaUnderscore.has(enumValue, 'const') ? enumValue.const : enumValue;\n}\n\nfunction valuesToEnumObjects(values) {\n  return oktaUnderscore.map(values, valueToEnumObject.bind(this));\n}\n\nfunction enumObjectsToValues(values) {\n  return oktaUnderscore.map(values, enumObjectToValue.bind(this));\n}\n\nfunction isStringConstraint(value) {\n  return oktaUnderscore.isString(value) && oktaJQueryStatic.trim(value) !== '';\n}\n\nfunction isNumberConstraint(value) {\n  return oktaUnderscore.isNumber(value) || oktaUnderscore.isNumber(StringUtil.parseFloat(oktaJQueryStatic.trim(value)));\n}\n\nfunction isIntegerConstraint(value) {\n  const integer = oktaUnderscore.isNumber(value) ? value : StringUtil.parseInt(oktaJQueryStatic.trim(value));\n  return typeof integer === 'number' && isFinite(integer) && Math.floor(integer) === integer;\n}\n\nfunction isObjectConstraint(value) {\n  if (oktaUnderscore.isObject(value) && !oktaUnderscore.isArray(value)) {\n    return true;\n  }\n\n  const object = StringUtil.parseObject(oktaJQueryStatic.trim(value));\n  return oktaUnderscore.isObject(object) && !oktaUnderscore.isArray(object);\n}\n\nfunction isConstraintValueMatchType(value, type) {\n  switch (type) {\n    case SchemaUtils.STRING:\n      return isStringConstraint(value);\n\n    case SchemaUtils.NUMBER:\n      return isNumberConstraint(value);\n\n    case SchemaUtils.INTEGER:\n      return isIntegerConstraint(value);\n\n    case SchemaUtils.OBJECT:\n      return isObjectConstraint(value);\n  }\n}\n\nvar EnumTypeHelper = {\n  getEnumInputOptions: getEnumInputOptions,\n  getDropdownOptions: getDropdownOptions,\n  convertToOneOf: convertToOneOf,\n  isConstraintValueMatchType: isConstraintValueMatchType\n};\n\nexport { EnumTypeHelper as default };\n"],"names":["NAME","ENUM_KEY_PREFIX","getEnumInputOptions","config","enumOneOf","convertToOneOf","enumValues","inputOptions","name","label","title","readOnly","customExplain","explain","params","options","getDropdownOptionsFromOneOf","SchemaUtils","isArrayDataType","displayType","type","to","valuesToEnumObjects","from","enumObjectsToValues","valueToEnumObject","enumObjectToValue","input","getDropdownOptions","values","oktaUnderscore","isArray","isOneOfEnumObject","reduce","value","index","convertIndexToEnumIndex","all","oktaJQueryStatic","isPlainObject","convertEnumToOneOf","convertEnumObjectToOneOf","has","map","const","valueToTitle","isObject","JSON","stringify","isNumber","findKey","partial","chain","filter","obj","findIndex","oneOfObj","isEqual","val","isString","indexOf","replace","enumValue","bind","isStringConstraint","trim","isNumberConstraint","StringUtil","parseFloat","isIntegerConstraint","integer","parseInt","isFinite","Math","floor","isObjectConstraint","object","parseObject","isConstraintValueMatchType","STRING","NUMBER","INTEGER","OBJECT","EnumTypeHelper"],"mappings":";;;;;AAKA;AACA,MAAMA,IAAI,GAAG,MAAM,CAAA;AACnB,MAAMC,eAAe,GAAG,QAAQ,CAAA;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASC,mBAAmB,CAACC,MAAM,EAAE;AACnC,EAAA,MAAMC,SAAS,GAAGC,cAAc,CAACF,MAAM,CAACG,UAAU,CAAC,CAAA;AACnD,EAAA,MAAMC,YAAY,GAAG;IACnBC,IAAI,EAAEL,MAAM,CAACK,IAAI;IACjBC,KAAK,EAAEN,MAAM,CAACO,KAAK;IACnBC,QAAQ,EAAER,MAAM,CAACQ,QAAQ;IACzBC,aAAa,EAAET,MAAM,CAACU,OAAO;AAC7BC,IAAAA,MAAM,EAAE;AACNV,MAAAA,SAAS,EAAEA,SAAAA;KACZ;IACDW,OAAO,EAAEC,2BAA2B,CAACZ,SAAS,CAAA;AAChD,GAAC,CAAC;;EAEF,IAAIa,WAAW,CAACC,eAAe,CAACf,MAAM,CAACgB,WAAW,CAAC,EAAE;IACnDZ,YAAY,CAACa,IAAI,GAAG,aAAa,CAAA;IACjCb,YAAY,CAACc,EAAE,GAAGC,mBAAmB,CAAA;IACrCf,YAAY,CAACgB,IAAI,GAAGC,mBAAmB,CAAA;AACzC,GAAC,MAAM;IACLjB,YAAY,CAACa,IAAI,GAAG,QAAQ,CAAA;IAC5Bb,YAAY,CAACc,EAAE,GAAGI,iBAAiB,CAAA;IACnClB,YAAY,CAACgB,IAAI,GAAGG,iBAAiB,CAAA;AACvC,GAAA;EAEAnB,YAAY,CAACoB,KAAK,GAAG,IAAI,CAAA;AACzB,EAAA,OAAOpB,YAAY,CAAA;AACrB,CAAA;AAEA,SAASqB,kBAAkB,CAACC,MAAM,EAAE;AAClC,EAAA,OAAOC,cAAc,CAACC,OAAO,CAACF,MAAM,CAAC,GAAGb,2BAA2B,CAACX,cAAc,CAACwB,MAAM,CAAC,CAAC,GAAG,EAAE,CAAA;AAClG,CAAA;AAEA,SAASb,2BAA2B,CAACa,MAAM,EAAE;AAC3C,EAAA,IAAI,CAACG,iBAAiB,CAACH,MAAM,CAAC,EAAE;AAC9B,IAAA,OAAO,EAAE,CAAA;AACX,GAAA;AAEA,EAAA,OAAOC,cAAc,CAACG,MAAM,CAACJ,MAAM,EAAE,UAAUd,OAAO,EAAEmB,KAAK,EAAEC,KAAK,EAAE;IACpEpB,OAAO,CAACqB,uBAAuB,CAACD,KAAK,CAAC,CAAC,GAAGD,KAAK,CAACxB,KAAK,CAAA;AACrD,IAAA,OAAOK,OAAO,CAAA;GACf,EAAE,EAAE,CAAC,CAAA;AACR,CAAA;AAEA,SAASV,cAAc,CAACwB,MAAM,EAAE;AAC9B;EACA,IAAI,CAACC,cAAc,CAACO,GAAG,CAACR,MAAM,EAAES,gBAAgB,CAACC,aAAa,CAAC,EAAE;AAC/D,IAAA,OAAOC,kBAAkB,CAACX,MAAM,CAAC,CAAC;AACpC,GAAC,MAAM,IAAI,CAACG,iBAAiB,CAACH,MAAM,CAAC,EAAE;IACrC,OAAOY,wBAAwB,CAACZ,MAAM,CAAC,CAAA;AACzC,GAAA;AAEA,EAAA,OAAOA,MAAM,CAAA;AACf,CAAA;AAEA,SAASG,iBAAiB,CAACH,MAAM,EAAE;AACjC,EAAA,OAAOC,cAAc,CAACC,OAAO,CAACF,MAAM,CAAC,IAAIC,cAAc,CAACO,GAAG,CAACR,MAAM,EAAE,UAAUK,KAAK,EAAE;AACnF,IAAA,OAAOJ,cAAc,CAACY,GAAG,CAACR,KAAK,EAAE,OAAO,CAAC,IAAIJ,cAAc,CAACY,GAAG,CAACR,KAAK,EAAE,OAAO,CAAC,CAAA;AACjF,GAAC,CAAC,CAAA;AACJ,CAAA;AAEA,SAASM,kBAAkB,CAACX,MAAM,EAAE;EAClC,OAAOC,cAAc,CAACa,GAAG,CAACd,MAAM,EAAE,UAAUK,KAAK,EAAE;IACjD,OAAO;AACLU,MAAAA,KAAK,EAAEV,KAAK;MACZxB,KAAK,EAAEmC,YAAY,CAACX,KAAK,CAAA;KAC1B,CAAA;AACH,GAAC,CAAC,CAAA;AACJ,CAAA;AAEA,SAASW,YAAY,CAACX,KAAK,EAAE;AAC3B,EAAA,IAAIJ,cAAc,CAACgB,QAAQ,CAACZ,KAAK,CAAC,EAAE;AAClC,IAAA,OAAOa,IAAI,CAACC,SAAS,CAACd,KAAK,CAAC,CAAA;AAC9B,GAAA;AAEA,EAAA,IAAIJ,cAAc,CAACmB,QAAQ,CAACf,KAAK,CAAC,EAAE;IAClC,OAAOA,KAAK,GAAG,EAAE,CAAA;AACnB,GAAA;AAEA,EAAA,OAAOA,KAAK,CAAA;AACd,CAAA;AAEA,SAASO,wBAAwB,CAACZ,MAAM,EAAE;AACxC,EAAA,MAAMqB,OAAO,GAAGpB,cAAc,CAACqB,OAAO,CAACrB,cAAc,CAACY,GAAG,EAAEZ,cAAc,EAAE9B,IAAI,CAAC,CAAC;;EAGjF,IAAI8B,cAAc,CAACO,GAAG,CAACR,MAAM,EAAEqB,OAAO,CAAC,EAAE;IACvC,OAAOpB,cAAc,CAACsB,KAAK,CAACvB,MAAM,CAAC,CAACwB,MAAM,CAAC,UAAUnB,KAAK,EAAE;AAC1D,MAAA,OAAOI,gBAAgB,CAACC,aAAa,CAACL,KAAK,CAAC,IAAIJ,cAAc,CAACY,GAAG,CAACR,KAAK,EAAElC,IAAI,CAAC,CAAA;AACjF,KAAC,CAAC,CAAC2C,GAAG,CAAC,UAAUT,KAAK,EAAE;MACtB,OAAO;AACLU,QAAAA,KAAK,EAAEV,KAAK;QACZxB,KAAK,EAAEwB,KAAK,CAAClC,IAAI,CAAA;OAClB,CAAA;KACF,CAAC,CAACkC,KAAK,EAAE,CAAA;AACZ,GAAC;;EAGD,OAAOM,kBAAkB,CAACX,MAAM,CAAC,CAAA;AACnC,CAAA;AAEA,SAASO,uBAAuB,CAACD,KAAK,EAAE;AACtC,EAAA,OAAQ,CAAElC,EAAAA,eAAgB,CAAEkC,EAAAA,KAAM,CAAC,CAAA,CAAA;AACrC,CAAA;AAEA,SAAST,iBAAiB,CAAC4B,GAAG,EAAE;AAC9B,EAAA,MAAMnB,KAAK,GAAGL,cAAc,CAACyB,SAAS,CAAC,IAAI,CAACxC,OAAO,CAACD,MAAM,CAACV,SAAS,EAAE,UAAUoD,QAAQ,EAAE;IACxF,OAAO1B,cAAc,CAACgB,QAAQ,CAACQ,GAAG,CAAC,GAAGxB,cAAc,CAAC2B,OAAO,CAACD,QAAQ,CAACZ,KAAK,EAAEU,GAAG,CAAC,GAAGE,QAAQ,CAACZ,KAAK,KAAKU,GAAG,CAAA;GAC3G,CAAC,CAAC;;EAGH,OAAOnB,KAAK,GAAG,CAAC,CAAC,GAAGC,uBAAuB,CAACD,KAAK,CAAC,GAAGmB,GAAG,CAAA;AAC1D,CAAA;AAEA,SAAS7B,iBAAiB,CAACiC,GAAG,EAAE;AAC9B,EAAA,IAAI,CAAC5B,cAAc,CAAC6B,QAAQ,CAACD,GAAG,CAAC,IAAIA,GAAG,CAACE,OAAO,CAAC3D,eAAe,CAAC,KAAK,CAAC,EAAE;AACvE,IAAA,OAAOyD,GAAG,CAAA;AACZ,GAAA;EAEA,MAAMvB,KAAK,GAAGuB,GAAG,CAACG,OAAO,CAAC5D,eAAe,EAAE,EAAE,CAAC,CAAA;AAC9C,EAAA,MAAM6D,SAAS,GAAG,IAAI,CAAC/C,OAAO,CAACD,MAAM,IAAIgB,cAAc,CAACC,OAAO,CAAC,IAAI,CAAChB,OAAO,CAACD,MAAM,CAACV,SAAS,CAAC,GAAG,IAAI,CAACW,OAAO,CAACD,MAAM,CAACV,SAAS,CAAC+B,KAAK,CAAC,GAAG,IAAI,CAAC;;AAE7I,EAAA,OAAOL,cAAc,CAACY,GAAG,CAACoB,SAAS,EAAE,OAAO,CAAC,GAAGA,SAAS,CAAClB,KAAK,GAAGkB,SAAS,CAAA;AAC7E,CAAA;AAEA,SAASxC,mBAAmB,CAACO,MAAM,EAAE;AACnC,EAAA,OAAOC,cAAc,CAACa,GAAG,CAACd,MAAM,EAAEJ,iBAAiB,CAACsC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAA;AACjE,CAAA;AAEA,SAASvC,mBAAmB,CAACK,MAAM,EAAE;AACnC,EAAA,OAAOC,cAAc,CAACa,GAAG,CAACd,MAAM,EAAEH,iBAAiB,CAACqC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAA;AACjE,CAAA;AAEA,SAASC,kBAAkB,CAAC9B,KAAK,EAAE;AACjC,EAAA,OAAOJ,cAAc,CAAC6B,QAAQ,CAACzB,KAAK,CAAC,IAAII,gBAAgB,CAAC2B,IAAI,CAAC/B,KAAK,CAAC,KAAK,EAAE,CAAA;AAC9E,CAAA;AAEA,SAASgC,kBAAkB,CAAChC,KAAK,EAAE;EACjC,OAAOJ,cAAc,CAACmB,QAAQ,CAACf,KAAK,CAAC,IAAIJ,cAAc,CAACmB,QAAQ,CAACkB,UAAU,CAACC,UAAU,CAAC9B,gBAAgB,CAAC2B,IAAI,CAAC/B,KAAK,CAAC,CAAC,CAAC,CAAA;AACvH,CAAA;AAEA,SAASmC,mBAAmB,CAACnC,KAAK,EAAE;EAClC,MAAMoC,OAAO,GAAGxC,cAAc,CAACmB,QAAQ,CAACf,KAAK,CAAC,GAAGA,KAAK,GAAGiC,UAAU,CAACI,QAAQ,CAACjC,gBAAgB,CAAC2B,IAAI,CAAC/B,KAAK,CAAC,CAAC,CAAA;AAC1G,EAAA,OAAO,OAAOoC,OAAO,KAAK,QAAQ,IAAIE,QAAQ,CAACF,OAAO,CAAC,IAAIG,IAAI,CAACC,KAAK,CAACJ,OAAO,CAAC,KAAKA,OAAO,CAAA;AAC5F,CAAA;AAEA,SAASK,kBAAkB,CAACzC,KAAK,EAAE;AACjC,EAAA,IAAIJ,cAAc,CAACgB,QAAQ,CAACZ,KAAK,CAAC,IAAI,CAACJ,cAAc,CAACC,OAAO,CAACG,KAAK,CAAC,EAAE;AACpE,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEA,EAAA,MAAM0C,MAAM,GAAGT,UAAU,CAACU,WAAW,CAACvC,gBAAgB,CAAC2B,IAAI,CAAC/B,KAAK,CAAC,CAAC,CAAA;AACnE,EAAA,OAAOJ,cAAc,CAACgB,QAAQ,CAAC8B,MAAM,CAAC,IAAI,CAAC9C,cAAc,CAACC,OAAO,CAAC6C,MAAM,CAAC,CAAA;AAC3E,CAAA;AAEA,SAASE,0BAA0B,CAAC5C,KAAK,EAAEd,IAAI,EAAE;AAC/C,EAAA,QAAQA,IAAI;IACV,KAAKH,WAAW,CAAC8D,MAAM;MACrB,OAAOf,kBAAkB,CAAC9B,KAAK,CAAC,CAAA;IAElC,KAAKjB,WAAW,CAAC+D,MAAM;MACrB,OAAOd,kBAAkB,CAAChC,KAAK,CAAC,CAAA;IAElC,KAAKjB,WAAW,CAACgE,OAAO;MACtB,OAAOZ,mBAAmB,CAACnC,KAAK,CAAC,CAAA;IAEnC,KAAKjB,WAAW,CAACiE,MAAM;MACrB,OAAOP,kBAAkB,CAACzC,KAAK,CAAC,CAAA;AAAC,GAAA;AAEvC,CAAA;AAEA,IAAIiD,cAAc,GAAG;AACnBjF,EAAAA,mBAAmB,EAAEA,mBAAmB;AACxC0B,EAAAA,kBAAkB,EAAEA,kBAAkB;AACtCvB,EAAAA,cAAc,EAAEA,cAAc;AAC9ByE,EAAAA,0BAA0B,EAAEA,0BAAAA;AAC9B;;;;"}