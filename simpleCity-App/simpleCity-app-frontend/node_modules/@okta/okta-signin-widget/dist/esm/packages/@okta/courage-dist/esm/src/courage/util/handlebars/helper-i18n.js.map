{"version":3,"file":"helper-i18n.js","sources":["../../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/util/handlebars/helper-i18n.js"],"sourcesContent":["import _Handlebars2 from '../../../../lib/handlebars/dist/cjs/handlebars.runtime.js';\nexport { default } from '../../../../lib/handlebars/dist/cjs/handlebars.runtime.js';\nimport oktaUnderscore from '../underscore-wrapper.js';\nimport Logger from '../Logger.js';\nimport StringUtil from '../StringUtil.js';\n\n/* eslint @okta/okta-ui/no-specific-modules: 0 */\nconst hbsEscape = _Handlebars2.Utils.escapeExpression;\n\nfunction trim(str) {\n  return str && str.replace(/^\\s+|\\s+$/g, '');\n}\n\nfunction replaceTagsWithPlaceholders(source, tag, tagValue) {\n  const escapedBeginningTag = hbsEscape(`<${tag}>`);\n  const escapedEndTag = hbsEscape(`</${tag}>`);\n  const [beginningTag, endTag] = tagValue.split(tag);\n\n  if (!source.includes(escapedBeginningTag) && !source.includes(escapedEndTag)) {\n    throw Error(`Parsed tag \"${tag}\" is not present in \"${source}\"`);\n  } else if (!tagValue.includes(tag)) {\n    throw Error(`Parsed tag \"${tag}\" is not present in \"${tagValue}\"`);\n  } else if (!beginningTag || !endTag) {\n    throw Error(`Template value \"${tagValue}\" must contain beginning and closing tags`);\n  }\n\n  return source.replace(escapedBeginningTag, beginningTag).replace(escapedEndTag, endTag);\n}\n/* eslint max-statements: [2, 18] */\n\n\n_Handlebars2.registerHelper('i18n', function i18n(options) {\n  let params;\n  const key = trim(options.hash.code);\n  const bundle = trim(options.hash.bundle);\n  const args = trim(options.hash.arguments);\n  const tags = Object.keys(options.hash).filter(prop => prop.match(/^\\$\\d+/)).map(prop => ({\n    tag: prop,\n    value: options.hash[prop]\n  }));\n\n  if (args) {\n    params = oktaUnderscore.map(trim(args).split(';'), function mapParam(param) {\n      param = trim(param);\n      let val;\n      /*\n       * the context(data) may be a deep object, ex {user: {name: 'John', gender: 'M'}}\n       * arguments may be 'user.name'\n       * return data['user']['name']\n       */\n\n      oktaUnderscore.each(param.split('.'), p => {\n        val = val ? val[p] : this[p];\n      });\n\n      return val;\n    }, this);\n  }\n\n  const localizedValue = StringUtil.localize(key, bundle, params);\n\n  if (tags.length < 1) {\n    // No HTML tags provided - return the localized and escaped string\n    return localizedValue;\n  }\n\n  let escapedString = hbsEscape(localizedValue);\n\n  try {\n    tags.forEach(tag => {\n      escapedString = replaceTagsWithPlaceholders(escapedString, tag.tag, tag.value);\n    });\n    return new _Handlebars2.SafeString(escapedString);\n  } catch (err) {\n    Logger.error(err.toString());\n    return localizedValue;\n  }\n});\n"],"names":["hbsEscape","_Handlebars2","Utils","escapeExpression","trim","str","replace","replaceTagsWithPlaceholders","source","tag","tagValue","escapedBeginningTag","escapedEndTag","beginningTag","endTag","split","includes","Error","registerHelper","i18n","options","params","key","hash","code","bundle","args","arguments","tags","Object","keys","filter","prop","match","map","value","oktaUnderscore","mapParam","param","val","each","p","localizedValue","StringUtil","localize","length","escapedString","forEach","SafeString","err","Logger","error","toString"],"mappings":"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"}