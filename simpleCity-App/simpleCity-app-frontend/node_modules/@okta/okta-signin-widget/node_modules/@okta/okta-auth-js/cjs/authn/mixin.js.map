{"version":3,"file":"mixin.js","names":["mixinAuthn","Base","OktaAuthTx","constructor","args","authn","tx","createAuthnTransactionAPI","fingerprint","bind","signIn","opts","clone","_postToTransaction","options","sendFingerprint","postToTransaction","then","headers","signInWithCredentials","forgotPassword","unlockAccount","verifyRecoveryToken"],"sources":["../../../lib/authn/mixin.ts"],"sourcesContent":["/* eslint-disable max-statements */\n/* eslint-disable complexity */\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { \n  clone,\n} from '../util';\nimport fingerprint from '../browser/fingerprint';\nimport {\n  FingerprintAPI,\n  SigninWithCredentialsOptions,\n  ForgotPasswordOptions,\n  VerifyRecoveryTokenOptions,\n  SigninOptions,\n  OktaAuthTxInterface,\n  AuthnTransaction,\n  AuthnTransactionAPI\n} from './types';\nimport {\n  createAuthnTransactionAPI,\n} from './factory';\nimport { StorageManagerInterface } from '../storage/types';\nimport { OktaAuthHttpInterface, OktaAuthHttpOptions } from '../http/types';\nimport { OktaAuthConstructor } from '../base/types';\n\nexport function mixinAuthn\n<\n  S extends StorageManagerInterface = StorageManagerInterface,\n  O extends OktaAuthHttpOptions = OktaAuthHttpOptions,\n  TBase extends OktaAuthConstructor<OktaAuthHttpInterface<S, O>>\n    = OktaAuthConstructor<OktaAuthHttpInterface<S, O>>\n>\n(Base: TBase): TBase & OktaAuthConstructor<OktaAuthTxInterface<S, O>>\n{\n  return class OktaAuthTx extends Base implements OktaAuthTxInterface<S, O> {\n    tx: AuthnTransactionAPI; // legacy, may be removed in future version\n    authn: AuthnTransactionAPI;\n    fingerprint: FingerprintAPI;\n\n    constructor(...args: any[]) {\n      super(...args);\n\n      this.authn = this.tx = createAuthnTransactionAPI(this);\n      \n      // Fingerprint API\n      this.fingerprint = fingerprint.bind(null, this);\n    }\n\n    // Authn  V1\n    async signIn(opts: SigninOptions): Promise<AuthnTransaction> {\n      opts = clone(opts || {});\n      const _postToTransaction = (options?) => {\n        delete opts.sendFingerprint;\n        return this.tx.postToTransaction('/api/v1/authn', opts, options);\n      };\n      if (!opts.sendFingerprint) {\n        return _postToTransaction();\n      }\n      return this.fingerprint()\n      .then(function(fingerprint) {\n        return _postToTransaction({\n          headers: {\n            'X-Device-Fingerprint': fingerprint\n          }\n        });\n      });\n    }\n\n    // Authn  V1\n    async signInWithCredentials(opts: SigninWithCredentialsOptions): Promise<AuthnTransaction> {\n      return this.signIn(opts);\n    }\n\n    // { username, (relayState) }\n    forgotPassword(opts): Promise<AuthnTransaction> {\n      return this.tx.postToTransaction('/api/v1/authn/recovery/password', opts);\n    }\n\n    // { username, (relayState) }\n    unlockAccount(opts: ForgotPasswordOptions): Promise<AuthnTransaction> {\n      return this.tx.postToTransaction('/api/v1/authn/recovery/unlock', opts);\n    }\n\n    // { recoveryToken }\n    verifyRecoveryToken(opts: VerifyRecoveryTokenOptions): Promise<AuthnTransaction> {\n      return this.tx.postToTransaction('/api/v1/authn/recovery/token', opts);\n    }\n\n  };\n}\n"],"mappings":";;;;;;AAcA;;AAGA;;AAWA;;AA5BA;;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAuBO,SAASA,UAAT,CAONC,IAPM,EAQP;EACE,OAAO,MAAMC,UAAN,SAAyBD,IAAzB,CAAmE;IAC/C;IAIzBE,WAAW,CAAC,GAAGC,IAAJ,EAAiB;MAC1B,MAAM,GAAGA,IAAT;MAEA,KAAKC,KAAL,GAAa,KAAKC,EAAL,GAAU,IAAAC,kCAAA,EAA0B,IAA1B,CAAvB,CAH0B,CAK1B;;MACA,KAAKC,WAAL,GAAmBA,oBAAA,CAAYC,IAAZ,CAAiB,IAAjB,EAAuB,IAAvB,CAAnB;IACD,CAZuE,CAcxE;;;IACY,MAANC,MAAM,CAACC,IAAD,EAAiD;MAC3DA,IAAI,GAAG,IAAAC,WAAA,EAAMD,IAAI,IAAI,EAAd,CAAP;;MACA,MAAME,kBAAkB,GAAIC,OAAD,IAAc;QACvC,OAAOH,IAAI,CAACI,eAAZ;QACA,OAAO,KAAKT,EAAL,CAAQU,iBAAR,CAA0B,eAA1B,EAA2CL,IAA3C,EAAiDG,OAAjD,CAAP;MACD,CAHD;;MAIA,IAAI,CAACH,IAAI,CAACI,eAAV,EAA2B;QACzB,OAAOF,kBAAkB,EAAzB;MACD;;MACD,OAAO,KAAKL,WAAL,GACNS,IADM,CACD,UAAST,WAAT,EAAsB;QAC1B,OAAOK,kBAAkB,CAAC;UACxBK,OAAO,EAAE;YACP,wBAAwBV;UADjB;QADe,CAAD,CAAzB;MAKD,CAPM,CAAP;IAQD,CAhCuE,CAkCxE;;;IAC2B,MAArBW,qBAAqB,CAACR,IAAD,EAAgE;MACzF,OAAO,KAAKD,MAAL,CAAYC,IAAZ,CAAP;IACD,CArCuE,CAuCxE;;;IACAS,cAAc,CAACT,IAAD,EAAkC;MAC9C,OAAO,KAAKL,EAAL,CAAQU,iBAAR,CAA0B,iCAA1B,EAA6DL,IAA7D,CAAP;IACD,CA1CuE,CA4CxE;;;IACAU,aAAa,CAACV,IAAD,EAAyD;MACpE,OAAO,KAAKL,EAAL,CAAQU,iBAAR,CAA0B,+BAA1B,EAA2DL,IAA3D,CAAP;IACD,CA/CuE,CAiDxE;;;IACAW,mBAAmB,CAACX,IAAD,EAA8D;MAC/E,OAAO,KAAKL,EAAL,CAAQU,iBAAR,CAA0B,8BAA1B,EAA0DL,IAA1D,CAAP;IACD;;EApDuE,CAA1E;AAuDD"}