{"version":3,"file":"api.js","names":["transactionStatus","sdk","args","addStateToken","post","getIssuerOrigin","withCredentials","resumeTransaction","tx","stateToken","getSavedStateToken","Promise","reject","AuthSdkError","then","res","createTransaction","introspectAuthn","transactionStep","transactionExists","postToTransaction","url","options","Object","assign","storage","storageUtil","get","STATE_TOKEN_KEY_NAME"],"sources":["../../../lib/authn/api.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n\n/* eslint-disable complexity, max-statements */\nimport { post } from '../http';\nimport AuthSdkError from '../errors/AuthSdkError';\nimport { STATE_TOKEN_KEY_NAME } from '../constants';\nimport { OktaAuthHttpInterface } from '../http/types';\nimport { OktaAuthStorageOptions } from '../storage/types';\nimport { addStateToken } from './util/stateToken';\nimport { AuthnTransactionAPI } from './types';\nimport { OktaAuthBaseInterface } from '../base/types';\n\nexport function transactionStatus(sdk: OktaAuthHttpInterface, args) {\n  args = addStateToken(sdk, args);\n  return post(sdk, sdk.getIssuerOrigin() + '/api/v1/authn', args, { withCredentials: true });\n}\n\nexport function resumeTransaction(sdk: OktaAuthHttpInterface, tx: AuthnTransactionAPI, args) {\n  if (!args || !args.stateToken) {\n    var stateToken = getSavedStateToken(sdk);\n    if (stateToken) {\n      args = {\n        stateToken: stateToken\n      };\n    } else {\n      return Promise.reject(new AuthSdkError('No transaction to resume'));\n    }\n  }\n  return transactionStatus(sdk, args)\n    .then(function(res) {\n      return tx.createTransaction(res);\n    });\n}\n\nexport function introspectAuthn (sdk: OktaAuthHttpInterface, tx: AuthnTransactionAPI, args) {\n  if (!args || !args.stateToken) {\n    var stateToken = getSavedStateToken(sdk);\n    if (stateToken) {\n      args = {\n        stateToken: stateToken\n      };\n    } else {\n      return Promise.reject(new AuthSdkError('No transaction to evaluate'));\n    }\n  }\n  return transactionStep(sdk, args)\n    .then(function (res) {\n      return tx.createTransaction(res);\n    });\n}\n\nexport function transactionStep(sdk: OktaAuthHttpInterface, args) {\n  args = addStateToken(sdk, args);\n  // v1 pipeline introspect API\n  return post(sdk, sdk.getIssuerOrigin() + '/api/v1/authn/introspect', args, { withCredentials: true });\n}\n\nexport function transactionExists(sdk: OktaAuthBaseInterface<OktaAuthStorageOptions>) {\n  // We have a cookie state token\n  return !!getSavedStateToken(sdk);\n}\n\nexport function postToTransaction(sdk: OktaAuthHttpInterface, tx: AuthnTransactionAPI, url: string, args, options?) {\n  options = Object.assign({ withCredentials: true }, options);\n  return post(sdk, url, args, options)\n    .then(function(res) {\n      return tx.createTransaction(res);\n    });\n}\n\nexport function getSavedStateToken(sdk: OktaAuthBaseInterface<OktaAuthStorageOptions>) {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const storage = sdk.options.storageUtil!.storage;\n    return storage.get(STATE_TOKEN_KEY_NAME);\n}\n"],"mappings":"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"}