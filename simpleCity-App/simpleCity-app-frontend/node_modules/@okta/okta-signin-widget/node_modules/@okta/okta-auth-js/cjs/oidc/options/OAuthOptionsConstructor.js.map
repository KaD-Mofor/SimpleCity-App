{"version":3,"file":"OAuthOptionsConstructor.js","names":["assertValidConfig","args","scopes","Array","isArray","AuthSdkError","issuer","isUrlRegex","RegExp","test","indexOf","createOAuthOptionsConstructor","HttpOptionsConstructor","createHttpOptionsConstructor","OAuthOptionsConstructor","constructor","options","removeTrailingSlash","tokenUrl","authorizeUrl","userinfoUrl","revokeUrl","logoutUrl","pkce","clientId","redirectUri","isBrowser","toAbsoluteUrl","window","location","origin","responseType","responseMode","state","ignoreSignature","codeChallenge","codeChallengeMethod","tokenManager","postLogoutRedirectUri","restoreOriginalUri","transactionManager","enableSharedStorage","clientSecret","setLocation","ignoreLifetime","maxClockSkew","DEFAULT_MAX_CLOCK_SKEW"],"sources":["../../../../lib/oidc/options/OAuthOptionsConstructor.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { DEFAULT_MAX_CLOCK_SKEW } from '../../constants';\nimport { removeTrailingSlash, toAbsoluteUrl } from '../../util/url';\nimport { isBrowser } from '../../features';\nimport { createHttpOptionsConstructor } from '../../http/options';\nimport {\n  OAuthResponseMode,\n  OAuthResponseType,\n  OktaAuthOAuthInterface,\n  OktaAuthOAuthOptions,\n  SetLocationFunction,\n  TokenManagerOptions,\n  TransactionManagerOptions\n} from '../types';\nimport { enableSharedStorage } from './node';\nimport AuthSdkError from '../../errors/AuthSdkError';\n\nfunction assertValidConfig(args) {\n  args = args || {};\n\n  var scopes = args.scopes;\n  if (scopes && !Array.isArray(scopes)) {\n    throw new AuthSdkError('scopes must be a array of strings. ' +\n      'Required usage: new OktaAuth({scopes: [\"openid\", \"email\"]})');\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  var issuer = args.issuer!;\n  if (!issuer) {\n    throw new AuthSdkError('No issuer passed to constructor. ' + \n      'Required usage: new OktaAuth({issuer: \"https://{yourOktaDomain}.com/oauth2/{authServerId}\"})');\n  }\n\n  var isUrlRegex = new RegExp('^http?s?://.+');\n  if (!isUrlRegex.test(issuer)) {\n    throw new AuthSdkError('Issuer must be a valid URL. ' + \n      'Required usage: new OktaAuth({issuer: \"https://{yourOktaDomain}.com/oauth2/{authServerId}\"})');\n  }\n\n  if (issuer.indexOf('-admin.') !== -1) {\n    throw new AuthSdkError('Issuer URL passed to constructor contains \"-admin\" in subdomain. ' +\n      'Required usage: new OktaAuth({issuer: \"https://{yourOktaDomain}.com})');\n  }\n}\n\nexport function createOAuthOptionsConstructor() {\n  const HttpOptionsConstructor = createHttpOptionsConstructor();\n  return class OAuthOptionsConstructor\n    extends HttpOptionsConstructor\n    implements Required<OktaAuthOAuthOptions>\n  {\n    // CustomUrls\n    issuer: string;\n    authorizeUrl: string;\n    userinfoUrl: string;\n    tokenUrl: string;\n    revokeUrl: string;\n    logoutUrl: string;\n    \n    // TokenParams\n    pkce: boolean;\n    clientId: string;\n    redirectUri: string;\n    responseType: OAuthResponseType | OAuthResponseType[];\n    responseMode: OAuthResponseMode;\n    state: string;\n    scopes: string[];\n    ignoreSignature: boolean;\n    codeChallenge: string;\n    codeChallengeMethod: string;\n\n    // Additional options\n    tokenManager: TokenManagerOptions;\n    postLogoutRedirectUri: string;\n    restoreOriginalUri: (oktaAuth: OktaAuthOAuthInterface, originalUri?: string) => Promise<void>;\n    transactionManager: TransactionManagerOptions;\n\n    // For server-side web applications ONLY!\n    clientSecret: string;\n    setLocation: SetLocationFunction;\n\n    // Workaround for bad client time/clock\n    ignoreLifetime: boolean;\n    maxClockSkew: number;\n\n\n    // eslint-disable-next-line max-statements\n    constructor(options: any) {\n      super(options);\n      \n      assertValidConfig(options);\n      \n      this.issuer = removeTrailingSlash(options.issuer);\n      this.tokenUrl = removeTrailingSlash(options.tokenUrl);\n      this.authorizeUrl = removeTrailingSlash(options.authorizeUrl);\n      this.userinfoUrl = removeTrailingSlash(options.userinfoUrl);\n      this.revokeUrl = removeTrailingSlash(options.revokeUrl);\n      this.logoutUrl = removeTrailingSlash(options.logoutUrl);\n\n      this.pkce = options.pkce === false ? false : true; // PKCE defaults to true\n      this.clientId = options.clientId;\n      this.redirectUri = options.redirectUri;\n      if (isBrowser()) {\n        this.redirectUri = toAbsoluteUrl(options.redirectUri, window.location.origin); // allow relative URIs\n      }\n      this.responseType = options.responseType;\n      this.responseMode = options.responseMode;\n      this.state = options.state;\n      this.scopes = options.scopes;\n      // Give the developer the ability to disable token signature validation.\n      this.ignoreSignature = !!options.ignoreSignature;\n      this.codeChallenge = options.codeChallenge;\n      this.codeChallengeMethod = options.codeChallengeMethod;\n\n      this.tokenManager = options.tokenManager;\n      this.postLogoutRedirectUri = options.postLogoutRedirectUri;\n      this.restoreOriginalUri = options.restoreOriginalUri;\n      this.transactionManager = { enableSharedStorage, ...options.transactionManager };\n      \n      this.clientSecret = options.clientSecret;\n      this.setLocation = options.setLocation;\n      \n      // As some end user's devices can have their date \n      // and time incorrectly set, allow for the disabling\n      // of the jwt liftetime validation\n      this.ignoreLifetime = !!options.ignoreLifetime;\n\n      // Digital clocks will drift over time, so the server\n      // can misalign with the time reported by the browser.\n      // The maxClockSkew allows relaxing the time-based\n      // validation of tokens (in seconds, not milliseconds).\n      // It currently defaults to 300, because 5 min is the\n      // default maximum tolerance allowed by Kerberos.\n      // (https://technet.microsoft.com/en-us/library/cc976357.aspx)\n      if (!options.maxClockSkew && options.maxClockSkew !== 0) {\n        this.maxClockSkew = DEFAULT_MAX_CLOCK_SKEW;\n      } else {\n        this.maxClockSkew = options.maxClockSkew;\n      }\n\n    }\n  };\n}\n"],"mappings":"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"}