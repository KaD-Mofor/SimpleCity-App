{"version":3,"file":"storage.js","names":["createIdxStorageManager","CoreStorageManager","createCoreStorageManager","IdxStorageManager","constructor","storageManagerOptions","cookieOptions","storageUtil","getIdxResponseStorage","options","storage","isBrowser","getStorageByType","e","warn","transactionStorage","getTransactionStorage","getItem","key","transaction","getStorage","setItem","val","AuthSdkError","setStorage","removeItem","SavedObject","IDX_RESPONSE_STORAGE_NAME"],"sources":["../../../lib/idx/storage.ts"],"sourcesContent":["import { CookieOptions, StorageManagerOptions, StorageOptions, StorageUtil } from '../storage/types';\nimport {  IdxTransactionMeta } from './types';\nimport { SavedObject } from '../storage';\nimport { IDX_RESPONSE_STORAGE_NAME } from '../constants';\nimport { createCoreStorageManager } from '../core/storage';\nimport { IdxResponseStorage } from './types/storage';\nimport { isBrowser } from '../features';\nimport { warn } from '../util';\nimport AuthSdkError from '../errors/AuthSdkError';\n\nexport function createIdxStorageManager<M extends IdxTransactionMeta>()\n{\n  const CoreStorageManager = createCoreStorageManager<M>();\n  return class IdxStorageManager extends CoreStorageManager\n  {\n    constructor(storageManagerOptions: StorageManagerOptions, cookieOptions: CookieOptions, storageUtil: StorageUtil) {\n      super(storageManagerOptions, cookieOptions, storageUtil);\n    }\n\n    // intermediate idxResponse\n    // store for network traffic optimazation purpose\n    // TODO: revisit in auth-js 6.0 epic JIRA: OKTA-399791\n    getIdxResponseStorage(options?: StorageOptions): IdxResponseStorage | null {\n      let storage;\n      if (isBrowser()) {\n        // on browser side only use memory storage \n        try {\n          storage = this.storageUtil.getStorageByType('memory', options);\n        } catch (e) {\n          // it's ok to miss response storage\n          // eslint-disable-next-line max-len\n          warn('No response storage found, you may want to provide custom implementation for intermediate idx responses to optimize the network traffic');\n        }\n      } else {\n        // on server side re-use transaction custom storage\n        const transactionStorage = this.getTransactionStorage(options);\n        if (transactionStorage) {\n          storage = {\n            getItem: (key) => {\n              const transaction = transactionStorage.getStorage();\n              if (transaction && transaction[key]) {\n                return transaction[key];\n              }\n              return null;\n            },\n            setItem: (key, val) => {\n              const transaction = transactionStorage.getStorage();\n              if (!transaction) {\n                throw new AuthSdkError('Transaction has been cleared, failed to save idxState');\n              }\n              transaction[key] = val;\n              transactionStorage.setStorage(transaction);\n            },\n            removeItem: (key) => {\n              const transaction = transactionStorage.getStorage();\n              if (!transaction) {\n                return;\n              }\n              delete transaction[key];\n              transactionStorage.setStorage(transaction);\n            }\n          };\n        }\n      }\n\n      if (!storage) {\n        return null;\n      }\n\n      return new SavedObject(storage, IDX_RESPONSE_STORAGE_NAME);\n    }\n  };\n}\n"],"mappings":";;;;;;AAEA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AAEO,SAASA,uBAAT,GACP;EACE,MAAMC,kBAAkB,GAAG,IAAAC,kCAAA,GAA3B;EACA,OAAO,MAAMC,iBAAN,SAAgCF,kBAAhC,CACP;IACEG,WAAW,CAACC,qBAAD,EAA+CC,aAA/C,EAA6EC,WAA7E,EAAuG;MAChH,MAAMF,qBAAN,EAA6BC,aAA7B,EAA4CC,WAA5C;IACD,CAHH,CAKE;IACA;IACA;;;IACAC,qBAAqB,CAACC,OAAD,EAAsD;MACzE,IAAIC,OAAJ;;MACA,IAAI,IAAAC,mBAAA,GAAJ,EAAiB;QACf;QACA,IAAI;UACFD,OAAO,GAAG,KAAKH,WAAL,CAAiBK,gBAAjB,CAAkC,QAAlC,EAA4CH,OAA5C,CAAV;QACD,CAFD,CAEE,OAAOI,CAAP,EAAU;UACV;UACA;UACA,IAAAC,UAAA,EAAK,yIAAL;QACD;MACF,CATD,MASO;QACL;QACA,MAAMC,kBAAkB,GAAG,KAAKC,qBAAL,CAA2BP,OAA3B,CAA3B;;QACA,IAAIM,kBAAJ,EAAwB;UACtBL,OAAO,GAAG;YACRO,OAAO,EAAGC,GAAD,IAAS;cAChB,MAAMC,WAAW,GAAGJ,kBAAkB,CAACK,UAAnB,EAApB;;cACA,IAAID,WAAW,IAAIA,WAAW,CAACD,GAAD,CAA9B,EAAqC;gBACnC,OAAOC,WAAW,CAACD,GAAD,CAAlB;cACD;;cACD,OAAO,IAAP;YACD,CAPO;YAQRG,OAAO,EAAE,CAACH,GAAD,EAAMI,GAAN,KAAc;cACrB,MAAMH,WAAW,GAAGJ,kBAAkB,CAACK,UAAnB,EAApB;;cACA,IAAI,CAACD,WAAL,EAAkB;gBAChB,MAAM,IAAII,qBAAJ,CAAiB,uDAAjB,CAAN;cACD;;cACDJ,WAAW,CAACD,GAAD,CAAX,GAAmBI,GAAnB;cACAP,kBAAkB,CAACS,UAAnB,CAA8BL,WAA9B;YACD,CAfO;YAgBRM,UAAU,EAAGP,GAAD,IAAS;cACnB,MAAMC,WAAW,GAAGJ,kBAAkB,CAACK,UAAnB,EAApB;;cACA,IAAI,CAACD,WAAL,EAAkB;gBAChB;cACD;;cACD,OAAOA,WAAW,CAACD,GAAD,CAAlB;cACAH,kBAAkB,CAACS,UAAnB,CAA8BL,WAA9B;YACD;UAvBO,CAAV;QAyBD;MACF;;MAED,IAAI,CAACT,OAAL,EAAc;QACZ,OAAO,IAAP;MACD;;MAED,OAAO,IAAIgB,oBAAJ,CAAgBhB,OAAhB,EAAyBiB,oCAAzB,CAAP;IACD;;EAxDH,CADA;AA2DD"}