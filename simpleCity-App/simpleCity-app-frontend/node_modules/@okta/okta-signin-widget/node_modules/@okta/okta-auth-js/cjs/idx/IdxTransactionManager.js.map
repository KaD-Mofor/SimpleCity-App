{"version":3,"file":"IdxTransactionManager.js","names":["createIdxTransactionManager","TransactionManager","createTransactionManager","IdxTransactionManager","constructor","options","clear","clearIdxResponse","saveIdxResponse","data","saveLastResponse","storage","storageManager","getIdxResponseStorage","setStorage","loadIdxResponse","storedValue","getStorage","isRawIdxResponse","rawIdxResponse","stateHandle","interactionHandle","clearStorage"],"sources":["../../../lib/idx/IdxTransactionManager.ts"],"sourcesContent":["import { ClearTransactionMetaOptions, TransactionManagerOptions } from '../oidc/types';\nimport { createTransactionManager } from '../oidc/TransactionManager';\nimport { IdxTransactionMeta, IntrospectOptions } from './types';\nimport { isRawIdxResponse } from './types/idx-js';\nimport { IdxStorageManagerInterface, SavedIdxResponse } from './types/storage';\n\nexport function createIdxTransactionManager\n<\n  M extends IdxTransactionMeta = IdxTransactionMeta,\n  S extends IdxStorageManagerInterface<M> = IdxStorageManagerInterface<M>\n>\n()\n{\n  const TransactionManager = createTransactionManager<M, S>();\n  return class IdxTransactionManager extends TransactionManager\n  {\n    constructor(options: TransactionManagerOptions) {\n      super(options);\n    }\n\n    clear(options: ClearTransactionMetaOptions = {}) {\n      super.clear(options);\n\n      if (options.clearIdxResponse !== false) {\n        this.clearIdxResponse();\n      }\n    }\n    \n    saveIdxResponse(data: SavedIdxResponse): void {\n      if (!this.saveLastResponse) {\n        return;\n      }\n      const storage = this.storageManager.getIdxResponseStorage();\n      if (!storage) {\n        return;\n      }\n      storage.setStorage(data);\n    }\n\n    // eslint-disable-next-line complexity\n    loadIdxResponse(options?: IntrospectOptions): SavedIdxResponse | null {\n      if (!this.saveLastResponse) {\n        return null;\n      }\n      const storage = this.storageManager.getIdxResponseStorage();\n      if (!storage) {\n        return null;\n      }\n      const storedValue = storage.getStorage();\n      if (!storedValue || !isRawIdxResponse(storedValue.rawIdxResponse)) {\n        return null;\n      }\n\n      if (options) {\n        const { stateHandle, interactionHandle } = options;\n        if (stateHandle && storedValue.stateHandle !== stateHandle) {\n          return null;\n        }\n        if (interactionHandle && storedValue.interactionHandle !== interactionHandle) {\n          return null;\n        }\n      }\n\n      return storedValue;\n    }\n\n    clearIdxResponse(): void {\n      if (!this.saveLastResponse) {\n        return;\n      }\n      const storage = this.storageManager.getIdxResponseStorage();\n      storage?.clearStorage();\n    }\n  };\n}\n"],"mappings":";;;;AACA;;AAEA;;AAGO,SAASA,2BAAT,GAMP;EACE,MAAMC,kBAAkB,GAAG,IAAAC,4CAAA,GAA3B;EACA,OAAO,MAAMC,qBAAN,SAAoCF,kBAApC,CACP;IACEG,WAAW,CAACC,OAAD,EAAqC;MAC9C,MAAMA,OAAN;IACD;;IAEDC,KAAK,CAACD,OAAoC,GAAG,EAAxC,EAA4C;MAC/C,MAAMC,KAAN,CAAYD,OAAZ;;MAEA,IAAIA,OAAO,CAACE,gBAAR,KAA6B,KAAjC,EAAwC;QACtC,KAAKA,gBAAL;MACD;IACF;;IAEDC,eAAe,CAACC,IAAD,EAA+B;MAC5C,IAAI,CAAC,KAAKC,gBAAV,EAA4B;QAC1B;MACD;;MACD,MAAMC,OAAO,GAAG,KAAKC,cAAL,CAAoBC,qBAApB,EAAhB;;MACA,IAAI,CAACF,OAAL,EAAc;QACZ;MACD;;MACDA,OAAO,CAACG,UAAR,CAAmBL,IAAnB;IACD,CAtBH,CAwBE;;;IACAM,eAAe,CAACV,OAAD,EAAuD;MACpE,IAAI,CAAC,KAAKK,gBAAV,EAA4B;QAC1B,OAAO,IAAP;MACD;;MACD,MAAMC,OAAO,GAAG,KAAKC,cAAL,CAAoBC,qBAApB,EAAhB;;MACA,IAAI,CAACF,OAAL,EAAc;QACZ,OAAO,IAAP;MACD;;MACD,MAAMK,WAAW,GAAGL,OAAO,CAACM,UAAR,EAApB;;MACA,IAAI,CAACD,WAAD,IAAgB,CAAC,IAAAE,uBAAA,EAAiBF,WAAW,CAACG,cAA7B,CAArB,EAAmE;QACjE,OAAO,IAAP;MACD;;MAED,IAAId,OAAJ,EAAa;QACX,MAAM;UAAEe,WAAF;UAAeC;QAAf,IAAqChB,OAA3C;;QACA,IAAIe,WAAW,IAAIJ,WAAW,CAACI,WAAZ,KAA4BA,WAA/C,EAA4D;UAC1D,OAAO,IAAP;QACD;;QACD,IAAIC,iBAAiB,IAAIL,WAAW,CAACK,iBAAZ,KAAkCA,iBAA3D,EAA8E;UAC5E,OAAO,IAAP;QACD;MACF;;MAED,OAAOL,WAAP;IACD;;IAEDT,gBAAgB,GAAS;MACvB,IAAI,CAAC,KAAKG,gBAAV,EAA4B;QAC1B;MACD;;MACD,MAAMC,OAAO,GAAG,KAAKC,cAAL,CAAoBC,qBAApB,EAAhB;MACAF,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEW,YAAT;IACD;;EAzDH,CADA;AA4DD"}